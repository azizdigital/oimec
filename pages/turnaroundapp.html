<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBA Turnaround Tracking System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        .nav {
            background-color: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 0 20px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 30px;
        }

        .nav-button {
            border: none;
            background: none;
            padding: 15px 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .nav-button.active {
            border-bottom-color: #007bff;
            color: #007bff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 6px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background-color: #f8f9fa;
            font-size: 12px;
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
        }

        .status-badge {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 9999px;
        }

        .status-completed {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-progress {
            background-color: #fef3c7;
            color: #854d0e;
        }

        .status-started {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-not-started {
            background-color: #f1f5f9;
            color: #475569;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            cursor: pointer;
        }
		
.progress-arrow {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
    color: #666;
    transition: all 0.2s;
    user-select: none;
}

.progress-arrow:hover {
    color: #007bff;
    transform: scale(1.1);
}

.progress-arrow:active {
    color: #0056b3;
    transform: scale(0.9);
}

.progress-arrow.disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.progress-arrow.disabled:hover {
    color: #666;
    transform: scale(1);
}
        .progress-value {
            font-size: 14px;
            font-weight: 600;
            color: #007bff;
            min-width: 40px;
        }

        .chart-container {
            height: 400px;
            position: relative;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }

        .hidden {
            display: none;
        }

        .sd-status {
            padding: 15px;
            border-radius: 8px;
            border: 1px solid;
            font-weight: 500;
            color: #333;
        }

        .sd-status.normal {
            background-color: #e8f5e8;
            border-color: #c8e6c9;
        }

        .sd-status.final {
            background-color: #fff3e0;
            border-color: #ffcc02;
        }

        .sd-status.exceeded {
            background-color: #ffebee;
            border-color: #ffcdd2;
        }
		
.today-start {
    background-color: #e8f5e8 !important;
    border-left: 4px solid #28a745;
}

.today-completed {
    background-color: #f8f9fa !important;
    border-left: 4px solid #6c757d;
}

.today-overdue {
    background-color: #ffe6e6 !important;
    border-left: 4px solid #dc3545;
}

.today-progress {
    background-color: #e3f2fd !important;
    border-left: 4px solid #2196f3;
}

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background-color: white;
            border-radius: 8px;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            color: #ccc;
            margin-bottom: 16px;
        }

        .report-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }

        .report-text {
            white-space: pre-wrap;
            font-size: 14px;
            color: #333;
            margin: 0;
            font-family: inherit;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid;
        }

        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .file-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* Timeline Specific Styles */
        .timeline-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .timeline-header {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .timeline-dates {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            min-width: 800px;
        }

        .timeline-row {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 12px;
            align-items: center;
            min-height: 40px;
        }

        .timeline-item-info {
            font-size: 13px;
            padding-right: 10px;
        }

        .timeline-item-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }

        .timeline-item-subtitle {
            color: #666;
            font-size: 11px;
        }

        .timeline-bar-container {
            position: relative;
            height: 25px;
            background: #f0f0f0;
            border-radius: 12px;
            min-width: 800px;
        }

        .timeline-bar {
            position: absolute;
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            font-size: 11px;
            font-weight: 500;
            color: white;
            transition: all 0.2s;
        }

        .timeline-bar:hover {
            transform: scaleY(1.1);
            z-index: 10;
        }

        .timeline-progress {
            position: absolute;
            height: 100%;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.3s;
        }

        .timeline-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-checkbox {
            margin-right: 5px;
        }

        .timeline-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .group-hmm { background-color: #3b82f6; }
        .group-cmpe { background-color: #10b981; }
        .group-operations { background-color: #f59e0b; }
        .group-qc { background-color: #8b5cf6; }
        .group-psv { background-color: #ef4444; }
        .group-fims { background-color: #06b6d4; }
        .group-tmrg { background-color: #84cc16; }
        .group-pm02 { background-color: #6b7280; }

        /* Status specific styles */
        .status-completed {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
            border: 2px solid #1e40af;
            opacity: 0.85;
            position: relative;
            overflow: hidden;
        }

        .status-completed::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 3s infinite;
        }

        .status-completed::after {
            content: "‚úì COMPLETED";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: bold;
            color: white;
            background: rgba(30, 64, 175, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            z-index: 10;
        }

        @keyframes shine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .status-not-started {
            opacity: 0.3;
            background: #22c55e !important;
            filter: grayscale(70%);
        }

        .status-in-progress {
            background: #22c55e !important;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.6);
            animation: pulse-green 2s infinite;
        }

        .status-overdue {
            background: #ef4444 !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
            animation: pulse-red 1.5s infinite;
        }

        .status-overdue::after {
            content: "‚ö†Ô∏è OVERDUE";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: bold;
            color: #dc2626;
            background: rgba(255,255,255,0.95);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #dc2626;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 12px rgba(34, 197, 94, 0.6); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 18px rgba(239, 68, 68, 0.7); }
        }

        .location-iba { opacity: 1; }
        .location-ibb { opacity: 0.7; border: 2px solid rgba(255,255,255,0.8); }

        @media (max-width: 768px) {
            .container {
                padding: 15px 10px;
            }
            
            .nav-container {
                gap: 15px;
            }
            
            .nav-button {
                font-size: 12px;
                padding: 12px 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .timeline-row {
                grid-template-columns: 250px 1fr;
            }

            .timeline-header {
                grid-template-columns: 250px 1fr;
            }
        }
.copyright {
            background-color: #f8f9fa;
            color: #666;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid #e0e0e0;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .copyright a {
            color: #007bff;
            text-decoration: none;
        }

        .copyright a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .copyright {
                padding: 15px 10px;
                font-size: 12px;
            }
        }
		
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <button class="nav-button active" onclick="showView('bulk-update')" id="nav-bulk-update">
                üìÑ Daily Update
            </button>
            <button class="nav-button" onclick="showView('timeline')" id="nav-timeline">
                üìÖ Timeline
            </button>
            <button class="nav-button" onclick="showView('history')" id="nav-history">
                üìã History
            </button>
            <button class="nav-button" onclick="showView('dashboard')" id="nav-dashboard">
                üìä Dashboard
            </button>
            <button class="nav-button" onclick="showView('scurve')" id="nav-scurve">
                üìà S-Curve
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- File Controls -->
        <div class="file-controls">
            <button class="btn btn-primary" onclick="loadSharedData()">üîç Load Shared Data</button>
            <button class="btn btn-success" onclick="saveSharedData()">üíæ Save to Shared Data</button>
            <button class="btn btn-secondary" onclick="createBackup()">üîÑ Create Backup</button>
            <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importData(event)">
            <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">üì§ Import Data</button>
            <button class="btn btn-secondary" onclick="exportData()">üì• Export Data</button>
        </div>

        <!-- Bulk Update View -->
        <div id="view-bulk-update">
            <div class="header">
                <h1>üìÑ Daily Progress Update</h1>
                <p>Update progress untuk work items by work group</p>
            </div>

            <!-- Date & Controls -->
            <div class="card">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Review Date</label>
                        <input type="date" id="reviewDate" class="form-control" onchange="onDateChange()">
                    </div>
                    <div class="form-group">
                        <label>Start SD Date</label>
                        <input type="date" id="startSDDate" class="form-control" onchange="updateDefaultDates()">
                    </div>
                    <div class="form-group">
                        <label>Expected End</label>
                        <input type="date" id="expectedEndDate" class="form-control" onchange="updateDefaultDates()">
                    </div>
                    <div class="form-group">
                        <label>Work Group</label>
                        <select id="workGroup" class="form-control" onchange="onWorkGroupChange()">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Platform POB</label>
                        <input type="number" id="platformPOB" class="form-control" placeholder="85">
                    </div>
                    <div class="form-group">
                        <label>Vessel POB</label>
                        <input type="number" id="vesselPOB" class="form-control" placeholder="12">
                    </div>
                </div>

                <div id="sdStatus" class="sd-status normal"></div>
            </div>

            <!-- Search & Controls -->
           <div style="margin-bottom: 20px;">
    <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
        <input type="text" id="searchTerm" class="form-control" placeholder="Search work items..." onkeyup="filterWorkItems()" style="flex: 1;">
        <button class="btn btn-secondary" onclick="toggleShowAll()" id="showAllBtn">üìã Show All Items</button>
        <button class="btn btn-secondary" onclick="toggleTodayItems()" id="todayItemsBtn">üìÖ Today's Focus</button>
    </div>
    <div id="hiddenItemsAlert" class="alert alert-success hidden"></div>
</div>

            <!-- Work Items Table -->
            <div class="card">
                <div style="padding: 20px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                    <h3 id="workGroupTitle" style="font-size: 18px; font-weight: 500; color: #333; margin: 0;">Work Items</h3>
                    <button class="btn btn-success" onclick="saveAllProgress()">üíæ Save All Progress</button>
                </div>
                
                <div class="table-container">
                    <table class="table" id="workItemsTable">
                        <thead>
                            <tr>
                                <th>Work Order</th>
                                <th>Description</th>
                                <th>Progress %</th>
                                <th>Status</th>
                                <th>Est. Start</th>
                                <th>Est. End</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="workItemsBody">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Additional Remarks -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 25px;">
                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px;">üì¶ Logistics / Support Remarks</h3>
                    <textarea id="logisticsRemarks" rows="4" class="form-control" placeholder="Add specific remarks about logistics and support..."></textarea>
                </div>
                
                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px;">üîí Safety & Compliance Remarks</h3>
                    <textarea id="safetyRemarks" rows="4" class="form-control" placeholder="Add specific remarks about safety and compliance..."></textarea>
                </div>
            </div>

            <!-- HSE Section -->
            <div class="card">
                <h3 style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px;">üõ°Ô∏è HSE Report</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Incidents</label>
                        <input type="number" id="hseIncidents" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Near Miss</label>
                        <input type="number" id="hseNearMiss" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>UAUC Updates</label>
                        <input type="number" id="hseSafetyObservations" class="form-control" min="0" value="0">
                    </div>
                </div>
            </div>

            <!-- Generated Report -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="font-size: 16px; font-weight: 600; color: #333; margin: 0;">Generated Daily Report</h3>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span id="reportStatus" class="hidden" style="font-size: 12px; color: #28a745; font-weight: 500;"></span>
                        <button class="btn btn-primary" onclick="generateReport()">üìã Generate Report</button>
                    </div>
                </div>
                <div class="report-box">
                    <pre class="report-text" id="reportContent">Click "Generate Report" to create daily update...</pre>
                </div>
                <button class="btn btn-secondary" onclick="copyReport()">üìã Copy Report to Clipboard</button>
            </div>
        </div>

        <!-- Timeline View -->
        <div id="view-timeline" class="hidden">
            <div class="header">
                <h1>üìÖ Timeline View</h1>
                <p>SIMOP visualization - work items timeline and overlap analysis</p>
            </div>

            <!-- Date Selector -->
            <div class="card">
                <h3 style="margin-bottom: 15px;">üìÖ Timeline Date</h3>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <div class="form-group" style="margin: 0;">
                        <label>View Date:</label>
                        <input type="date" id="timelineDate" class="form-control" onchange="onTimelineDateChange()" style="width: 200px;">
                    </div>
                    <button class="btn btn-secondary" onclick="setTimelineToToday()">üìÖ Today</button>
                    <button class="btn btn-secondary" onclick="setTimelineToSD()">üöÄ SD Start</button>
                    <span id="timelineDayInfo" style="font-size: 14px; color: #666; font-weight: 500;"></span>
                </div>
            </div>

            <!-- Timeline Filters -->
            <div class="card">
                <h3 style="margin-bottom: 15px;">üîç Filters</h3>
                <div class="timeline-filters">
                    <div class="filter-group">
                        <label><strong>Work Groups:</strong></label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-hmm" checked onchange="renderTimeline()"> HMM</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-cmpe" checked onchange="renderTimeline()"> CMPE</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-operations" checked onchange="renderTimeline()"> Operations</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-qc" checked onchange="renderTimeline()"> QC</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-psv" checked onchange="renderTimeline()"> PSV</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-fims" checked onchange="renderTimeline()"> FIMS</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-tmrg" checked onchange="renderTimeline()"> TMRG</label>
                    </div>
                </div>
                <div class="timeline-filters">
                    <div class="filter-group">
                        <label><strong>Locations:</strong></label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-iba" checked onchange="renderTimeline()"> IBA</label>
                        <label><input type="checkbox" class="filter-checkbox" id="filter-ibb" checked onchange="renderTimeline()"> IBB</label>
                    </div>
                    <div class="filter-group">
                        <label><input type="checkbox" class="filter-checkbox" id="filter-only-scheduled" onchange="renderTimeline()"> Only show scheduled items</label>
                    </div>
                </div>
            </div>

            <!-- Timeline Legend -->
            <div class="card">
                <h3 style="margin-bottom: 15px;">üìã Legend</h3>
                <div class="timeline-legend">
                    <div class="legend-item">
                        <div class="legend-color group-hmm"></div>
                        <span>HMM (Asset Restoration)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-cmpe"></div>
                        <span>CMPE (Maintenance)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-operations"></div>
                        <span>Operations</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-qc"></div>
                        <span>QC Inspection</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-psv"></div>
                        <span>PSV Gang</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-fims"></div>
                        <span>FIMS</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color group-tmrg"></div>
                        <span>TMRG</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="font-size: 14px; margin-bottom: 10px; color: #333;">üìä Status Indicators:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 30px; height: 16px; background: #22c55e; border-radius: 4px; box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);"></div>
                            <span style="font-size: 12px;">üîÑ In Progress (glowing hijau)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 30px; height: 16px; background: repeating-linear-gradient(45deg, #3b82f6, #3b82f6 4px, rgba(255,255,255,0.4) 4px, rgba(255,255,255,0.4) 8px); border: 1px solid #1d4ed8; border-radius: 4px; opacity: 0.9;"></div>
                            <span style="font-size: 12px;">‚úì Completed (striped biru)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 30px; height: 16px; background: #22c55e; border-radius: 4px; opacity: 0.3; filter: grayscale(70%);"></div>
                            <span style="font-size: 12px;">‚è≥ Not Started (faded hijau)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 30px; height: 16px; background: #ef4444; border-radius: 4px; box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);"></div>
                            <span style="font-size: 12px;">‚ö†Ô∏è Overdue (merah)</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 12px; color: #666;">
                    <strong>Location indicators:</strong> Solid bars = IBA, Bars with white border = IBB
                </div>
            </div>

            <!-- Timeline Container -->
            <div id="timelineContent">
                <!-- Timeline will be populated by JavaScript -->
            </div>
        </div>

        <!-- History View -->
        <div id="view-history" class="hidden">
            <div class="header">
                <h1>üìã Historical Updates</h1>
                <p>View past TA progress reports</p>
            </div>
            <div id="historyContent">
                <!-- History content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="view-dashboard" class="hidden">
            <div class="header">
                <h1>üìä Dashboard</h1>
                <p>TA Progress Overview</p>
            </div>
            <div id="dashboardContent">
                <!-- Dashboard content will be populated by JavaScript -->
            </div>
        </div>

        <!-- S-Curve View -->
        <div id="view-scurve" class="hidden">
            <div class="header">
                <h1>üìà S-Curve Analysis</h1>
                <p>Planned vs Actual Progress Tracking</p>
            </div>
            <div id="scurveContent">
                <!-- S-Curve content will be populated by JavaScript -->
            </div>
        </div>
    </div>
	
        <footer class="copyright">
            ¬© 2020 Aziz Mohamad. Semua hak terpelihara. TCOT Turnaround
        </footer>
    
	
    <script>
        // Global state management
        let currentView = 'bulk-update';
        let selectedWorkGroup = 'HMM (Asset Restoration)';
        let dailyProgress = {};
        let updates = [];
        let completionDates = {};
        let lineItemDates = {};
        let timelineDate = new Date().toISOString().split('T')[0]; // Current date for timeline
        let formData = {
            date: new Date().toISOString().split('T')[0],
            startSDDate: '2025-01-01',
            expectedEndDate: '2025-01-25',
            platformPOB: '',
            vesselPOB: '',
            hseIncidents: 0,
            hseNearMiss: 0,
            hseSafetyObservations: 0,
            logisticsRemarks: '',
            safetyRemarks: ''
        };
        let searchTerm = '';
        let reportGenerated = false;
        let lastReportTime = null;
        let showAllItems = false; // Toggle for showing all items
		let showTodayItems = false; // Toggle for today's focus items

        // Helper function to format description
        function formatDescription(desc) {
            let formatted = desc.toLowerCase();
            formatted = formatted.charAt(0).toUpperCase() + formatted.slice(1);
            
            const equipmentPatterns = [
                /\b(sdv|psv|bdv|pdv|xdv|hv|lv|fv|cv)-?(\d+[a-z]*)\b/gi,
                /\b(tcp|dcs|vfd|whcp|iba|ibb|esd|cft|pssr)\b/gi,
                /\b(myia-iba-[a-z0-9-]+)\b/gi,
                /\b(myib-ibb-[a-z0-9-]+)\b/gi,
                /\b(fims\d+)\b/gi,
                /\b([a-z]+-\d+[a-z]*)\b/g,
                /\b(sk-\d+)\b/gi,
                /\b(v-\d+[a-z]*)\b/gi,
                /\b(f-\d+[a-z]*)\b/gi,
                /\b(me-\d+)\b/gi,
                /\b(wh-\d+[a-z-]*)\b/gi,
                /\b(pn-\d+)\b/gi,
                /\b(mc-\d+)\b/gi,
                /\b(lt-\d+[a-z-]*)\b/gi,
                /\b(pt-\d+[a-z]*)\b/gi,
                /\b(lcv-\d+[a-z]*)\b/gi,
                /\b(fcv-\d+)\b/gi,
                /\b(zsc-\d+)\b/gi,
                /\b(fd-cd\d+)\b/gi,
                /\b(fa-\d+[a-z]*)\b/gi,
                /\b(fn-\d+[a-z]*)\b/gi,
                /\b(wms-\d+)\b/gi,
                /\b(hy-\d+)\b/gi,
                /\b(psv-\d+[a-z]*)\b/gi,
                /\b(bdv-\d+)\b/gi,
                /\b(sv-\d+[a-z]*)\b/gi,
                /\b(sy-\d+[a-z]*)\b/gi,
                /\b(xv-\d+)\b/gi,
                /\b(pse-\d+)\b/gi,
                /\b(sp-\d+)\b/gi
            ];
            
            equipmentPatterns.forEach(pattern => {
                formatted = formatted.replace(pattern, (match) => match.toUpperCase());
            });
            
            return formatted;
        }

// Work items data
        const workItemsData = {
            'HMM (Asset Restoration)': [
                { id: 1, index: 1, order: "40025559", description: formatDescription("SK-175 TCP UPGRADE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "HMM (Construction)", weightage: "9.38%", progress: 1 },
                { id: 2, index: 2, order: "11400318", description: formatDescription("V-800: INTERNAL INSPECTION DURING SD."), location: "IBA", equipment: "MYIA-IBA-V-800", workCenter: "HMM (Construction)", weightage: "6.25%", progress: 1 },
                { id: 3, index: 3, order: "11462213", description: formatDescription("V-120 INTERNAL VESSEL CLEANING AND NOZZLE REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-V-120", workCenter: "HMM (Construction)", weightage: "6.25%", progress: 1 },
                { id: 4, index: 4, order: "11472734", description: formatDescription("FLARE NOZZLE REPLACEMENT."), location: "IBA", equipment: "MYIA-IBA-ME-180", workCenter: "HMM (Construction)", weightage: "3.13%", progress: 1 },
                { id: 5, index: 5, order: "11406923", description: formatDescription("IBA -13U WALL THICKNESS LOSS"), location: "IBA", equipment: "MYIA-IBA-WH-13U-FL", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 6, index: 6, order: "11467788", description: formatDescription("V210 & V130 CHECK VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 7, index: 7, order: "11467833", description: formatDescription("F1- TO INSTALL CI QUILL AT IBA SP131"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 8, index: 8, order: "11467835", description: formatDescription("F1- TO INSTALL CI QUILL AT IBA SP133"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 9, index: 9, order: "11396376", description: formatDescription("F-163A INLET/OUTLET VALVES PASSING"), location: "IBA", equipment: "MYIA-IBA-F-163A", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 10, index: 10, order: "11455977", description: formatDescription("F-173A TO ROTATE FILTER HOUSING"), location: "IBA", equipment: "MYIA-IBA-F-173A", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 11, index: 11, order: "11415417", description: formatDescription("XDV-597 MANUAL VALVE CHANGE OUT"), location: "IBA", equipment: "MYIA-IBA-XDV-597", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 12, index: 12, order: "11423909", description: formatDescription("XDV-593 DISCH FLANGE CONC CORRODED"), location: "IBA", equipment: "MYIA-IBA-XDV-593", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 13, index: 13, order: "11429373", description: formatDescription("STUD BOLT PARTED AT VALVE BODY"), location: "IBA", equipment: "MYIA-IBA-XDV-594", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 14, index: 14, order: "11335460", description: formatDescription("DELUGE VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-XDV-592", workCenter: "HMM (Construction)", weightage: "1.85%", progress: 1 },
                { id: 15, index: 15, order: "11335457", description: formatDescription("DELUGE VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-XDV-596", workCenter: "HMM (Construction)", weightage: "1.90%", progress: 1 },
                { id: 16, index: 16, order: "11368248", description: formatDescription("V-120 INLET SPECTABLE BLIND REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-V-120", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 }
            ],
            'CMPE (Maintainance)': [
                { id: 17, index: 1, order: "11429986", description: formatDescription("SDV-150 ACTUATOR BADLY CORRODED"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 18, index: 2, order: "11447713", description: formatDescription("V-150 3\" VALVE AT BRIDLE LINE CORRODED"), location: "IBA", equipment: "MYIA-IBA-V-150", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 19, index: 3, order: "11340586", description: formatDescription("MULTIPLE FAULTY CARD INSIDE DCS CABINET"), location: "IBA", equipment: "MYIA-IBA-DCS-ALL", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 20, index: 4, order: "11353305", description: formatDescription("AIR LEAK THROUGH VALVE STEM"), location: "IBA", equipment: "MYIA-IBA-LV-120B", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 21, index: 5, order: "11450291", description: formatDescription("SDV-131 BODY BADLY CORRODED."), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 22, index: 6, order: "11399275", description: formatDescription("REPLACE TRANSFORMER T-C 480-120/208"), location: "IBA", equipment: "MYIA-IBA-MC-502", workCenter: "CMPE (Electrician)", weightage: "1.00%", progress: 0 },
                { id: 23, index: 7, order: "11357941", description: formatDescription("SK-175 VFD ISSUE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "CMPE (Electrician)", weightage: "1.00%", progress: 0 },
                { id: 24, index: 8, order: "11313044", description: formatDescription("WHCP PN-200 UPGRADE"), location: "IBA", equipment: "MYIA-IBA-PN-200", workCenter: "CMPE (E&I)", weightage: "3.13%", progress: 0 },
                { id: 25, index: 9, order: "11416733", description: formatDescription("HV-115B VALVE PASSING"), location: "IBB", equipment: "MYIB-IBB-HV-115B", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 26, index: 10, order: "11441063", description: formatDescription("IBB SM VALVES - SOLENOID VALVES UPGRADE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 27, index: 11, order: "11450609", description: formatDescription("HV-115B ACTUATOR CORRODED"), location: "IBB", equipment: "MYIB-IBB-HV-115B", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
                { id: 28, index: 12, order: "23864201", description: formatDescription("CFT - PLATFORM ESD FULL FUNCTION TESTING"), location: "IBA", equipment: "MYIA-IBA-ESD-ALL", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 100 }
                
			],
            'Operations': [
                { id: 50, index: 1, order: "23864161", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-886", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 51, index: 2, order: "23864160", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-880", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 52, index: 3, order: "23864159", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-870", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 53, index: 4, order: "23864158", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-865", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 54, index: 5, order: "23864157", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-860", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 55, index: 6, order: "23851075", description: formatDescription("PRESSURE SAFETY VALVE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 56, index: 7, order: "23851076", description: formatDescription("PRESSURE SAFETY VALVE"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 57, index: 8, order: "OPR-001", description: formatDescription("FUEL GAS SYSTEM ISOLATION AND PREPARATION"), location: "IBA", equipment: "FUEL-GAS-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 58, index: 9, order: "OPR-002", description: formatDescription("CRUDE OIL SYSTEM DEPRESSURIZATION AND DRAINING"), location: "IBA", equipment: "CRUDE-OIL-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 59, index: 10, order: "OPR-003", description: formatDescription("GAS LIFT INJECTION SYSTEM DEISOLATION"), location: "IBA", equipment: "GAS-LIFT-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 60, index: 11, order: "OPR-004", description: formatDescription("UTILITY SYSTEM PRESSURE UP AND COMMISSIONING"), location: "IBA", equipment: "UTILITY-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 61, index: 12, order: "OPR-005", description: formatDescription("PRE-STARTUP SAFETY REVIEW (PSSR) COMPLETION"), location: "IBA", equipment: "ALL-SYSTEMS", workCenter: "Operations", weightage: "1.50%", progress: 0 }
            ],
            'QC INSPECTION': [
                { id: 65, index: 1, order: "23861687", description: formatDescription("IBA FLARE WALKWAY BEAM INSPECTION"), location: "IBA", equipment: "MYIA-IBA-STRUCT", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 66, index: 2, order: "23757213", description: formatDescription("FLARE TIP CLOSE VISUAL INSPECTION"), location: "IBA", equipment: "MYIA-IBA-ME-180", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 67, index: 3, order: "23826434", description: formatDescription("F2 EXT VISUAL INSP FLARE BOOM & TOWER"), location: "IBA", equipment: "MYIA-IBA-PIPE-02", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 68, index: 4, order: "23450502", description: formatDescription("F2 EXT VISUAL INSP VENT BOOM"), location: "IBB", equipment: "MYIB-IBB-PIPE-02", workCenter: "QC", weightage: "1.25%", progress: 0 }
            ],
            'CMPE (PSV)': [
                { id: 70, index: 1, order: "23538104", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-235A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 71, index: 2, order: "23717006", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-130A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 72, index: 3, order: "23717007", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-220A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 73, index: 4, order: "23717008", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-230A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 74, index: 5, order: "23717025", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-230B", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 75, index: 6, order: "23717011", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-460A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 }
            ],
            'HMM (FIMS02)': [
                { id: 80, index: 1, order: "11344620", description: formatDescription("EXT-25L-00857-L-PP"), location: "IBA", equipment: "FIMS02", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 81, index: 2, order: "11339453", description: formatDescription("1C-PD-M1-00208-L-FLG"), location: "IBA", equipment: "FIMS03", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 82, index: 3, order: "11339453", description: formatDescription("1C-PD-M1-00211-L-FLG"), location: "IBA", equipment: "FIMS04", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 83, index: 4, order: "11346663", description: formatDescription("MzD-M1-00112-M-PP"), location: "IBB", equipment: "FIMS05", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 84, index: 5, order: "11346663", description: formatDescription("M1-MzD-00132-H-PP"), location: "IBB", equipment: "FIMS06", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 }
            ],
            'Roving Gang (TMRG)': [
                { id: 90, index: 1, order: "TBA", description: formatDescription("SK175 8KPM"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "TMRG", weightage: "5.00%", progress: 0 },
                { id: 91, index: 2, order: "11479126", description: formatDescription("HOTSPOT FOUND AT EXHAUST STACK"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "TMRG", weightage: "5.00%", progress: 0 }
            ],
			
			// ADD THESE 2 NEW GROUPS AFTER 'Roving Gang (TMRG)'

'CMPE (E&I) - PM02': [
    { id: 92, index: 1, order: "23820940", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-886", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 93, index: 2, order: "23820939", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-880", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 94, index: 3, order: "23820938", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-870", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 95, index: 4, order: "23820937", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-868", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 96, index: 5, order: "23820936", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-865", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 97, index: 6, order: "23820735", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-860", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 98, index: 7, order: "23820734", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-845", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 99, index: 8, order: "23820733", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-840", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 100, index: 9, order: "23864146", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-887", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 101, index: 10, order: "23864145", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-885", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 102, index: 11, order: "23864144", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-840A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 103, index: 12, order: "23864143", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-430", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 104, index: 13, order: "23864142", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-412", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 105, index: 14, order: "23864141", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-411", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 106, index: 15, order: "23864140", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-240", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 107, index: 16, order: "23864139", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-239", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 108, index: 17, order: "23864138", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-225", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 109, index: 18, order: "23864137", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 110, index: 19, order: "23864136", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 111, index: 20, order: "23864135", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 112, index: 21, order: "23864134", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 113, index: 22, order: "23864133", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-105", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 114, index: 23, order: "23864132", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-480", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 115, index: 24, order: "23864150", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-863", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 116, index: 25, order: "23864149", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-259", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 117, index: 26, order: "23864148", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-242", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 118, index: 27, order: "23864147", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-227", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 119, index: 28, order: "23853296", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-460", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 120, index: 29, order: "23853420", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-227", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 121, index: 30, order: "23853419", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-225", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 122, index: 31, order: "23853418", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-840", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 123, index: 32, order: "23853422", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-411", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 124, index: 33, order: "23853421", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-840A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 125, index: 34, order: "23853424", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-105", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 126, index: 35, order: "23853417", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-120", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 127, index: 36, order: "23853423", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SY-102", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 128, index: 37, order: "23833970", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-351", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 129, index: 38, order: "23833968", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-230", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 130, index: 39, order: "23833966", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-220", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 131, index: 40, order: "23833964", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-212", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 132, index: 41, order: "23833962", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-130A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 133, index: 42, order: "23833960", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-121", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 134, index: 43, order: "23833958", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-860A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 135, index: 44, order: "23833957", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-593", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 136, index: 45, order: "23833956", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-180", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 137, index: 46, order: "23864202", description: formatDescription("CFT - SDV FVO/LVO (PNEU) FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-840", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 138, index: 47, order: "23833714", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-XV-152", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 139, index: 48, order: "23833712", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-207", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 140, index: 49, order: "23868031", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-290", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 141, index: 50, order: "23847917", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-885", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 142, index: 51, order: "23848231", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 143, index: 52, order: "23849997", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 144, index: 53, order: "23868029", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-430", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 145, index: 54, order: "23727719", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-480", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 146, index: 55, order: "23868028", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-411", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 147, index: 56, order: "23727717", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-225", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 148, index: 57, order: "23868027", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-460", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 149, index: 58, order: "23847918", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-887", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 150, index: 59, order: "23847916", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-868", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 151, index: 60, order: "23850139", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-840A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 152, index: 61, order: "23727725", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-239", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 153, index: 62, order: "23727724", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 154, index: 63, order: "23868030", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 155, index: 64, order: "23848492", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 156, index: 65, order: "23868026", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-412", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 157, index: 66, order: "23848493", description: formatDescription("CFT - VALVE, BLOWDOWN FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-BDV-227", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 158, index: 67, order: "23848346", description: formatDescription("CFT - VALVE, BLOWDOWN FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-BDV-863", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 159, index: 68, order: "23863214", description: formatDescription("DEPRESSURIZATION (BD) PERFORMANCE TEST"), location: "IBA", equipment: "MYIA-IBA-BDV-159", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 160, index: 69, order: "23864226", description: formatDescription("YARD VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-159", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 161, index: 70, order: "23727740", description: formatDescription("YARD VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-192", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 162, index: 71, order: "23536164", description: formatDescription("TRANSMITTER, PRESSURE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-PT-135C", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 163, index: 72, order: "23643502", description: formatDescription("TRANSMITTER, PRESSURE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-PT-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 164, index: 73, order: "23731380", description: formatDescription("CFT - TRANSMITTER, LEVEL FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-LT-151", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 165, index: 74, order: "23731382", description: formatDescription("CFT - TRANSMITTER, LEVEL FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-LT-121-1", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 166, index: 75, order: "23757208", description: formatDescription("CONTROL VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-LCV-120A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 167, index: 76, order: "23757209", description: formatDescription("CONTROL VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-LCV-220", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 168, index: 77, order: "23864126", description: formatDescription("CFT - LIMIT SWITCHES (SK-175)"), location: "IBA", equipment: "MYIA-IBA-ZSC-185", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 169, index: 78, order: "23864125", description: formatDescription("CFT - LIMIT SWITCHES (SK-175)"), location: "IBA", equipment: "MYIA-IBA-ZSC-125", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 170, index: 79, order: "23864124", description: formatDescription("CFT - VALVE, CONTROL MAINTENANCE(SK-175)"), location: "IBA", equipment: "MYIA-IBA-FCV-185", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 171, index: 80, order: "23864123", description: formatDescription("CFT - VALVE, CONTROL MAINTENANCE(SK-175)"), location: "IBA", equipment: "MYIA-IBA-FCV-125", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 172, index: 81, order: "23864203", description: formatDescription("CFT - PLATFORM ESD FULL FUNCTION TESTING"), location: "IBB", equipment: "MYIB-IBB-ESD-ALL", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 100 },
    { id: 173, index: 82, order: "23837083", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 174, index: 83, order: "23837084", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 175, index: 84, order: "23868037", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 176, index: 85, order: "23851133", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 177, index: 86, order: "23848711", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-130", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 178, index: 87, order: "23848710", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 179, index: 88, order: "23848712", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-130", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 180, index: 89, order: "23864204", description: formatDescription("CFT - SDV FVO/LVO (HYD) INSP & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 181, index: 90, order: "23864205", description: formatDescription("CFT - SDV FVO/LVO (PNEU) FUNCTION TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 182, index: 91, order: "23833972", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-HV-115A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 183, index: 92, order: "23868033", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-190", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 184, index: 93, order: "23868032", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-141", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 185, index: 94, order: "23864209", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-102", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 186, index: 95, order: "23868034", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-180", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 187, index: 96, order: "23868035", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 188, index: 97, order: "23868036", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-122", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 189, index: 98, order: "23853415", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SY-130A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 190, index: 99, order: "23853413", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 191, index: 100, order: "23853416", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 192, index: 101, order: "23853414", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-105A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 193, index: 102, order: "23868038", description: formatDescription("WHCP MECHANICAL MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-PN-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 194, index: 103, order: "23849387", description: formatDescription("CFT - CONTROL VALVE/TRANSMITTER & CALIBR"), location: "IBB", equipment: "MYIB-IBB-PCV-124", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 }
],
'CMPE (Mechanic) - PM02': [
    { id: 195, index: 1, order: "23864257", description: formatDescription("DAMPER, FIRE ENCLOSURE MAINT SK-175"), location: "IBA", equipment: "MYIA-IBA-FD-CD175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 196, index: 2, order: "23864163", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-130", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 197, index: 3, order: "23864183", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-825A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 198, index: 4, order: "23864182", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-190", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 199, index: 5, order: "23864180", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-120", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 200, index: 6, order: "23864177", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-107", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 201, index: 7, order: "23864178", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-112", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 202, index: 8, order: "23864179", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-118", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 203, index: 9, order: "23864181", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-122", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 204, index: 10, order: "23853390", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-685A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 205, index: 11, order: "23853388", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-680A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 206, index: 12, order: "23853386", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-665A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 207, index: 13, order: "23853384", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-660A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 208, index: 14, order: "WMS-PM02", description: formatDescription("WATER MIST SYSTEM MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-WMS-175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 209, index: 15, order: "23864255", description: formatDescription("TURBO COMPRESSOR SK-175 MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 210, index: 16, order: "23864221", description: formatDescription("HYDR POWER UNIT OIL REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-HY-235", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 211, index: 17, order: "23864222", description: formatDescription("HYDR POWER UNIT MAINT & INSP"), location: "IBA", equipment: "MYIA-IBA-HY-235", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 212, index: 18, order: "23833969", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-351", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 213, index: 19, order: "23833967", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-230", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 214, index: 20, order: "23833965", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-220", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 215, index: 21, order: "23833963", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-212", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 216, index: 22, order: "23833961", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-130A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 217, index: 23, order: "23833959", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-121", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 218, index: 24, order: "23833715", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-180", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 219, index: 25, order: "23833713", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-XV-152", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 220, index: 26, order: "23833711", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-207", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 221, index: 27, order: "23861727", description: formatDescription("HYDR POWER UNIT MAINT & INSP"), location: "IBB", equipment: "MYIB-IBB-HY-105", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 222, index: 28, order: "23861730", description: formatDescription("HYDR POWER UNIT OIL REPLACEMENT"), location: "IBB", equipment: "MYIB-IBB-HY-105", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 223, index: 29, order: "23727774", description: formatDescription("RUPTURE PIN INSPECTION & MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-PSE-187", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 224, index: 30, order: "23844667", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SP-1831", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 225, index: 31, order: "23833971", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBB", equipment: "MYIB-IBB-HV-115A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 226, index: 32, order: "23538038", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBB", equipment: "MYIB-IBB-SDV-102", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 }
]
			
        };

        // Timeline specific functions
        function getGroupClass(groupName) {
            if (groupName.includes('HMM')) return 'group-hmm';
            if (groupName.includes('CMPE')) return 'group-cmpe';
            if (groupName.includes('Operations')) return 'group-operations';
            if (groupName.includes('QC')) return 'group-qc';
            if (groupName.includes('PSV')) return 'group-psv';
            if (groupName.includes('FIMS')) return 'group-fims';
            if (groupName.includes('TMRG')) return 'group-tmrg';
            return 'group-pm02';
        }

        function getLocationClass(location) {
            return location === 'IBA' ? 'location-iba' : 'location-ibb';
        }

        function isGroupFilterEnabled(groupName) {
            if (groupName.includes('HMM')) return document.getElementById('filter-hmm').checked;
            if (groupName.includes('CMPE')) return document.getElementById('filter-cmpe').checked;
            if (groupName.includes('Operations')) return document.getElementById('filter-operations').checked;
            if (groupName.includes('QC')) return document.getElementById('filter-qc').checked;
            if (groupName.includes('PSV')) return document.getElementById('filter-psv').checked;
            if (groupName.includes('FIMS')) return document.getElementById('filter-fims').checked;
            if (groupName.includes('TMRG')) return document.getElementById('filter-tmrg').checked;
            return true; // Default for other groups
        }

        function renderTimeline() {
            const timelineContent = document.getElementById('timelineContent');
            
            // Get filter states
            const showIBA = document.getElementById('filter-iba').checked;
            const showIBB = document.getElementById('filter-ibb').checked;
            const onlyScheduled = document.getElementById('filter-only-scheduled').checked;
            
            // Collect all items that match filters
            let allItems = [];
            
            Object.keys(workItemsData).forEach(groupName => {
                if (!isGroupFilterEnabled(groupName)) return;
                
                workItemsData[groupName].forEach(item => {
                    // Location filter
                    if (!showIBA && item.location === 'IBA') return;
                    if (!showIBB && item.location === 'IBB') return;
                    
                    // Schedule filter
                    const startDate = getLineItemDate(item.id, 'startDate');
                    const endDate = getLineItemDate(item.id, 'endDate');
                    if (onlyScheduled && (!startDate || !endDate)) return;
                    
                    allItems.push({
                        ...item,
                        groupName,
                        startDate,
                        endDate,
                        progress: getProgress(item.id, timelineDate) // Use timeline date for progress
                    });
                });
            });
            
            if (allItems.length === 0) {
                timelineContent.innerHTML = `
                    <div class="empty-state">
                        <p style="color: #666;">No items match the current filters</p>
                        <p style="color: #666; font-size: 14px;">Try adjusting your filter settings or add start/end dates to work items</p>
                    </div>
                `;
                return;
            }
            
            // Get date range
            const startSD = new Date(formData.startSDDate);
            const endSD = new Date(formData.expectedEndDate);
            const currentTimelineDate = new Date(timelineDate);
            const totalDays = Math.ceil((endSD - startSD) / (1000 * 60 * 60 * 24)) + 1;
            
            // Create timeline HTML
            let timelineHTML = `
                <div class="timeline-container">
                    <div class="timeline-header">
                        <div><strong>Work Item</strong></div>
                        <div class="timeline-dates">
                            <span>${startSD.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' })}</span>
                            <span>${endSD.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' })}</span>
                        </div>
                    </div>
            `;
            
            allItems.forEach(item => {
                const groupClass = getGroupClass(item.groupName);
                const locationClass = getLocationClass(item.location);
                
                // Determine status class with overdue check
                let statusClass = '';
                if (item.progress >= 100) {
                    statusClass = 'status-completed';
                } else if (item.endDate && new Date(item.endDate) < currentTimelineDate && item.progress < 100) {
                    statusClass = 'status-overdue'; // NEW: Overdue status
                } else if (item.progress > 0) {
                    statusClass = 'status-in-progress';
                } else {
                    statusClass = 'status-not-started';
                }
                
                let barStyle = '';
                let progressStyle = '';
                let barText = 'Not Scheduled';
                
                if (item.startDate && item.endDate) {
                    const itemStart = new Date(item.startDate);
                    const itemEnd = new Date(item.endDate);
                    
                    // Calculate position and width
                    const startOffset = Math.max(0, (itemStart - startSD) / (1000 * 60 * 60 * 24));
                    const duration = Math.ceil((itemEnd - itemStart) / (1000 * 60 * 60 * 24)) + 1;
                    const leftPercent = (startOffset / totalDays) * 100;
                    const widthPercent = (duration / totalDays) * 100;
                    
                    barStyle = `left: ${leftPercent}%; width: ${widthPercent}%;`;
                    progressStyle = `width: ${item.progress}%;`;
                    
                    // Update bar text based on status
                    if (item.progress >= 100) {
                        barText = `100% DONE`;
                    } else if (statusClass === 'status-overdue') {
                        barText = `${item.progress}% OVERDUE`;
                    } else if (item.progress > 0) {
                        barText = `${item.progress}% IN PROGRESS`;
                    } else {
                        barText = `0% NOT STARTED`;
                    }
                }
                
                // Add status indicator to item info
                let statusIndicator = '';
                if (item.progress >= 100) {
                    statusIndicator = '<div style="font-size: 10px; color: #1d4ed8; font-weight: bold;">‚úì COMPLETED</div>';
                } else if (statusClass === 'status-overdue') {
                    statusIndicator = '<div style="font-size: 10px; color: #dc2626; font-weight: bold;">‚ö†Ô∏è OVERDUE</div>';
                } else if (item.progress > 0) {
                    statusIndicator = '<div style="font-size: 10px; color: #22c55e; font-weight: bold;">üîÑ IN PROGRESS</div>';
                } else {
                    statusIndicator = '<div style="font-size: 10px; color: #6b7280; font-weight: bold;">‚è≥ NOT STARTED</div>';
                }
                
                timelineHTML += `
                    <div class="timeline-row">
                        <div class="timeline-item-info">
                            <div class="timeline-item-title">${item.order}</div>
                            <div class="timeline-item-subtitle">${item.description.substring(0, 50)}${item.description.length > 50 ? '...' : ''}</div>
                            <div style="font-size: 10px; color: #888;">${item.location} ‚Ä¢ ${item.groupName}</div>
                            ${statusIndicator}
                        </div>
                        <div class="timeline-bar-container">
                            <div class="timeline-bar ${groupClass} ${locationClass} ${statusClass}" style="${barStyle}" title="${item.order}: ${item.description} (${item.progress}%)">
                                <div class="timeline-progress" style="${progressStyle}"></div>
                                <span style="position: absolute; left: 8px; z-index: 5;">${barText}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            timelineHTML += '</div>';
            
            // Add summary with status breakdown including overdue
            const scheduledItems = allItems.filter(item => item.startDate && item.endDate).length;
            const completedItems = allItems.filter(item => item.progress >= 100).length;
            const overdueItems = allItems.filter(item => item.endDate && new Date(item.endDate) < currentTimelineDate && item.progress < 100).length;
            const inProgressItems = allItems.filter(item => item.progress > 0 && item.progress < 100 && !(item.endDate && new Date(item.endDate) < currentTimelineDate)).length;
            const notStartedItems = allItems.filter(item => item.progress === 0).length;
            const avgProgress = allItems.length > 0 ? Math.round(allItems.reduce((sum, item) => sum + item.progress, 0) / allItems.length) : 0;
            
            timelineHTML += `
                <div class="card">
                    <h3 style="margin-bottom: 15px;">üìä Status Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #007bff;">${allItems.length}</div>
                            <div style="font-size: 12px; color: #666;">Total Items</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;">${scheduledItems}</div>
                            <div style="font-size: 12px; color: #666;">Scheduled</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #1d4ed8;">${completedItems}</div>
                            <div style="font-size: 12px; color: #666;">‚úì Completed</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #22c55e;">${inProgressItems}</div>
                            <div style="font-size: 12px; color: #666;">üîÑ In Progress</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #dc2626;">${overdueItems}</div>
                            <div style="font-size: 12px; color: #666;">‚ö†Ô∏è Overdue</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #6b7280;">${notStartedItems}</div>
                            <div style="font-size: 12px; color: #666;">‚è≥ Not Started</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #8b5cf6;">${avgProgress}%</div>
                            <div style="font-size: 12px; color: #666;">Avg Progress</div>
                        </div>
                    </div>
                </div>
            `;
            
            timelineContent.innerHTML = timelineHTML;
        }
		
function adjustProgress(workItemId, change) {
    const currentProgress = getProgress(workItemId);
    const newProgress = Math.max(0, Math.min(100, currentProgress + change));
    
    const currentRemarks = getRemarks(workItemId);
    updateProgress(workItemId, newProgress, currentRemarks);
    renderWorkItems();
}
// Toggle today items function
function toggleTodayItems() {
    showTodayItems = !showTodayItems;
    const btn = document.getElementById('todayItemsBtn');
    
    if (showTodayItems) {
        btn.textContent = 'üìã Show All Items';
        btn.className = 'btn btn-primary';
    } else {
        btn.textContent = 'üìÖ Today\'s Focus';
        btn.className = 'btn btn-secondary';
    }
    
    renderWorkItems();
}

// Check if item is qualified for today's focus
function isTodayFocusItem(item) {
    const today = new Date(formData.date);
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    const startDate = getLineItemDate(item.id, 'startDate');
    const endDate = getLineItemDate(item.id, 'endDate');
    const currentProgress = getProgress(item.id);
    const completionDate = getCompletionDate(item.id);
    
    // Case 1: Items yang START hari ni
    if (startDate && new Date(startDate).toDateString() === today.toDateString()) {
        return true;
    }
    
    // Case 2: Items yang COMPLETED semalam
    if (completionDate && new Date(completionDate).toDateString() === yesterday.toDateString()) {
        return true;
    }
    
    // Case 3: Items yang BELUM SIAP sampai hari ni (overdue)
    if (endDate && currentProgress < 100 && new Date(endDate) <= today) {
        return true;
    }
    
    // Case 4: Items yang IN PROGRESS dan should be working today
    if (startDate && endDate && currentProgress > 0 && currentProgress < 100) {
        const itemStartDate = new Date(startDate);
        const itemEndDate = new Date(endDate);
        if (today >= itemStartDate && today <= itemEndDate) {
            return true;
        }
    }
    
    return false;
}

// Timeline date functions
function onTimelineDateChange() {
    timelineDate = document.getElementById('timelineDate').value;
    updateTimelineDayInfo();
    if (currentView === 'timeline') {
        renderTimeline();
    }
}

function setTimelineToToday() {
    timelineDate = new Date().toISOString().split('T')[0];
    document.getElementById('timelineDate').value = timelineDate;
    updateTimelineDayInfo();
    if (currentView === 'timeline') {
        renderTimeline();
    }
}

function setTimelineToSD() {
    timelineDate = formData.startSDDate;
    document.getElementById('timelineDate').value = timelineDate;
    updateTimelineDayInfo();
    if (currentView === 'timeline') {
        renderTimeline();
    }
}

function updateTimelineDayInfo() {
    const dayInfo = calculateSDDaysStatus(formData.startSDDate, formData.expectedEndDate, timelineDate);
    const infoElement = document.getElementById('timelineDayInfo');
    
    if (dayInfo.currentDay > 0) {
        infoElement.textContent = `Day ${dayInfo.currentDay} of ${dayInfo.totalDays} - ${dayInfo.text}`;
        infoElement.style.color = dayInfo.status === 'exceeded' ? '#dc2626' : '#666';
    } else {
        infoElement.textContent = 'Timeline date is before SD start';
        infoElement.style.color = '#f59e0b';
    }
}


        // Local storage functions
        function loadFromLocalStorage() {
            const savedProgress = localStorage.getItem('dailyProgress');
            if (savedProgress) {
                dailyProgress = JSON.parse(savedProgress);
            }

            const savedUpdates = localStorage.getItem('turnaroundUpdates');
            if (savedUpdates) {
                updates = JSON.parse(savedUpdates);
            }

            const savedDates = localStorage.getItem('lineItemDates');
            if (savedDates) {
                lineItemDates = JSON.parse(savedDates);
            }

            const savedCompletionDates = localStorage.getItem('completionDates');
            if (savedCompletionDates) {
                completionDates = JSON.parse(savedCompletionDates);
            }

            // Load form data
            const savedStartDate = localStorage.getItem('defaultStartDate');
            const savedEndDate = localStorage.getItem('defaultEndDate');
            if (savedStartDate) formData.startSDDate = savedStartDate;
            if (savedEndDate) formData.expectedEndDate = savedEndDate;
        }

        function saveToLocalStorage() {
            localStorage.setItem('dailyProgress', JSON.stringify(dailyProgress));
            localStorage.setItem('turnaroundUpdates', JSON.stringify(updates));
            localStorage.setItem('lineItemDates', JSON.stringify(lineItemDates));
            localStorage.setItem('completionDates', JSON.stringify(completionDates));
            localStorage.setItem('defaultStartDate', formData.startSDDate);
            localStorage.setItem('defaultEndDate', formData.expectedEndDate);
        }

        // Shared data functions
async function loadSharedData() {
    // ‚úÖ IF ELECTRON
    if (window.electronAPI && window.electronAPI.loadFromShare) {
        try {
            const data = await window.electronAPI.loadFromShare();
            if (!data || typeof data !== 'object') throw new Error('Invalid JSON format');
            applyLoadedData(data);
            showAlert('‚úÖ Shared data loaded from /share folder!', 'success');
        } catch (err) {
            showAlert('‚ùå Error loading shared data from Electron: ' + err.message, 'error');
        }
        return;
    }

    // üåê ELSE: Browser fallback - open file picker
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function (e) {
        const file = e.target.files[0];
        if (!file) {
            showAlert('‚ùå Please select a JSON file', 'error');
            return;
        }

        const reader = new FileReader();
        reader.onload = function (event) {
            try {
                const data = JSON.parse(event.target.result);
                applyLoadedData(data);
                showAlert('‚úÖ Shared data loaded from file!', 'success');
            } catch (err) {
                showAlert('‚ùå Error parsing JSON: ' + err.message, 'error');
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

function applyLoadedData(data) {
    if (data.dailyProgress) dailyProgress = data.dailyProgress;
    if (data.updates) updates = data.updates;
    if (data.completionDates) completionDates = data.completionDates;
    if (data.lineItemDates) lineItemDates = data.lineItemDates;

    if (data.currentFormData) {
        const d = data.currentFormData;
        document.getElementById('reviewDate').value = d.date || '';
        document.getElementById('startSDDate').value = d.startSDDate || '';
        document.getElementById('expectedEndDate').value = d.expectedEndDate || '';
        document.getElementById('platformPOB').value = d.platformPOB || '';
        document.getElementById('vesselPOB').value = d.vesselPOB || '';
        document.getElementById('hseIncidents').value = d.hseIncidents || 0;
        document.getElementById('hseNearMiss').value = d.hseNearMiss || 0;
        document.getElementById('hseSafetyObservations').value = d.hseSafetyObservations || 0;
        document.getElementById('logisticsRemarks').value = d.logisticsRemarks || '';
        document.getElementById('safetyRemarks').value = d.safetyRemarks || '';
        formData = { ...formData, ...d };
    }

    updateSDStatus();
    saveToLocalStorage();
    renderWorkItems();
    if (currentView === 'timeline') renderTimeline();
}

function saveSharedData() {
    // Capture current form data
    const currentFormData = {
        date: document.getElementById('reviewDate').value || formData.date,
        startSDDate: document.getElementById('startSDDate').value || formData.startSDDate,
        expectedEndDate: document.getElementById('expectedEndDate').value || formData.expectedEndDate,
        platformPOB: document.getElementById('platformPOB').value,
        vesselPOB: document.getElementById('vesselPOB').value,
        hseIncidents: parseInt(document.getElementById('hseIncidents').value) || 0,
        hseNearMiss: parseInt(document.getElementById('hseNearMiss').value) || 0,
        hseSafetyObservations: parseInt(document.getElementById('hseSafetyObservations').value) || 0,
        logisticsRemarks: document.getElementById('logisticsRemarks').value,
        safetyRemarks: document.getElementById('safetyRemarks').value
    };

    const data = {
        dailyProgress,
        updates,
        completionDates,
        lineItemDates,
        currentFormData,
        lastUpdated: new Date().toISOString(),
        version: '1.1'
    };

    const today = new Date().toISOString().split('T')[0];

    // üëâ If running in Electron, save using fs
    if (window.electronAPI && window.electronAPI.saveToShare) {
        window.electronAPI.saveToShare(data);
        showAlert('‚úÖ Data saved to /share folder (Electron mode)', 'success');
    } else {
        // üß≠ Fallback for browser
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `turnaround-shr-${today}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showAlert('‚úÖ Shared data saved (including current POB & remarks)', 'success');
    }
}

        function createBackup() {
            const data = {
                dailyProgress,
                updates,
                completionDates,
                lineItemDates,
                lastUpdated: new Date().toISOString(),
                version: '1.0'
            };
            
            const today = new Date().toISOString().split('T')[0];
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `turnaround-backup-${today}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert(`‚úÖ Backup created: turnaround-backup-${today}.json`, 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.dailyProgress) dailyProgress = data.dailyProgress;
                        if (data.updates) updates = data.updates;
                        if (data.completionDates) completionDates = data.completionDates;
                        if (data.lineItemDates) lineItemDates = data.lineItemDates;
                        
                        saveToLocalStorage();
                        renderWorkItems();
                        if (currentView === 'timeline') renderTimeline();
                        showAlert('‚úÖ Data imported successfully!', 'success');
                    } catch (err) {
                        showAlert('‚ùå Error importing data: ' + err.message, 'error');
                    }
                };
                reader.readAsText(file);
            }
        }

        function exportData() {
            const data = {
                dailyProgress,
                updates,
                completionDates,
                lineItemDates,
                lastUpdated: new Date().toISOString(),
                version: '1.0'
            };
            
            const today = new Date().toISOString().split('T')[0];
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `turnaround-data-export-${today}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('‚úÖ Data exported successfully!', 'success');
        }

        // Navigation
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('[id^="view-"]').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById('view-' + viewName).classList.remove('hidden');
            document.getElementById('nav-' + viewName).classList.add('active');
            
            currentView = viewName;
            
            // Load view-specific content
            if (viewName === 'timeline') {
                renderTimeline();
            } else if (viewName === 'history') {
                renderHistory();
            } else if (viewName === 'dashboard') {
                renderDashboard();
            } else if (viewName === 'scurve') {
                renderSCurve();
            }
        }

        // Work groups
        function populateWorkGroups() {
            const select = document.getElementById('workGroup');
            select.innerHTML = '';
            
            Object.keys(workItemsData).forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group;
                select.appendChild(option);
            });
            
            select.value = selectedWorkGroup;
        }

        function onWorkGroupChange() {
            selectedWorkGroup = document.getElementById('workGroup').value;
            renderWorkItems();
            updateReportDisplay();
        }

        // Date functions
        function onDateChange() {
            formData.date = document.getElementById('reviewDate').value;
            updateSDStatus();
            renderWorkItems();
            reportGenerated = false;
            updateReportDisplay();
        }

function updateDefaultDates() {
    formData.startSDDate = document.getElementById('startSDDate').value;
    formData.expectedEndDate = document.getElementById('expectedEndDate').value;
    updateSDStatus();
    
    // Save dates to localStorage
    localStorage.setItem('savedStartDate', formData.startSDDate);
    localStorage.setItem('savedEndDate', formData.expectedEndDate);
    saveToLocalStorage();
    
    // Update timeline if currently viewing
    if (currentView === 'timeline') {
        renderTimeline();
    }
}

        function calculateSDDaysStatus(startDate, expectedEndDate, currentDate) {
            if (!startDate || !expectedEndDate) return { currentDay: 0, totalDays: 0, status: 'normal', text: 'Pending dates' };
            
            const start = new Date(startDate);
            const end = new Date(expectedEndDate);
            const current = new Date(currentDate);
            
            const totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            const currentDay = Math.ceil((current - start) / (1000 * 60 * 60 * 24)) + 1;
            
            if (current > end) {
                const exceededDays = Math.ceil((current - end) / (1000 * 60 * 60 * 24));
                return { currentDay, totalDays, status: 'exceeded', text: `${exceededDays} days exceeded`, exceededDays };
            } else if (current.toDateString() === end.toDateString()) {
                return { currentDay, totalDays, status: 'final', text: 'Final day' };
            } else {
                const remainingDays = Math.ceil((end - current) / (1000 * 60 * 60 * 24));
                return { currentDay, totalDays, status: 'normal', text: `${remainingDays} days remaining` };
            }
        }

        function updateSDStatus() {
            const statusDiv = document.getElementById('sdStatus');
            const daysInfo = calculateSDDaysStatus(formData.startSDDate, formData.expectedEndDate, formData.date);
            
            statusDiv.className = `sd-status ${daysInfo.status}`;
            statusDiv.textContent = `Day ${daysInfo.currentDay} of ${daysInfo.totalDays} - ${daysInfo.text}`;
        }

        // Progress functions
function getProgress(workItemId, date = formData.date) {
    // If we have progress for this exact date, return it
    if (dailyProgress[date]?.[workItemId]) {
        return dailyProgress[date][workItemId].progress;
    }
    
    // Otherwise, find the latest progress before or on this date
    const targetDate = new Date(date);
    let latestProgress = 0;
    let latestDate = null;
    
    // Look through all dates in dailyProgress
    Object.keys(dailyProgress).forEach(progressDate => {
        const progressDateObj = new Date(progressDate);
        if (progressDateObj <= targetDate && dailyProgress[progressDate][workItemId]) {
            // Check if this is more recent than our current latest
            if (!latestDate || progressDateObj > new Date(latestDate)) {
                latestProgress = dailyProgress[progressDate][workItemId].progress;
                latestDate = progressDate;
            }
        }
    });
    
    return latestProgress;
}

function getRemarks(workItemId, date = formData.date) {
    // If we have remarks for this exact date, return it
    if (dailyProgress[date]?.[workItemId]) {
        return dailyProgress[date][workItemId].remarks || '';
    }
    
    // Otherwise, find the latest remarks before or on this date
    const targetDate = new Date(date);
    let latestRemarks = '';
    let latestDate = null;
    
    // Look through all dates in dailyProgress
    Object.keys(dailyProgress).forEach(progressDate => {
        const progressDateObj = new Date(progressDate);
        if (progressDateObj <= targetDate && dailyProgress[progressDate][workItemId]) {
            // Check if this is more recent than our current latest
            if (!latestDate || progressDateObj > new Date(latestDate)) {
                latestRemarks = dailyProgress[progressDate][workItemId].remarks || '';
                latestDate = progressDate;
            }
        }
    });
    
    return latestRemarks;
}

        function updateProgress(workItemId, progress, remarks = '') {
            if (!dailyProgress[formData.date]) {
                dailyProgress[formData.date] = {};
            }
            
            dailyProgress[formData.date][workItemId] = {
                progress: parseInt(progress),
                remarks,
                updatedAt: new Date().toISOString()
            };

            // Track completion date when item reaches 100%
            if (parseInt(progress) === 100 && !completionDates[workItemId]) {
                completionDates[workItemId] = formData.date;
            }
            
            saveToLocalStorage();
        }

        function getLineItemDate(workItemId, field) {
            return lineItemDates[workItemId]?.[field] || '';
        }

        function updateLineItemDate(workItemId, field, value) {
            if (!lineItemDates[workItemId]) {
                lineItemDates[workItemId] = {};
            }
            lineItemDates[workItemId][field] = value;
            saveToLocalStorage();
        }

        function getCompletionDate(workItemId) {
            return completionDates[workItemId] || null;
        }

        // Work items rendering
        function renderWorkItems() {
            const tbody = document.getElementById('workItemsBody');
            const currentWorkItems = workItemsData[selectedWorkGroup] || [];
            
            // Update title
            document.getElementById('workGroupTitle').textContent = `${selectedWorkGroup} - Work Items`;
            
// Filter items
const filteredItems = currentWorkItems.filter(item => {
    const currentProgress = getProgress(item.id);
    const startDate = getLineItemDate(item.id, 'startDate');
    
    // NEW: Today items filter
    if (showTodayItems && !isTodayFocusItem(item)) {
        return false;
    }
    
    // If showAllItems is true, show everything; otherwise filter by start date
    if (!showAllItems && !startDate) return false;
    
                // If not 100%, always show
                if (currentProgress < 100) return true;
                
                // If 100%, check completion date (only if has start date)
                if (startDate) {
                    const completedDate = completionDates[item.id];
                    if (!completedDate) return true; // No completion date recorded, show
                    
                    // Calculate days since completion
                    const completed = new Date(completedDate);
                    const today = new Date(formData.date);
                    const daysSinceCompletion = Math.floor((today - completed) / (1000 * 60 * 60 * 24));
                    
                    // Hide if completed more than 1 day ago (2+ days)
                    if (daysSinceCompletion > 1) return false;
                }
                
                // Apply search filter for remaining items
                return (
                    item.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.location.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.equipment.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.order.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.workCenter.toLowerCase().includes(searchTerm.toLowerCase())
                );
            });
            
// Show hidden items alert
const hiddenCount = currentWorkItems.length - filteredItems.length;
const alertDiv = document.getElementById('hiddenItemsAlert');
if (hiddenCount > 0) {
    let alertText = '';
    if (showTodayItems) {
        alertText = `üìÖ Today's Focus: Showing ${filteredItems.length} relevant items (${hiddenCount} others hidden)`;
    } else if (showAllItems) {
        alertText = `‚úÖ ${hiddenCount} item(s) hidden (completed 2+ days ago)`;
    } else {
        alertText = `üìã ${hiddenCount} item(s) hidden (no start date or completed 2+ days ago) - Click "Show All Items" to set start dates`;
    }
    alertDiv.textContent = alertText;
    alertDiv.classList.remove('hidden');
} else {
    if (showTodayItems) {
        alertDiv.textContent = 'üìÖ Today\'s Focus: All items shown are relevant for today';
        alertDiv.classList.remove('hidden');
    } else {
        alertDiv.classList.add('hidden');
    }
}
            
            // Update work group title with count
            document.getElementById('workGroupTitle').textContent = `${selectedWorkGroup} - Work Items (${filteredItems.length})`;
            
            tbody.innerHTML = '';
            
            filteredItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid #f0f0f0';
                
                const currentProgress = getProgress(item.id);
                const currentRemarks = getRemarks(item.id);
                const completionDate = getCompletionDate(item.id);
                const hasStartDate = getLineItemDate(item.id, 'startDate');
                
// Style differently if no start date
if (!hasStartDate) {
    tr.style.backgroundColor = '#f8f9fa';
    tr.style.opacity = '0.7';
}

// Special highlighting for today items
if (showTodayItems) {
    const today = new Date(formData.date);
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    // Highlight different types
    const startDate = getLineItemDate(item.id, 'startDate');
    const endDate = getLineItemDate(item.id, 'endDate');
    
    if (startDate && new Date(startDate).toDateString() === today.toDateString()) {
        tr.className = 'today-start'; // Starting today
    } else if (completionDate && new Date(completionDate).toDateString() === yesterday.toDateString()) {
        tr.className = 'today-completed'; // Completed yesterday
    } else if (endDate && currentProgress < 100 && new Date(endDate) <= today) {
        tr.className = 'today-overdue'; // Overdue
    } else {
        tr.className = 'today-progress'; // In progress today
    }
}
                
                tr.innerHTML = `
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 4px;">${item.order}</div>
                        <div style="font-size: 12px; color: #666;">${item.workCenter}</div>
                        ${!hasStartDate ? '<div style="font-size: 11px; color: #dc3545; font-weight: 500;">‚ö†Ô∏è No Start Date</div>' : ''}
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <div style="font-size: 14px; color: #333; margin-bottom: 4px;">${item.description}</div>
                        <div style="font-size: 12px; color: #666;">${item.equipment}</div>
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
<div class="progress-container">
    <div class="progress-arrow ${!hasStartDate || currentProgress <= 0 ? 'disabled' : ''}" 
         onclick="${!hasStartDate ? '' : `adjustProgress(${item.id}, -1)`}">‚óÄ</div>
    <input type="range" min="0" max="100" value="${currentProgress}" 
           class="progress-slider" ${!hasStartDate ? 'disabled' : ''}
           onchange="updateProgress(${item.id}, this.value, getRemarks(${item.id})); renderWorkItems();">
    <div class="progress-arrow ${!hasStartDate || currentProgress >= 100 ? 'disabled' : ''}" 
         onclick="${!hasStartDate ? '' : `adjustProgress(${item.id}, 1)`}">‚ñ∂</div>
    <span class="progress-value">${currentProgress}%</span>
</div>
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="status-badge ${getStatusBadgeClass(currentProgress)}">${getStatusText(currentProgress)}</span>
                            ${currentProgress === 100 && completionDate ? 
                                `<div style="font-size: 11px; color: #28a745; font-weight: 500; background-color: #d4edda; padding: 2px 6px; border-radius: 4px;">
                                    Completed: ${new Date(completionDate).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit' })}
                                 </div>` : ''
                            }
                        </div>
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <input type="date" value="${getLineItemDate(item.id, 'startDate')}" 
                               onchange="updateLineItemDate(${item.id}, 'startDate', this.value); renderWorkItems(); if (currentView === 'timeline') renderTimeline();"
                               style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; ${!hasStartDate ? 'border-color: #dc3545; background-color: #fff5f5;' : ''}">
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <input type="date" value="${getLineItemDate(item.id, 'endDate')}" 
                               onchange="updateLineItemDate(${item.id}, 'endDate', this.value); if (currentView === 'timeline') renderTimeline();"
                               style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </td>
                    <td style="padding: 16px 12px; vertical-align: top;">
                        <input type="text" placeholder="Remarks..." value="${currentRemarks}" ${!hasStartDate ? 'disabled' : ''}
                               onchange="updateProgress(${item.id}, getProgress(${item.id}), this.value)"
                               style="width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function getStatusBadgeClass(progress) {
            if (progress > 99) return 'status-completed';
            if (progress >= 5) return 'status-progress';
            if (progress > 0) return 'status-started';
            return 'status-not-started';
        }

        function getStatusText(progress) {
            if (progress >= 99) return 'Completed';
            if (progress >= 5) return 'In Progress';
            if (progress > 0) return 'Started';
            return 'Not Started';
        }

        function filterWorkItems() {
            searchTerm = document.getElementById('searchTerm').value;
            renderWorkItems();
        }

        // Toggle show all items function
        function toggleShowAll() {
            showAllItems = !showAllItems;
            const btn = document.getElementById('showAllBtn');
            if (showAllItems) {
                btn.textContent = 'üëÅÔ∏è Hide No-Date Items';
                btn.className = 'btn btn-primary';
            } else {
                btn.textContent = 'üìã Show All Items';
                btn.className = 'btn btn-secondary';
            }
            renderWorkItems();
        }

        // Save progress
        function saveAllProgress() {
            // Get form data
            formData.platformPOB = document.getElementById('platformPOB').value;
            formData.vesselPOB = document.getElementById('vesselPOB').value;
            formData.hseIncidents = parseInt(document.getElementById('hseIncidents').value) || 0;
            formData.hseNearMiss = parseInt(document.getElementById('hseNearMiss').value) || 0;
            formData.hseSafetyObservations = parseInt(document.getElementById('hseSafetyObservations').value) || 0;
            formData.logisticsRemarks = document.getElementById('logisticsRemarks').value;
            formData.safetyRemarks = document.getElementById('safetyRemarks').value;
            
            // Create individual updates for each work item with progress > 0
            const daysInfo = calculateSDDaysStatus(formData.startSDDate, formData.expectedEndDate, formData.date);
            const newUpdates = [];
            const currentWorkItems = workItemsData[selectedWorkGroup] || [];
            
Object.entries(dailyProgress[formData.date] || {}).forEach(([workItemId, progressData]) => {
    const workItem = currentWorkItems.find(item => item.id.toString() === workItemId);
    const hasStartDate = workItem && getLineItemDate(workItem.id, 'startDate');
    
    if (hasStartDate) {
        newUpdates.push({
            id: Date.now() + parseInt(workItemId),
            date: formData.date,
            startSDDate: formData.startSDDate,
            expectedEndDate: formData.expectedEndDate,
            workGroup: selectedWorkGroup,
            workItem: `${workItem.order} | ${workItem.description} | LOC: ${workItem.location} | EQUIPMENT: ${workItem.equipment}`,
            progressPct: progressData.progress,
            remarks: progressData.remarks,
            dayOfTA: daysInfo.currentDay,
            totalDays: daysInfo.totalDays,
            platformPOB: formData.platformPOB,
            vesselPOB: formData.vesselPOB,
            hseIncidents: formData.hseIncidents,
            hseNearMiss: formData.hseNearMiss,
            hseSafetyObservations: formData.hseSafetyObservations,
            logisticsRemarks: formData.logisticsRemarks,
            safetyRemarks: formData.safetyRemarks,
            createdAt: new Date().toISOString()
        });
    }
});
            
            if (newUpdates.length > 0) {
                updates = [...newUpdates, ...updates];
                saveToLocalStorage();
                showAlert(`‚úÖ Progress untuk ${Object.keys(dailyProgress[formData.date] || {}).length} work items berjaya disimpan!`, 'success');
            } else {
                showAlert('‚ÑπÔ∏è No progress to save', 'info');
            }
        }

        // Report generation
        function generateReport() {
            const report = generateBulkReport();
            document.getElementById('reportContent').textContent = report;
            
            reportGenerated = true;
            lastReportTime = new Date().toISOString();
            
            const statusSpan = document.getElementById('reportStatus');
            statusSpan.textContent = `‚úÖ Generated at ${new Date(lastReportTime).toLocaleTimeString()}`;
            statusSpan.classList.remove('hidden');
            
            // Auto-copy to clipboard
            navigator.clipboard.writeText(report).then(() => {
                showAlert('üìã Report generated and copied to clipboard!', 'success');
            });
        }

        function generateBulkReport() {
            const daysInfo = calculateSDDaysStatus(formData.startSDDate, formData.expectedEndDate, formData.date);
            
            // Get ALL items with start date from ALL groups FOR COUNTING
            let allItemsForCounting = [];
            let allItemsForDisplay = [];
            let allWorkCenters = new Set();
            
            Object.keys(workItemsData).forEach(groupName => {
                // First pass: Get ALL items with start date for counting
                const allGroupItems = workItemsData[groupName].filter(item => {
                    const startDate = getLineItemDate(item.id, 'startDate');
                    if (!startDate) return false;
                    
                    const progress = getProgress(item.id);
                    
                    // Apply same filtering logic as table for counting
                    if (progress >= 100) {
                        const completedDate = completionDates[item.id];
                        if (completedDate) {
                            const completed = new Date(completedDate);
                            const today = new Date(formData.date);
                            const daysSinceCompletion = Math.floor((today - completed) / (1000 * 60 * 60 * 24));
                            if (daysSinceCompletion > 1) return false;
                        }
                    }
                    
                    allWorkCenters.add(item.workCenter);
                    return true;
                });
                
                // Second pass: Filter for display (only progress > 1%)
                const displayGroupItems = allGroupItems.filter(item => {
                    const progress = getProgress(item.id);
                    return progress > 1; // NEW: Only show items with progress > 1%
                });
                
                // Add to counting array
                allItemsForCounting = [...allItemsForCounting, ...allGroupItems];
                
                // Add to display array only if has items to show
                if (displayGroupItems.length > 0) {
                    allItemsForDisplay.push({
                        groupName,
                        items: displayGroupItems
                    });
                }
            });

            // Use allItemsForCounting for statistics, allItemsForDisplay for showing items
            const totalActiveItems = allItemsForCounting.length;
            const avgProgress = totalActiveItems > 0 
                ? Math.round(allItemsForCounting.reduce((sum, item) => sum + getProgress(item.id), 0) / totalActiveItems)
                : 0;

            const currentDate = new Date(formData.date).toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });

            // Handle POB
            let pobText = 'üì≤';
            const platformPOB = parseInt(document.getElementById('platformPOB').value) || 0;
            const vesselPOB = parseInt(document.getElementById('vesselPOB').value) || 0;
            const totalPOB = platformPOB + vesselPOB;
            
            if (platformPOB > 0 || vesselPOB > 0) {
                if (platformPOB > 0 && vesselPOB > 0) {
                    pobText = `Platform ${platformPOB}, Vessel ${vesselPOB} (Total: ${totalPOB})`;
                } else if (platformPOB > 0) {
                    pobText = `Platform ${platformPOB} (Total: ${totalPOB})`;
                } else {
                    pobText = `Vessel ${vesselPOB} (Total: ${totalPOB})`;
                }
            }

            let message = `üìç IBA Daily SD Update ‚Äî Day ${daysInfo.currentDay}/${daysInfo.totalDays}
üóìÔ∏è Date: ${currentDate}
üë∑‚Äç‚ôÇÔ∏è POB: ${pobText}
üìä Currently Viewing: ${selectedWorkGroup}
üìà Progress Summary: ${totalActiveItems} work items active across all groups (${avgProgress}% avg progress)

üîß Key Activities:`;

            // Add items by group (ONLY SHOWING ITEMS WITH >1% PROGRESS)
            allItemsForDisplay.forEach(group => {
                message += `\n\nüìã ${group.groupName}:`;
                group.items.forEach(item => {
                    const progress = getProgress(item.id);
                    const remarks = getRemarks(item.id);
                    message += `\n‚Ä¢ ${item.order}: ${item.description} - ${progress}% complete`;
                    if (remarks) {
                        message += ` (${remarks})`;
                    }
                });
            });

            // HSE section
            const hseIncidents = parseInt(document.getElementById('hseIncidents').value) || 0;
            const hseNearMiss = parseInt(document.getElementById('hseNearMiss').value) || 0;
            const hseSafetyObservations = parseInt(document.getElementById('hseSafetyObservations').value) || 0;
            const totalHSE = hseIncidents + hseNearMiss + hseSafetyObservations;
            let hseStatus = '';
            if (totalHSE > 0) {
                hseStatus = `‚Ä¢ ${hseIncidents} incidents, ${hseNearMiss} near misses, ${hseSafetyObservations} UAUC updates reported`;
            } else {
                hseStatus = '‚Ä¢ No incidents reported, PTW & SIMOPs review ongoing';
            }

            const logisticsRemarks = document.getElementById('logisticsRemarks').value;
            const safetyRemarks = document.getElementById('safetyRemarks').value;

            message += `\n\nüì¶ Logistics / Support:`;
            if (logisticsRemarks) {
                message += `\n‚Ä¢ ${logisticsRemarks}`;
            } else {
                message += `\n‚Ä¢ Execution remained smooth and self-sufficient.`;
            }

            message += `\n\nüîí Safety & Compliance:`;
            if (safetyRemarks) {
                message += `\n‚Ä¢ ${safetyRemarks}`;
            } else {
                message += `\n${hseStatus}`;
                message += `\n‚Ä¢ Safety culture was proactively sustained in accordance with SIMOP and WMS, with effective Work Permit execution`;
            }

            message += `\n\nüìù Summary:
‚Ä¢ Total work items: ${totalActiveItems}
‚Ä¢ Work Group: ${Array.from(allWorkCenters).join(', ')}
‚Ä¢ Overall completion: ${avgProgress}%`;

            return message;
        }

        function updateReportDisplay() {
            if (!reportGenerated) {
                document.getElementById('reportContent').textContent = 'Click "Generate Report" to create daily update...';
                document.getElementById('reportStatus').classList.add('hidden');
            }
        }

        function copyReport() {
            const reportText = document.getElementById('reportContent').textContent;
            navigator.clipboard.writeText(reportText).then(() => {
                showAlert('üìã Report copied to clipboard!', 'success');
            });
        }

        // History rendering
        function renderHistory() {
            const historyContent = document.getElementById('historyContent');
            
            if (updates.length === 0) {
                historyContent.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z"/>
                        </svg>
                        <p style="color: #666; margin-bottom: 20px;">No updates submitted yet</p>
                        <button class="btn btn-primary" onclick="showView('bulk-update')">Submit First Update</button>
                    </div>
                `;
                return;
            }

            const historyHtml = updates.map(update => `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="color: ${getStatusIcon(parseInt(update.progressPct))};">
                                ${getStatusIconHtml(parseInt(update.progressPct))}
                            </div>
                            <div>
                                <h3 style="font-size: 16px; font-weight: 500; color: #333; margin: 0 0 4px 0;">${update.workItem}</h3>
                                <p style="font-size: 14px; color: #666; margin: 0;">
                                    ${update.date} - Day ${update.dayOfTA} of ${update.totalDays} - ${update.workGroup}
                                </p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 24px; font-weight: bold; color: #007bff;">${update.progressPct}%</span>
                            <p style="font-size: 12px; color: #666; margin: 0;">Progress</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">Remarks:</h4>
                        <p style="font-size: 14px; color: #666; margin: 0;">${update.remarks || 'No remarks'}</p>
                    </div>
                </div>
            `).join('');
            
            historyContent.innerHTML = historyHtml;
        }

        function getStatusIcon(progress) {
            if (progress >= 99) return '#22c55e';
            if (progress >= 5) return '#eab308';
            return '#ef4444';
        }

        function getStatusIconHtml(progress) {
            if (progress >= 99) return '‚úÖ';
            if (progress >= 50) return 'üü°';
            return 'üî¥';
        }

        // Dashboard rendering
        function renderDashboard() {
            const dashboardContent = document.getElementById('dashboardContent');
            
            if (updates.length === 0) {
                dashboardContent.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"/>
                        </svg>
                        <p style="color: #666; margin-bottom: 8px;">No data available for dashboard</p>
                        <p style="color: #666;">Submit some updates to see progress charts</p>
                    </div>
                `;
                return;
            }

            const totalUpdates = updates.length;
            const avgProgress = Math.round(updates.reduce((sum, update) => sum + parseInt(update.progressPct), 0) / updates.length);
            const latestUpdate = updates[0]?.date || 'N/A';
            const totalIncidents = updates.reduce((sum, update) => sum + (parseInt(update.hseIncidents) || 0), 0);

            dashboardContent.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Updates</h3>
                        <p class="value" style="color: #007bff;">${totalUpdates}</p>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Average Progress</h3>
                        <p class="value" style="color: #28a745;">${avgProgress}%</p>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Latest Update</h3>
                        <p class="value" style="color: #333; font-size: 18px;">${latestUpdate}</p>
                    </div>

                    <div class="stat-card">
                        <h3>HSE Summary</h3>
                        <p class="value" style="color: #fd7e14;">${totalIncidents} incidents</p>
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 20px; font-weight: bold; color: #333; margin-bottom: 20px;">
                        üìà S-Curve Progress Analysis
                    </h3>
                    <div class="chart-container">
                        <canvas id="dashboardChart"></canvas>
                    </div>
                </div>
            `;

            // Create S-Curve chart
            const ctx = document.getElementById('dashboardChart').getContext('2d');
            const scurveData = generateSCurveData();
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: scurveData.map(d => `Day ${d.day}`),
                    datasets: [{
                        label: 'Planned Progress',
                        data: scurveData.map(d => d.planned),
                        borderColor: '#8884d8',
                        backgroundColor: 'rgba(136, 132, 216, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    }, {
                        label: 'Actual Progress',
                        data: scurveData.map(d => d.actual),
                        borderColor: '#82ca9d',
                        backgroundColor: 'rgba(130, 202, 157, 0.1)',
                        borderWidth: 3,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Progress (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Turnaround Day'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // S-Curve rendering
        function renderSCurve() {
            const scurveContent = document.getElementById('scurveContent');
            
            if (updates.length === 0) {
                scurveContent.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
                        </svg>
                        <p style="color: #666; margin-bottom: 8px;">No progress data available</p>
                        <p style="color: #666;">Submit some updates to generate S-curve analysis</p>
                    </div>
                `;
                return;
            }

            const scurveData = generateSCurveData();
            const currentProgress = Math.max(...scurveData.map(d => d.actual));
            const expectedProgress = Math.round((new Date().getDate() / 25) * 100);

            scurveContent.innerHTML = `
                <div class="card" style="margin-bottom: 20px;">
                    <div class="chart-container">
                        <canvas id="scurveChart"></canvas>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h3 style="font-size: 16px; color: #333; margin-bottom: 15px;">Progress Analysis</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Current Progress:</span>
                                <span style="font-weight: 500;">${currentProgress}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #666;">Expected Progress:</span>
                                <span style="font-weight: 500;">${expectedProgress}%</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="font-size: 16px; color: #333; margin-bottom: 15px;">Legend</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 3px; background: #3b82f6; border-style: dashed;"></div>
                                <span style="color: #666;">Planned Progress</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 4px; background: #10b981;"></div>
                                <span style="color: #666;">Actual Progress</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Create S-Curve chart
            const ctx = document.getElementById('scurveChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: scurveData.map(d => d.day),
                    datasets: [{
                        label: 'Planned Progress',
                        data: scurveData.map(d => d.planned),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        borderDash: [8, 8],
                        fill: false,
                        pointRadius: 0
                    }, {
                        label: 'Actual Progress',
                        data: scurveData.map(d => d.actual),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 4,
                        fill: false,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#10b981',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Cumulative Progress (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Turnaround Day'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function generateSCurveData() {
            const days = Array.from({length: 25}, (_, i) => i + 1);
            const plannedProgress = days.map(day => ({
                day,
                planned: Math.min(100, (day / 25) * 100),
                actual: 0
            }));

            updates.forEach(update => {
                const dayIndex = parseInt(update.dayOfTA) - 1;
                if (dayIndex >= 0 && dayIndex < plannedProgress.length) {
                    plannedProgress[dayIndex].actual = Math.max(
                        plannedProgress[dayIndex].actual, 
                        parseInt(update.progressPct)
                    );
                }
            });

            return plannedProgress;
        }

        // Utility functions
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'error' ? 'danger' : type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '300px';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Initialize app
        function initApp() {
            // Load data from localStorage
            loadFromLocalStorage();
            
            // Set default dates
            document.getElementById('reviewDate').value = formData.date;
            document.getElementById('startSDDate').value = formData.startSDDate;
            document.getElementById('expectedEndDate').value = formData.expectedEndDate;
            document.getElementById('timelineDate').value = timelineDate;
            
            // Populate work groups dropdown
            populateWorkGroups();
            
            // Update UI
            updateSDStatus();
            updateTimelineDayInfo();
            renderWorkItems();
            
            console.log('IBA Turnaround App initialized successfully');
        }

        // Initialize app when page loads
        window.addEventListener('load', initApp);
		
    </script>
</body>
</html>