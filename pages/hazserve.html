<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Reporting System - Irong Barat A</title>
    
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Manrope:wght@600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #E3ECFF;
            min-height: 100vh;
        }

        /* ==================== LANDING PAGE ==================== */
        .landing-page {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 60px 20px 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .landing-header {
            text-align: center;
            margin-bottom: 50px;
            width: 100%;
        }

        .landing-header h1 {
            font-size: 36px;
            color: #2D3E66;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .landing-header .platform {
            font-size: 20px;
            color: #6B8DD6;
            font-weight: 500;
        }

        .landing-header .date-time {
            margin-top: 15px;
            font-size: 16px;
            color: #6b7280;
        }

        .module-cards {
            display: grid;
            grid-template-columns: repeat(3, 320px);
            justify-content: center;
            gap: 30px;
            width: 100%;
            padding: 0 20px;
        }

        .module-card {
            background: white;
            border-radius: 12px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid transparent;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(107, 141, 214, 0.3);
            border-color: #6B8DD6;
        }

        .module-card .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .module-card h2 {
            font-size: 24px;
            color: #2D3E66;
            margin-bottom: 10px;
        }

        .module-card p {
            color: #6b7280;
            font-size: 14px;
        }

        /* ==================== MODULE CONTAINER ==================== */
        .module-container {
            display: none;
            width: 77%;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .module-container.active {
            display: block;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #6B8DD6 0%, #8FA5DB 100%);
            color: white;
            padding: 30px 60px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 500;
        }

        .header .back-btn {
            background: white;
            border: 3px solid #00CED1;
            color: #1F2937;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 700;
            font-size: 14px;
        }

        .header .back-btn:hover {
            background: #E0FFFF;
            border-color: #00CED1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 206, 209, 0.4);
        }

        .platform-fixed {
            font-size: 16px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: #E3ECFF;
            border-bottom: 1px solid #B8C9F0;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #E3ECFF;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #4A5C8C;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #D4E0FA;
            color: #2D3E66;
        }

        .tab.active {
            background: white;
            color: #1f2937;
            border-bottom: 2px solid #6B8DD6;
        }

        /* Content */
        .content {
            display: none;
            padding: 60px;
        }

        .content.active {
            display: block;
        }

        /* Form Styling */
        .form-section {
            margin-bottom: 30px;
            padding: 30px;
            background: #F5F8FF;
            border-radius: 6px;
            border-left: 3px solid #6B8DD6;
        }

        .form-section h3 {
            color: #2D3E66;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #374151;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #B8C9F0;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6B8DD6;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Stock Alerts */
        .stock-alert-low {
            color: #dc2626;
            font-weight: bold;
        }

        .stock-alert-medium {
            color: #f59e0b;
            font-weight: bold;
        }

        .stock-alert-good {
            color: #10b981;
            font-weight: bold;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #6B8DD6;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5A7BC5;
        }

        .btn-success {
            background: #4A5C8C;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #3A4C7C;
        }

        .btn-secondary {
            background: #8FA5DB;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #7A93CC;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #d97706;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Info Box */
        .info-box {
            background: #F5F8FF;
            border-left: 3px solid #6B8DD6;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 13px;
        }

        .info-box strong {
            color: #2D3E66;
        }

        /* Case Cards (for UAUC) */
        .case-card, .equipment-item {
            background: white;
            border: 2px solid #E3ECFF;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .case-header, .equipment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E3ECFF;
        }

        .case-number {
            font-weight: bold;
            color: #2D3E66;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        /* Image Preview */
        .image-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #E3ECFF;
        }

        .preview-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Menu Input Grid */
        .menu-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #E3ECFF;
        }

        .menu-section h4 {
            color: #2D3E66;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 600;
        }

        .menu-items {
            display: grid;
            gap: 8px;
        }

        .menu-item-input {
            display: grid;
            grid-template-columns: 25px 1fr;
            gap: 8px;
            align-items: start;
            margin-bottom: 12px;
        }

        .menu-item-wrapper {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .menu-item-input span {
            color: #6b7280;
            font-size: 13px;
            font-weight: 600;
            padding-top: 8px;
        }

        .menu-item-input input {
            padding: 8px;
            border: 2px solid #B8C9F0;
            border-radius: 4px;
            font-size: 13px;
            width: 100%;
        }

        .menu-item-input input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        .menu-item-input input:focus {
            outline: none;
            border-color: #6B8DD6;
        }

        .menu-item-input input.match {
            border-color: #10b981;
            background: #d1fae5;
        }

        .menu-item-input input.different {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .menu-item-input input.empty {
            border-color: #d1d5db;
            background: #f9fafb;
        }

        .not-served-label {
            display: none;
            font-size: 11px;
            color: #ef4444;
            font-weight: 600;
            padding: 2px 8px;
            background: #fee2e2;
            border-radius: 3px;
            width: fit-content;
        }

        .not-served-label.show {
            display: block;
        }

        /* Comparison Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E3ECFF;
        }

        .modal-close {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .comparison-column h3 {
            background: #F5F8FF;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            color: #2D3E66;
        }

        .comparison-item {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
        }

        .comparison-item.match {
            background: #d1fae5;
            color: #065f46;
        }

        .comparison-item.different {
            background: #fee2e2;
            color: #991b1b;
        }

        /* History */
        .history-container {
            padding: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E3ECFF;
        }

        .history-list {
            display: grid;
            gap: 15px;
        }

        .history-item {
            background: #F5F8FF;
            border: 2px solid #E3ECFF;
            border-radius: 8px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            transition: all 0.3s;
        }

        .history-item:hover {
            border-color: #6B8DD6;
            box-shadow: 0 2px 8px rgba(107, 141, 214, 0.2);
        }

        .history-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .history-date {
            font-size: 16px;
            font-weight: 600;
            color: #2D3E66;
        }

        .history-stats {
            font-size: 13px;
            color: #6b7280;
        }

        .history-timestamp {
            font-size: 12px;
            color: #9ca3af;
        }

        .history-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .history-actions .btn {
            padding: 8px 16px;
            font-size: 13px;
        }

        .empty-history {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-history-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Presentation Mode */
        .presentation {
            background: white;
            min-height: calc(100vh - 200px);
        }

        .presentation-header {
            background: #6B8DD6;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .presentation-header h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .presentation-body {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .presentation-body.menu-layout {
            grid-template-columns: 1fr 1fr;
        }

        .stats-column {
            background: #F5F8FF;
            border: 1px solid #E3ECFF;
            border-radius: 6px;
            padding: 15px;
            height: fit-content;
        }

        .stats-highlight {
            background: #E3ECFF;
            font-size: 15px;
            font-weight: 600;
            color: #2D3E66;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            text-align: center;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .stats-table th,
        .stats-table td {
            border: 1px solid #B8C9F0;
            padding: 8px;
            text-align: center;
        }

        .stats-table th {
            background: #6B8DD6;
            color: white;
            font-weight: 600;
        }

        .cases-column, .menu-display {
            overflow-y: auto;
        }

        .case-display {
            margin-bottom: 15px;
            padding: 12px;
            background: #ffffff;
            border: 1px solid #E3ECFF;
            border-left: 3px solid #6B8DD6;
            border-radius: 4px;
        }

        .case-display.ua {
            border-left-color: #dc2626;
        }

        .case-display.uc {
            border-left-color: #f59e0b;
        }

        .case-type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 3px;
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 6px;
        }

        .ua-badge {
            background: #fee2e2;
            color: #991b1b;
        }

        .uc-badge {
            background: #fef3c7;
            color: #92400e;
        }

        .case-display h4 {
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 6px;
        }

        .case-display p {
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .case-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 6px;
            margin-top: 8px;
        }

        .case-images img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #E3ECFF;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .case-images img:hover {
            transform: scale(1.05);
            border-color: #6B8DD6;
        }

        /* Image Zoom Modal */
        .image-zoom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .image-zoom-modal.active {
            display: flex;
        }

        .image-zoom-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
            cursor: default;
        }

        .image-zoom-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            color: #1f2937;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            z-index: 10001;
        }

        .image-zoom-close:hover {
            background: #f3f4f6;
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 10001;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #E3ECFF;
            border-top: 4px solid #6B8DD6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .module-cards {
                grid-template-columns: 1fr;
                max-width: 400px;
                margin: 0 auto;
            }

            .module-card {
                width: 100%;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .presentation-body,
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .history-item {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== V&V MODULE STYLES ==================== */

        :root {
            --primary-bg: #F1FFFE;
            --secondary-bg: #ffffff;
            --accent-teal: #00ADA8;
            --accent-dark: #006D6A;
            --text-primary: #1A2B34;
            --text-secondary: #5A6C76;
            --text-light: #8B9BA6;
            --border-color: #D4E4E6;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar (Left) */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--accent-dark) 0%, var(--accent-teal) 100%);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            color: white;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 10px;
        }

        .logo h2 {
            font-family: 'Manrope', sans-serif;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 13px;
            opacity: 0.9;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section h3 {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .nav-btn {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .nav-btn.active {
            background: white;
            color: var(--accent-teal);
        }

        .stats-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: auto;
        }

        .stats-box h3 {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-item strong {
            font-weight: 700;
        }

        .footer-info {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 11px;
            line-height: 1.4;
            opacity: 0.8;
        }

        /* Main Content (Right) */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--secondary-bg);
            border-radius: 16px;
            border: 2px solid var(--accent-teal);
        }

        .header h1 {
            font-family: 'Manrope', sans-serif;
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            color: var(--text-secondary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: var(--secondary-bg);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-family: 'Manrope', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-badge {
            width: 32px;
            height: 32px;
            background: var(--accent-teal);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        /* Template Grid */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .template-card {
            background: var(--primary-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .template-card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 173, 168, 0.2);
        }

        .template-card.selected {
            border-color: var(--accent-teal);
            background: rgba(0, 173, 168, 0.05);
            box-shadow: 0 4px 12px rgba(0, 173, 168, 0.2);
        }

        .template-preview {
            height: 60px;
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preview-box {
            background: var(--accent-teal);
            border-radius: 3px;
            opacity: 0.3;
        }

        .template-card span {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
            display: block;
        }

        .template-badge {
            display: inline-block;
            background: var(--accent-teal);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 5px;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 3px rgba(0, 173, 168, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--primary-bg);
        }

        .upload-zone:hover {
            border-color: var(--accent-teal);
            background: rgba(0, 173, 168, 0.02);
        }

        .upload-zone.dragover {
            border-color: var(--accent-teal);
            background: rgba(0, 173, 168, 0.05);
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-preview-item {
            position: relative;
            aspect-ratio: 4/3;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: var(--danger-color);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-image:hover {
            background: #DC2626;
        }

        /* Observations */
        .obs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .obs-panel {
            background: var(--primary-bg);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid var(--border-color);
        }

        .obs-panel.positive {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .obs-panel.improvement {
            border-color: rgba(245, 158, 11, 0.3);
        }

        .obs-panel h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .obs-list {
            min-height: 100px;
            margin-bottom: 15px;
        }

        .obs-item {
            background: var(--secondary-bg);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .obs-item button {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
        }

        .add-obs {
            display: flex;
            gap: 8px;
        }

        .add-obs input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
        }

        .add-obs input:focus {
            outline: none;
            border-color: var(--accent-teal);
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-teal);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 173, 168, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-teal);
            color: var(--accent-teal);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        /* History Grid */
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .history-card {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 109, 106, 0.1);
        }

        .history-card h3 {
            font-family: 'Manrope', sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .history-meta {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .history-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--secondary-bg);
            border-radius: 16px;
            max-width: 95vw;
            max-height: 95vh;
            overflow: auto;
            position: relative;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--secondary-bg);
            z-index: 10;
        }

        .modal-body {
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        /* A4 Landscape Slide - FIXED SIZE */
        .slide-container {
            width: 1400px;
            height: 990px;
            margin: 0 auto;
            background: var(--primary-bg);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            overflow: hidden;
        }

        .slide {
            width: 100%;
            height: 100%;
            padding: 50px 60px;
            display: flex;
            flex-direction: column;
            background: var(--primary-bg);
        }

        .slide-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--accent-teal);
        }

        .slide h1 {
            font-family: 'Manrope', sans-serif;
            font-size: 38px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .slide-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .slide-body {
            flex: 1;
            display: flex;
            gap: 30px;
            overflow: hidden;
        }

        /* Image Areas */
        .slide-images {
            flex-shrink: 0;
            display: flex;
            gap: 15px;
        }

        .slide-image {
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Text Area */
        .slide-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }
        
        /* PDF Export Mode - No scroll, show all content */
        .pdf-export-mode .slide-text {
            overflow: visible !important;
            height: auto !important;
        }
        
        .pdf-export-mode .slide-container {
            height: auto !important;
            min-height: 990px;
        }
        
        .pdf-export-mode .slide {
            height: auto !important;
            min-height: 990px;
        }

        .slide-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 18px;
            border-left: 4px solid var(--accent-teal);
        }

        .slide-section h3 {
            font-family: 'Manrope', sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .slide-section p {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .slide-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .slide-section li {
            padding: 6px 0;
            font-size: 13px;
            line-height: 1.4;
            border-bottom: 1px solid var(--border-color);
        }

        .slide-section li:last-child {
            border-bottom: none;
        }

        .slide-section.positive {
            border-left-color: #10B981;
        }

        .slide-section.improvement {
            border-left-color: #F59E0B;
        }

        .slide-section.actions {
            border-left-color: #00ADA8;
        }

        .slide-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
            text-align: center;
            font-size: 11px;
            color: var(--text-light);
            line-height: 1.6;
        }

        .slide-footer div {
            margin: 2px 0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* File input hidden */
        input[type="file"] {
            display: none;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .form-grid,
            .obs-grid {
                grid-template-columns: 1fr;
            }

            .template-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .history-grid {
                grid-template-columns: 1fr;
            }

            .slide-container {
                width: 100%;
                height: auto;
                aspect-ratio: 1400/990;
            }
        }
        </style>
</head>
<body>
    <!-- LANDING PAGE -->
    <div class="landing-page" id="landingPage">
        <div class="landing-header">
            <h1>üèóÔ∏è DAILY REPORTING SYSTEM</h1>
            <p class="platform">Irong Barat A (IBA)</p>
            <p class="date-time" id="landingDateTime"></p>
        </div>

        <div class="module-cards">
            <div class="module-card" onclick="openModule('uauc')">
                <div class="icon">üìã</div>
                <h2>UAUC HIGHLIGHT</h2>
                <p>Unsafe Act & Unsafe Condition Daily Analysis</p>
            </div>

            <div class="module-card" onclick="openModule('catering')">
                <div class="icon">üçΩÔ∏è</div>
                <h2>CATERING SERVICES</h2>
                <p>Food Stock Status & Daily Menu Management</p>
            </div>
            <div class="module-card" onclick="openModule('vv')">
                <div class="icon">‚úì</div>
                <h2>V&V REPORTS</h2>
                <p>Verification & Validation</p>
            </div>
        </div>
    </div>


    <!-- ==================== V&V MODULE ==================== -->
    <div class="module-container" id="vvModule">
        <div class="header">
            <div>
                <h1>‚úì V&V EXECUTIVE BRIEF</h1>
                <p style="font-size: 14px; opacity: 0.9;">Verification & Validation Reports</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span class="platform-fixed">Irong Barat A, B, C</span>
                <button class="back-btn" onclick="backToLanding()">‚Üê Back to Home</button>
            </div>
        </div>
        
        <!-- V&V Content Wrapper -->
        <div style="display: flex; width: 100%; min-height: calc(100vh - 80px);">
<!-- Sidebar (Left) -->
    <div class="sidebar">
        <div class="logo">
            <h2>V&V Brief</h2>
            <p>Executive Reporter</p>
        </div>

        <div class="nav-section">
            <h3>Navigation</h3>
            <button class="nav-btn active" id="createNavBtn" onclick="switchTab('create')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                Create Report
            </button>
            <button class="nav-btn" id="historyNavBtn" onclick="switchTab('history')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                    <path d="M12 7v5l4 2"/>
                </svg>
                History
            </button>
        </div>

        <div class="nav-section">
            <h3>Data Management</h3>
            <button class="nav-btn" onclick="exportToJSON()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export JSON
            </button>
            <button class="nav-btn" onclick="document.getElementById('jsonInput').click()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import JSON
            </button>
            <input type="file" id="jsonInput" accept=".json">
        </div>

        <div class="stats-box">
            <h3>Quick Stats</h3>
            <div class="stat-item">
                <span>Total Reports:</span>
                <strong id="totalReports">0</strong>
            </div>
            <div class="stat-item">
                <span>This Week:</span>
                <strong id="weekReports">0</strong>
            </div>
            <div class="stat-item">
                <span>Storage:</span>
                <strong id="storageSize">0 KB</strong>
            </div>
        </div>

        <div class="footer-info">
            ¬© 2026 Aziz Mohamad<br>
            Enterprise Solutions Division
        </div>
    </div>

    <!-- Main Content (Right) -->
    <div class="main-content">
        <div class="header">
            <h1>V&V Executive Brief</h1>
            <p>Verification & Validation Reporter</p>
        </div>

        <!-- Create Tab -->
        <div id="createTab" class="tab-content active">
            <!-- Step 1: Template Selection -->
            <div class="section">
                <h2 class="section-title">
                    <span class="step-badge">1</span>
                    Select Template Layout
                </h2>
                <div class="template-grid" id="templateGrid"></div>
            </div>

            <!-- Step 2: Report Details -->
            <div class="section">
                <h2 class="section-title">
                    <span class="step-badge">2</span>
                    Report Details
                </h2>
                <div class="form-grid">
                    <div class="form-group full">
                        <label for="vvTitle">V&V Activity Title *</label>
                        <input type="text" id="vvTitle" placeholder="e.g., Hot Work - General Fabrication">
                    </div>
                    <div class="form-group">
                        <label for="vvDate">V&V Date *</label>
                        <input type="date" id="vvDate" required>
                    </div>
                    <div class="form-group">
                        <label for="location">Location *</label>
                        <select id="location">
                            <option value="">Select Platform</option>
                            <option value="Irong Barat A">Irong Barat A</option>
                            <option value="Irong Barat B">Irong Barat B</option>
                            <option value="Irong Barat C">Irong Barat C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="permitNo">Permit No. (Optional)</label>
                        <input type="text" id="permitNo" placeholder="e.g., PTW#504054">
                    </div>
                    <div class="form-group full">
                        <label for="workDesc">Work Description *</label>
                        <textarea id="workDesc" placeholder="Describe the work activity..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Step 3: Upload Images -->
            <div class="section">
                <h2 class="section-title">
                    <span class="step-badge">3</span>
                    Upload Images
                    <span style="margin-left: auto; font-size: 14px; color: var(--text-light);" id="imageCount">0 images</span>
                </h2>
                <div class="upload-zone" id="uploadZone">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <p>Click to upload or drag images here</p>
                    <span style="font-size: 13px; color: var(--text-light);">Max 3 images, JPG/PNG</span>
                </div>
                <input type="file" id="imageInput" accept="image/*" multiple>
                <div class="image-preview-grid" id="imagePreviewGrid"></div>
            </div>

            <!-- Step 4: Observations -->
            <div class="section">
                <h2 class="section-title">
                    <span class="step-badge">4</span>
                    Observations & Findings
                </h2>
                <div class="obs-grid">
                    <div class="obs-panel positive">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            Positive Observations
                        </h3>
                        <div class="obs-list" id="positiveList"></div>
                        <div class="add-obs">
                            <input type="text" id="positiveInput" placeholder="Add positive observation...">
                            <button class="btn btn-primary btn-small" onclick="addObservation('positive')">Add</button>
                        </div>
                    </div>

                    <div class="obs-panel improvement">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Areas of Improvement
                        </h3>
                        <div class="obs-list" id="improvementList"></div>
                        <div class="add-obs">
                            <input type="text" id="improvementInput" placeholder="Add area of improvement...">
                            <button class="btn btn-primary btn-small" onclick="addObservation('improvement')">Add</button>
                        </div>
                    </div>
                </div>

                <div class="form-group full" style="margin-top: 20px;">
                    <label for="actions">Recommended Actions (Optional)</label>
                    <textarea id="actions" placeholder="Enter recommended corrective actions..."></textarea>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="previewReport()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Preview
                </button>
                <button class="btn btn-primary" onclick="saveReport()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Report
                </button>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyTab" class="tab-content">
            <div class="section">
                <h2 class="section-title">Report History</h2>
                <div class="history-grid" id="historyGrid"></div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Report Preview - A4 Landscape</h2>
                <div style="display: flex; align-items: center;">
                    <div class="modal-actions">
                        <button class="btn btn-secondary btn-small" onclick="exportToPDF()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            Export PDF
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="exportToImage()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            Export Image
                        </button>
                    </div>
                    <button class="close-modal" onclick="closePreview()">&times;</button>
                </div>
            </div>
            <div class="modal-body" id="previewContainer"></div>
        </div>
    </div>
        </div>
    </div>

    <!-- UAUC MODULE -->
    <div class="module-container" id="uaucModule">
        <div class="header">
            <div>
                <h1>üìã UAUC HIGHLIGHT</h1>
                <p style="font-size: 14px; opacity: 0.9;">Unsafe Act & Unsafe Condition Analysis</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span class="platform-fixed">Irong Barat A (IBA)</span>
                <button class="back-btn" onclick="backToLanding()">‚Üê Back</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchModuleTab('uauc', 'input')">üìù Input Data</button>
            <button class="tab" onclick="switchModuleTab('uauc', 'presentation')">üì∫ Presentation</button>
            <button class="tab" onclick="switchModuleTab('uauc', 'history')">üìÅ History</button>
        </div>

        <!-- UAUC Input Tab -->
        <div id="uaucInput" class="content active">
            <div class="info-box">
                <strong>üìå Quick Guide:</strong> Fill in statistics, add up to 3 UAUC cases, attach images, then save or generate PDF.
            </div>

            <div class="form-section">
                <h3>üìä Unsafe Act Unsafe Condition (UAUC) Statistics</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date: <span style="color: red;">*</span></label>
                        <input type="date" id="uaucDate" required onchange="clearUAUCForm()">
                    </div>
                    <div class="form-group">
                        <label>Total UAUC (Auto):</label>
                        <input type="number" id="uaucTotal" readonly style="background: #E3ECFF;">
                    </div>
                    <div class="form-group">
                        <label>Stop Work (SW):</label>
                        <input type="number" id="uaucSW" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                    <div class="form-group">
                        <label>Safety Observation (SO):</label>
                        <input type="number" id="uaucSO" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>UA - PCSB:</label>
                        <input type="number" id="uaucUAPCSB" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                    <div class="form-group">
                        <label>UA - PARTNER:</label>
                        <input type="number" id="uaucUAPartner" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                    <div class="form-group">
                        <label>UC - PCSB:</label>
                        <input type="number" id="uaucUCPCSB" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                    <div class="form-group">
                        <label>UC - PARTNER:</label>
                        <input type="number" id="uaucUCPartner" value="0" min="0" oninput="calculateUAUCTotal()">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìã UAUC Cases (Max 3)</h3>
                <div id="uaucCasesContainer"></div>
                <button class="btn btn-primary" onclick="addUAUCCase()" id="addUAUCCaseBtn">‚ûï Add Case</button>
            </div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveUAUCReport()">üíæ Save Report</button>
                <button class="btn btn-secondary" onclick="switchModuleTab('uauc', 'history')">üìÅ View History</button>
                <button class="btn btn-primary" onclick="switchModuleTab('uauc', 'presentation')">üëÅÔ∏è Preview</button>
                <button class="btn btn-success" onclick="generateUAUCPDF()">üìÑ Generate PDF</button>
            </div>
        </div>

        <!-- UAUC Presentation Tab -->
        <div id="uaucPresentation" class="content">
            <div class="presentation">
                <div class="presentation-header">
                    <h2>DAILY UNSAFE ACT UNSAFE CONDITION (UAUC) ANALYSIS</h2>
                    <p id="uaucPressDate">IRONG BARAT A | 03 JAN 2026</p>
                </div>
                <div class="presentation-body">
                    <div class="stats-column">
                        <div class="stats-highlight">Total: <span id="uaucPressTotal">0</span> | SW: <span id="uaucPressSW">0</span> | SO: <span id="uaucPressSO">0</span></div>
                        <h3 style="margin-top: 10px; margin-bottom: 10px; color: #2D3E66;">BREAKDOWN</h3>
                        <table class="stats-table">
                            <tr>
                                <th></th>
                                <th>PCSB</th>
                                <th>PARTNER</th>
                            </tr>
                            <tr>
                                <td><strong>UA</strong></td>
                                <td id="uaucPressUAPCSB">0</td>
                                <td id="uaucPressUAPartner">0</td>
                            </tr>
                            <tr>
                                <td><strong>UC</strong></td>
                                <td id="uaucPressUCPCSB">0</td>
                                <td id="uaucPressUCPartner">0</td>
                            </tr>
                        </table>
                    </div>
                    <div class="cases-column" id="uaucPressCases"></div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="switchModuleTab('uauc', 'input')">‚Üê Back</button>
                    <button class="btn btn-success" onclick="generateUAUCPDF()">üìÑ Generate PDF</button>
                </div>
            </div>
        </div>

        <!-- UAUC History Tab -->
        <div id="uaucHistory" class="content">
            <div class="history-container">
                <div class="history-header">
                    <h3>üìÅ UAUC Reports History</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="uploadUAUCJSON()">üìÇ Upload JSON</button>
                        <button class="btn btn-danger" onclick="clearUAUCHistory()">üóëÔ∏è Clear All</button>
                    </div>
                </div>
                <div class="info-box">
                    <strong>üí° Tips:</strong> Reports saved automatically. Load to edit or generate PDFs.
                </div>
                <div id="uaucHistoryList" class="history-list"></div>
                <div id="uaucEmptyHistory" class="empty-history" style="display: none;">
                    <div class="empty-history-icon">üì≠</div>
                    <p><strong>No UAUC reports yet</strong></p>
                    <p style="margin-top: 10px;">Create and save a report to see it here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- CATERING MODULE -->
    <div class="module-container" id="cateringModule">
        <div class="header">
            <div>
                <h1>üçΩÔ∏è CATERING SERVICES</h1>
                <p style="font-size: 14px; opacity: 0.9;">Food Stock Status & Daily Menu Management</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span class="platform-fixed">Irong Barat A (IBA)</span>
                <button class="back-btn" onclick="backToLanding()">‚Üê Back</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchModuleTab('catering', 'stock')">üì¶ Food Stock</button>
            <button class="tab" onclick="switchModuleTab('catering', 'menu')">üçΩÔ∏è Daily Menu</button>
            <button class="tab" onclick="switchModuleTab('catering', 'presentation')">üì∫ Presentation</button>
            <button class="tab" onclick="switchModuleTab('catering', 'history')">üìÅ History</button>
        </div>

        <!-- Food Stock Tab -->
        <div id="cateringStock" class="content active">
            <div class="info-box">
                <strong>üìå Quick Guide:</strong> Update stock levels, shipment info, and equipment status. Stock < 9 days shows red alert!
            </div>

            <div class="form-section">
                <h3>üì¶ Stock Levels</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="copyPreviousDayStock()">üìã Copy Previous Day</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date: <span style="color: red;">*</span></label>
                        <input type="date" id="stockDate" required onchange="clearStockForm()">
                    </div>
                    <div class="form-group"></div>
                    <div class="form-group">
                        <label>Chiller (days):</label>
                        <input type="number" id="stockChiller" value="0" min="0" oninput="updateStockAlerts()">
                        <span id="alertChiller" class="stock-alert-good"></span>
                    </div>
                    <div class="form-group">
                        <label>Freezer (days):</label>
                        <input type="number" id="stockFreezer" value="0" min="0" oninput="updateStockAlerts()">
                        <span id="alertFreezer" class="stock-alert-good"></span>
                    </div>
                    <div class="form-group">
                        <label>Dry Food (days):</label>
                        <input type="number" id="stockDryFood" value="0" min="0" oninput="updateStockAlerts()">
                        <span id="alertDryFood" class="stock-alert-good"></span>
                    </div>
                    <div class="form-group">
                        <label>Non Food (days):</label>
                        <input type="number" id="stockNonFood" value="0" min="0" oninput="updateStockAlerts()">
                        <span id="alertNonFood" class="stock-alert-good"></span>
                    </div>
                    <div class="form-group">
                        <label>RO Water (qty | days):</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="stockROQty" placeholder="Qty" value="0" min="0" style="flex: 1;">
                            <input type="number" id="stockRODays" placeholder="Days" value="0" min="0" oninput="updateStockAlerts()" style="flex: 1;">
                        </div>
                        <span id="alertRO" class="stock-alert-good"></span>
                    </div>
                    <div class="form-group">
                        <label>Mineral Water (qty | days):</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="stockMineralQty" placeholder="Qty" value="0" min="0" style="flex: 1;">
                            <input type="number" id="stockMineralDays" placeholder="Days" value="0" min="0" oninput="updateStockAlerts()" style="flex: 1;">
                        </div>
                        <span id="alertMineral" class="stock-alert-good"></span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üö¢ Incoming Shipment</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Type:</label>
                        <select id="shipIncomingType">
                            <option value="">Select...</option>
                            <option value="Chiller/Freezer/Dry/Non-Food">Chiller/Freezer/Dry/Non-Food</option>
                            <option value="Chiller/Freezer/Dry">Chiller/Freezer/Dry</option>
                            <option value="Chiller/Dry">Chiller/Dry</option>
                            <option value="Chiller/Freezer">Chiller/Freezer</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ETD:</label>
                        <input type="date" id="shipIncomingETD">
                    </div>
                    <div class="form-group">
                        <label>ETA:</label>
                        <input type="date" id="shipIncomingETA">
                    </div>
                    <div class="form-group">
                        <label>Boat:</label>
                        <input type="text" id="shipIncomingBoat" placeholder="e.g., JM GEMILANG">
                    </div>
                    <div class="form-group full-width">
                        <label>Status:</label>
                        <input type="text" id="shipIncomingStatus" placeholder="e.g., Last location, En route">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üö¢ Next Shipment</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Type:</label>
                        <select id="shipNextType">
                            <option value="">Select...</option>
                            <option value="Chiller/Freezer/Dry/Non-Food">Chiller/Freezer/Dry/Non-Food</option>
                            <option value="Chiller/Freezer/Dry">Chiller/Freezer/Dry</option>
                            <option value="Chiller/Dry">Chiller/Dry</option>
                            <option value="Chiller/Freezer">Chiller/Freezer</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ETD:</label>
                        <input type="date" id="shipNextETD">
                    </div>
                    <div class="form-group">
                        <label>ETA:</label>
                        <input type="date" id="shipNextETA">
                    </div>
                    <div class="form-group">
                        <label>Boat:</label>
                        <input type="text" id="shipNextBoat" placeholder="e.g., JM GEMILANG">
                    </div>
                    <div class="form-group full-width">
                        <label>Status:</label>
                        <input type="text" id="shipNextStatus" placeholder="e.g., Scheduled, Pending">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>‚ö†Ô∏è Critical Equipment</h3>
                <div id="equipmentContainer"></div>
                <button class="btn btn-warning" onclick="addEquipmentIssue()">‚ûï Add Equipment Issue</button>
            </div>

            <!-- Save buttons removed - see combined button at bottom -->
        </div>

        <!-- Daily Menu Tab -->
        <div id="cateringMenu" class="content">
            <div class="info-box">
                <strong>üìå Quick Guide:</strong> Enter today's menu manually. Contract menu items appear as grey placeholder text in each field. Empty fields will be marked as "Not Served". Use "Compare to Contract" to verify compliance with contract menu.
                <br><br>
                <strong>‚ÑπÔ∏è Note:</strong> Western Breakfast items (Bread/Toast, Eggs to order, Baked beans, Pancakes, Bacon/Sausages, Cereals, Salad & Fruits) are standard daily items and do not need to be entered - they are always available as per contract.
                <br><br>
                <strong>üé® Color Codes:</strong> üü¢ GREEN = Matches contract | üü° YELLOW = Not in contract | ‚ö™ GREY = Empty/Not served
            </div>

            <div class="form-section">
                <h3>üçΩÔ∏è Menu Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Presentation Date: <span style="color: red;">*</span></label>
                        <input type="date" id="menuPresentationDate" required onchange="updateMenuDateForTomorrow()">
                    </div>
                    <div class="form-group">
                        <label>Menu Date (Tomorrow): <span style="color: red;">*</span></label>
                        <input type="date" id="menuDate" required onchange="clearMenuForm(); updateContractDay()">
                    </div>
                    <div class="form-group">
                        <label>Chef:</label>
                        <input type="text" id="menuChef" value="Chef Cook" placeholder="Chef name">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Contract:</label>
                        <select id="menuContract" onchange="updateContractDay()">
                            <option value="Contract 01 - 2026">Contract 01 - 2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Contract Day (Auto):</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="text" id="menuContractDay" readonly style="background: #E3ECFF; flex: 1;">
                            <select id="menuContractDayOverride" style="flex: 1;" onchange="overrideContractDay()">
                                <option value="">Override...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn btn-warning" onclick="compareToContract()" style="margin-top: 10px;">üìã Compare to Contract Menu</button>
            </div>

            <!-- Menu Sections -->
            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">BREAKFAST - EASTERN - 11 items (varies daily)</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuBreakfast')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuBreakfast"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">MORNING TEA BREAK (9AM) - 4 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuTeaBreak')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuTeaBreak"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">LUNCH - EASTERN - 11 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuLunch')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuLunch"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">LUNCH - WESTERN - 4 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuLunchWestern')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuLunchWestern"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">DINNER - EASTERN - 11 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuDinner')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuDinner"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">DINNER - WESTERN - 4 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuDinnerWestern')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuDinnerWestern"></div>
            </div>

            <div class="menu-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">SUPPER (9PM) - 3 items</h4>
                    <button class="btn btn-secondary" style="padding: 5px 12px; font-size: 12px;" onclick="pasteMenuSection('menuSupper')">üìã Paste All</button>
                </div>
                <div class="menu-items" id="menuSupper"></div>
            </div>

            <!-- Save buttons removed - see combined button at bottom -->
        </div>

        <!-- Catering Presentation Tab -->
        <div id="cateringPresentation" class="content">
            <div class="presentation">
                <div class="presentation-header">
                    <h2>CATERING SERVICES STATUS</h2>
                    <p id="cateringPressDate">IRONG BARAT A | 03 JAN 2026</p>
                </div>
                <div class="presentation-body" style="grid-template-columns: 1fr 1fr 1fr;">
                    <!-- Column 1: Stock Status -->
                    <div class="stats-column" id="cateringPressStock">
                        <h3 style="margin-bottom: 10px; color: #2D3E66;">STOCK STATUS</h3>
                        <!-- Stock details will be inserted here -->
                    </div>
                    <!-- Column 2: Morning & Lunch Menu -->
                    <div class="menu-display" id="cateringPressMenu1">
                        <h3 style="margin-bottom: 10px; color: #2D3E66;">MORNING & LUNCH</h3>
                        <!-- Menu details will be inserted here -->
                    </div>
                    <!-- Column 3: Dinner & Supper Menu -->
                    <div class="menu-display" id="cateringPressMenu2">
                        <h3 style="margin-bottom: 10px; color: #2D3E66;">DINNER & SUPPER</h3>
                        <!-- Menu details will be inserted here -->
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="switchModuleTab('catering', 'stock')">‚Üê Back</button>
                    <button class="btn btn-success" onclick="generateCateringPDF()">üìÑ Generate PDF</button>
                </div>
            </div>
        </div>

        <!-- Catering History Tab -->
        <div id="cateringHistory" class="content">
            <div class="history-container">
                <div class="history-header">
                    <h3>üìÅ Catering Reports History</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="uploadCateringJSON()">üìÇ Upload JSON</button>
                        <button class="btn btn-danger" onclick="clearCateringHistory()">üóëÔ∏è Clear All</button>
                    </div>
                </div>
                <div class="info-box">
                    <strong>üí° Tips:</strong> Stock and menu reports saved together per date.
                </div>
                <div id="cateringHistoryList" class="history-list"></div>
                <div id="cateringEmptyHistory" class="empty-history" style="display: none;">
                    <div class="empty-history-icon">üì≠</div>
                    <p><strong>No catering reports yet</strong></p>
                    <p style="margin-top: 10px;">Create and save reports to see them here</p>
                </div>
            </div>
        </div>

        <!-- COMBINED SAVE BUTTON (Sticky Footer) -->
        <div style="position: sticky; bottom: 0; background: white; padding: 20px; border-top: 2px solid #E3ECFF; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100;">
            <div class="action-buttons" style="margin: 0;">
                <button class="btn btn-success" onclick="saveCombinedCateringReport()" style="flex: 1; font-size: 16px; padding: 12px;">
                    üíæ Save Catering Report (Stock + Menu)
                </button>
                <button class="btn btn-secondary" onclick="switchModuleTab('catering', 'history')">üìÅ View History</button>
                <button class="btn btn-primary" onclick="switchModuleTab('catering', 'presentation')">üëÅÔ∏è Preview</button>
                <button class="btn btn-success" onclick="generateCateringPDF()">üìÑ Generate PDF</button>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div class="modal-overlay" id="comparisonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Menu Comparison Result</h2>
                <button class="modal-close" onclick="closeComparisonModal()">‚úï Close</button>
            </div>
            <div id="comparisonContent"></div>
        </div>
    </div>

    <!-- Paste Menu Modal -->
    <div class="modal-overlay" id="pasteMenuModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="pasteMenuTitle">üìã Paste Menu Items</h2>
                <button class="modal-close" onclick="closePasteMenuModal()">‚úï Close</button>
            </div>
            <div style="padding: 20px;">
                <div class="info-box" style="margin-bottom: 15px;">
                    <strong>üìù Format Options:</strong><br>
                    <strong>1. One item per line:</strong><br>
                    <span style="font-family: monospace; font-size: 12px; display: block; margin: 5px 0 10px 20px;">
                        Nasi lemak<br>
                        Rendang ayam<br>
                        Sambal ikan bilis
                    </span>
                    <strong>2. Comma separated:</strong><br>
                    <span style="font-family: monospace; font-size: 12px; display: block; margin: 5px 0 0 20px;">
                        Nasi lemak, Rendang ayam, Sambal ikan bilis
                    </span>
                </div>
                <div class="form-group">
                    <label><strong>Paste your menu items below:</strong></label>
                    <textarea id="pasteMenuTextarea" placeholder="Paste menu items here..." style="width: 100%; min-height: 200px; padding: 10px; border: 2px solid #6B8DD6; border-radius: 4px; font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px;"></textarea>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="closePasteMenuModal()">‚úï Cancel</button>
                    <button class="btn btn-success" onclick="processPastedMenu()">‚úÖ Apply Menu Items</button>
                </div>
            </div>
        </div>
    </div>

    <!-- IMAGE ZOOM MODAL -->
    <div class="image-zoom-modal" id="imageZoomModal" onclick="closeImageZoom()">
        <button class="image-zoom-close" onclick="event.stopPropagation(); closeImageZoom()">‚úï Close</button>
        <img id="zoomedImage" src="" alt="Zoomed image" onclick="event.stopPropagation()">
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText">Processing...</p>
        </div>
    </div>

    <script>
        // ==================== GLOBAL STATE ====================
        let currentModule = null;
        let uaucCaseCount = 0;
        let uaucCaseImages = {};
        let equipmentCount = 0;
        let currentPasteSection = null; // Track which section is being pasted
        
        const MAX_UAUC_CASES = 3;
        const STOCK_ALERT_THRESHOLD = 9;

        // ==================== IMAGE ZOOM FUNCTIONS ====================
        function openImageZoom(imageSrc) {
            document.getElementById('zoomedImage').src = imageSrc;
            document.getElementById('imageZoomModal').classList.add('active');
            // Prevent body scroll when modal open
            document.body.style.overflow = 'hidden';
        }

        function closeImageZoom() {
            document.getElementById('imageZoomModal').classList.remove('active');
            document.getElementById('zoomedImage').src = '';
            // Restore body scroll
            document.body.style.overflow = '';
        }

        // ESC key to close image zoom
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('imageZoomModal').classList.contains('active')) {
                closeImageZoom();
            }
        });

                // Contract Menu Template - Full 14 Days
        const contractMenuTemplate = {
            "Contract 01 - 2026": {
                startDate: "2025-12-31", // Wednesday = Day 1
                menus: {
                    "Day 1 - Wednesday": {
                    breakfast: [
                        "Nasi lemak with condiment",
                        "Sambal bilis/Ikan Aya",
                        "Ayam goreng berempah",
                        "Telur mata lembu goreng kicap",
                        "Roti naan",
                        "Ayam tandoori",
                        "Kentang masala/Dhaal",
                        "Porridge (plain/chicken/ Fish/dried oyster) with condiments",
                        "Kuih muih local (2 types : 1 sweet & 1 savoury)"
                    ],
                    teaBreak: [
                        "Mee goreng mamak",
                        "Keropok lekor goreng",
                        "Roti bakar sekaya",
                        "Kuih muih local (1 type)"
                    ],
                    lunch: [
                        "Sup Sayur",
                        "nasi putih",
                        "Kuew tiaw goreng",
                        "Gulai kawah daging",
                        "Ayam masak merah",
                        "Prawn dry chillies",
                        "Vege",
                        "Side Dish",
                        "Assorted fruits/Jellies/Pudding"
                    ],
                    lunchWestern: [
                        "Fish and chip",
                        "cream of potato",
                        "saute brocolli",
                        "French fries"
                    ],
                    dinner: [
                        "Sup ayam",
                        "Nasi putih",
                        "Nasi minyak basmathi",
                        "Kambing kima",
                        "Ayam goreng kunyit",
                        "Ikan bawal kukus",
                        "Vege",
                        "Side Dish",
                        "Assorted Fruits & Bubur / Pengat manis"
                    ],
                    dinnerWestern: [
                        "Grilled blackpepper steak slice",
                        "Cream of mushroom soup",
                        "Corn on the cob",
                        "Oven roasted potato"
                    ],
                    supper: [
                        "Nasi goreng kampung",
                        "Keropok goreng",
                        "Telur mata"
                    ]
                    },
                    "Day 2 - Thursday": {
                    breakfast: [
                        "Nasi Hujan Panas",
                        "Ayam masak merah",
                        "Daging gulai",
                        "Acar rampai",
                        "Roti canai",
                        "Kari ikan jenahak",
                        "Dhaal sayur"
                    ],
                    teaBreak: [
                        "Mihun goreng",
                        "Keropok ikan",
                        "Sandwich tuna"
                    ],
                    lunch: [
                        "Sup ABC",
                        "nasi putih",
                        "Nas basmathi",
                        "Daging kicap",
                        "Ayam masak bali",
                        "ikan tenggiri asam pedas",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Spaghetti aglio olio seafood",
                        "Cream of celery soup",
                        "Garlic bread",
                        "Corn kernel"
                    ],
                    dinner: [
                        "Sup Kambing",
                        "Nasi putih",
                        "Nasi tomato basmathi",
                        "Gulai tulang",
                        "Kurma ayam",
                        "Ikan kembong bakar",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Beef/chicken kebab",
                        "Broccoli soup",
                        "Roasted pumpkin",
                        "Chilli fries"
                    ],
                    supper: [
                        "Tuna pizza",
                        "Hawaiian chicken pizza"
                    ]
                    },
                    "Day 3 - Friday": {
                    breakfast: [
                        "Nasi dagang",
                        "Ayam goreng kunyit",
                        "Gulai ikan aya",
                        "Kurma telur rebus",
                        "Cakoi",
                        "Kari Ayam",
                        "Sambal telur"
                    ],
                    teaBreak: [
                        "Kuey teow goreng",
                        "Telur mata",
                        "pisang/keledek goreng"
                    ],
                    lunch: [
                        "Sup rassam",
                        "nasi putih",
                        "bihun goreng",
                        "Kari kambing",
                        "Ayam goreng Kunyit",
                        "Ketam harlock",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Chicken Piccata W/lemon creamy sauce",
                        "Clear mushroom soup",
                        "Boiled potato",
                        "green peas with herbs"
                    ],
                    dinner: [
                        "Sup daging",
                        "Nasi putih",
                        "Nasi hujan gerimis",
                        "Daging perathal",
                        "Ayam masak merah",
                        "Udang bakar",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Fish & chip",
                        "Chicken soup",
                        "french fries",
                        "buttered spinnach"
                    ],
                    supper: [
                        "cucur udang",
                        "Keropok lekor",
                        "sosej"
                    ]
                    },
                    "Day 4 - Saturday": {
                    breakfast: [
                        "Pulut Gaul Nyior",
                        "Mee Goreng Basah",
                        "Keropok Ikan",
                        "Telur Mata",
                        "Ayam Goreng Singgit",
                        "Ikan Kukus Goreng",
                        "Ikan Masin Goreng"
                    ],
                    teaBreak: [
                        "Nasi air",
                        "Nasi air condiment"
                    ],
                    lunch: [
                        "Sup fucuk",
                        "nasi putih",
                        "Nasi basmathi",
                        "Daging dendeng",
                        "Ayam goreng kunyit",
                        "Singgang ika aya",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Spaghetti meatballs & pepperoni",
                        "Onion clear soup",
                        "Cheese salad",
                        "Onion -roasted potato"
                    ],
                    dinner: [
                        "Sup rassam",
                        "Nasi putih",
                        "Nasi arab",
                        "Kambing gulai",
                        "Ayam mandy",
                        "Ikan bawal tomato",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "2Types of pizza",
                        "Cream of mushroom soup",
                        "Soft bun",
                        "Side salad"
                    ],
                    supper: [
                        "Kuey teow goreng",
                        "Keropok goreng",
                        "telur mata"
                    ]
                    },
                    "Day 5 - Sunday": {
                    breakfast: [
                        "Nasi kuning",
                        "Ayam goreng",
                        "Ikan tenggiri gulai kuning",
                        "Acar nanas / Sambal belacan",
                        "Roti jala",
                        "Kari ayam dengan kentang",
                        "Sambal tumis udang"
                    ],
                    teaBreak: [
                        "Nasi goreng",
                        "Keropok ikan",
                        "Roti telur bakar"
                    ],
                    lunch: [
                        "egg drop soup",
                        "nasi putih",
                        "Mee goreng",
                        "Kari daging",
                        "Ayam Kicap berempah",
                        "cencaru bakar air asam",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Cabbage roll chicken/beef",
                        "Cream of chicken soup",
                        "Jacket potato",
                        "boiled green soybean(edamame)"
                    ],
                    dinner: [
                        "Sup Abc",
                        "Nasi putih",
                        "Nasi kacang dhaal",
                        "Daging dendeng",
                        "Ayam bawang",
                        "Kari kepala ikan merah",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Roasted rosemary chicken",
                        "Green peas soup",
                        "french fries",
                        "Coleslaw"
                    ],
                    supper: [
                        "Mee hoon goreng",
                        "Keropok goreng",
                        "Telur mata"
                    ]
                    },
                    "Day 6 - Monday": {
                    breakfast: [
                        "Nasi Kerabu w condiments",
                        "Ayam percik",
                        "Daging bakar ala kampung",
                        "Ikan selar celup tepung",
                        "Murtabak ayam/daging",
                        "Kari daging tetel",
                        "Acar bawang"
                    ],
                    teaBreak: [
                        "Mee rebus johor",
                        "Karipap ikan",
                        "Sandwich telur"
                    ],
                    lunch: [
                        "Sup tomyam",
                        "nasi putih",
                        "Nasi pilaf",
                        "daging paprik",
                        "Ayam cili kering",
                        "Udang masak lemak",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Grilled boneless chicken",
                        "Carrot soup",
                        "French fries",
                        "Grilled tomatoes"
                    ],
                    dinner: [
                        "Sup kobis",
                        "Nasi putih",
                        "Nasi ayam",
                        "Daging halia",
                        "Ayam goreng & Hainan",
                        "Siakap kukus limau",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "roasted rib eye",
                        "Cream of chicken soup",
                        "Ceaser salad",
                        "Soft buns/rolls"
                    ],
                    supper: [
                        "Lempeng kelapa",
                        "sambal bilis",
                        "Kari ayam"
                    ]
                    },
                    "Day 7 - Tuesday": {
                    breakfast: [
                        "Pulut kuning",
                        "Rendang ayam",
                        "Daging pepes berlada",
                        "Telur dadar hiris",
                        "Lempeng kelapa",
                        "Sambal sardin",
                        "Sambal bilis"
                    ],
                    teaBreak: [
                        "Mee goreng",
                        "Telur mata",
                        "Roti bakar kaya & peanut butter"
                    ],
                    lunch: [
                        "Sup ayam",
                        "nasi putih kukus",
                        "Nasi Perang",
                        "Daging lada hitam",
                        "kari ayam",
                        "ikan selayang goreng berlada",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "beef lasagna",
                        "Cream of pumpkin soup",
                        "Bread cheese stick",
                        "Grilled broccoli spears"
                    ],
                    dinner: [
                        "tomyam seafood",
                        "Nasi putih",
                        "Nasi goreng",
                        "sup ekor",
                        "Ayam goreng tepung",
                        "siakap namprik paw",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Lamb chop",
                        "Tomato soup",
                        "Fried broccoli cauliflower",
                        "Hashbrown"
                    ],
                    supper: [
                        "Mee sup utara",
                        "condiment"
                    ]
                    },
                    "Day 8 - Wednesday": {
                    breakfast: [
                        "Nasi Himpit",
                        "Mee hoon goreng",
                        "Kuah kacang / Lodeh",
                        "Satay Rempah",
                        "Roti pita",
                        "Kentang masala",
                        "Kari ayam",
                        "Porridge (plain/chicken/ Fish/dried oyster) with condiments",
                        "Kuih muih local (2 types : 1 sweet & 1 savoury)"
                    ],
                    teaBreak: [
                        "Kuew tiaw Goreng",
                        "Keropok keping",
                        "Sandwich sardin",
                        "Kuih muih Local ( 1type)"
                    ],
                    lunch: [
                        "Tomyam seafood",
                        "nasi putih",
                        "Nasi lobak merah",
                        "Daging kalio",
                        "Ayam berlada",
                        "Ikan cencaru sumbat",
                        "Vege",
                        "Side Dish",
                        "Assorted fruits/Jellies/Pudding"
                    ],
                    lunchWestern: [
                        "spaghetti creamy carbonara",
                        "oniion clear soup",
                        "Baked potato",
                        "Saute carrot & cauliflower"
                    ],
                    dinner: [
                        "Sup lobak putih",
                        "Nasi putih",
                        "Nasi ambeng",
                        "Daging goreng kampung",
                        "Ayam panggang",
                        "Kari ikan bawal",
                        "Vege",
                        "Side Dish",
                        "Assorted Fruits & Bubur / Pengat manis"
                    ],
                    dinnerWestern: [
                        "cordon blue chicken w djon cream sauce",
                        "Creamy Carrot & cauliflower soup",
                        "Potato wedges",
                        "Roasted brocoli"
                    ],
                    supper: [
                        "Roti john",
                        "Fries"
                    ]
                    },
                    "Day 9 - Thursday": {
                    breakfast: [
                        "Roti canai",
                        "Nasi goreng",
                        "Kari ikan selayang",
                        "sambal bilis",
                        "Ayam goreng tepung",
                        "Kari ayam",
                        "Telur mata"
                    ],
                    teaBreak: [
                        "Mee sup utara",
                        "Sambal kicap /ayam/sayur",
                        "Roti bakar telur madu"
                    ],
                    lunch: [
                        "Sup ayam herba",
                        "nasi putih",
                        "Nasi basmathi",
                        "Daging Halia",
                        "Chicken dried chili",
                        "Ketam masak lemak",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "beef lasagna",
                        "Pumpkin soup",
                        "Chili fries",
                        "Saute green peas"
                    ],
                    dinner: [
                        "Tomyam ayam",
                        "Nasi putih",
                        "Nasi beriani",
                        "Daging masak hitam",
                        "Briyani ayam",
                        "Siakap 3 rasa",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Grilled lamb chop w blckpepper sauce",
                        "Cream pumpkin soup",
                        "Roasted corn",
                        "Mix vegetables"
                    ],
                    supper: [
                        "Bihun goreng",
                        "keropok ikan"
                    ]
                    },
                    "Day 10 - Friday": {
                    breakfast: [
                        "Pulut kelapa",
                        "Mee goreng",
                        "Ayam panggang",
                        "Ikan kembung goreng",
                        "Roti Bom",
                        "Kerutup daging",
                        "Dhaal kentang"
                    ],
                    teaBreak: [
                        "Nasi Goreng",
                        "Telur mata",
                        "roti bakar sekaya"
                    ],
                    lunch: [
                        "Sup petola",
                        "nasi putih",
                        "Bihun goreng",
                        "Hati lembu kerutuk",
                        "Ayam Kungpao",
                        "Kari ikan selayang",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Roast beef",
                        "Cream broccoli soup",
                        "Baked potato",
                        "Stir fry carrots"
                    ],
                    dinner: [
                        "Sup daging",
                        "Nasi putih",
                        "Nasi lemak hijau",
                        "Daging rendang cili padi",
                        "paru goreng crispy",
                        "Sambal udang",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "homemade spicy fried chicken",
                        "french fries",
                        "coleslaw",
                        "Corn kernel"
                    ],
                    supper: [
                        "Cucur pisang",
                        "Pisang goreng",
                        "Keledek goreng"
                    ]
                    },
                    "Day 11 - Saturday": {
                    breakfast: [
                        "Soto ayam w/ nasi himpit",
                        "Bergedil kentang",
                        "Isi ayam rebus",
                        "Kacang tanah/sayuran/taugeh",
                        "Sambal kicap",
                        "Bihun goreng",
                        "Kuah Kacang"
                    ],
                    teaBreak: [
                        "Mee kari",
                        "Telur/sayur/ sambal tumis",
                        "Sandwich telur"
                    ],
                    lunch: [
                        "Sup sayur campur",
                        "nasi putih",
                        "Nasi kismis",
                        "Perut masak lemak",
                        "Ayam berlada minang",
                        "Udang sambal petai",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "BBQ Chicken wing",
                        "cream celery soup",
                        "Mashed Potato",
                        "Coleslaw"
                    ],
                    dinner: [
                        "Sup kambing berempah",
                        "Nasi putih",
                        "Nasi Kandar",
                        "Kari kambing",
                        "Ayam tandoori",
                        "Bawal goreng",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Fried chicken tender w/spicy korean sauce",
                        "Carrot cream soup",
                        "Mashed potato",
                        "Buttered carrots & corn"
                    ],
                    supper: [
                        "Char kuew tiaw",
                        "keropok ikan",
                        "cili jeruk"
                    ]
                    },
                    "Day 12 - Sunday": {
                    breakfast: [
                        "Nasi dagang",
                        "Mee goreng mamak",
                        "Gulai ikan aya",
                        "Acar sayur",
                        "Sambal sardin",
                        "Roti arab",
                        "Dhaal"
                    ],
                    teaBreak: [
                        "Nasi goreng",
                        "Keropok lekor",
                        "karipap ayam"
                    ],
                    lunch: [
                        "Sup telur",
                        "nasi putih",
                        "Nasi basmathi",
                        "Daging Kunyit",
                        "Ayam kalio",
                        "Asam pedas ikan tinggiri",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Swedish meatball",
                        "Cream mushroom soup",
                        "Boiled pasta spaghetti",
                        "Sauted long beans"
                    ],
                    dinner: [
                        "Sup tulang",
                        "Nasi putih",
                        "Nasi serai",
                        "Daging masak palembang",
                        "Ayam goreng kunyit",
                        "udang sambal",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Baked salmon w creamy white sauce",
                        "corn soup",
                        "Jacket potato",
                        "Mixed green salad"
                    ],
                    supper: [
                        "Mee goreng mamak",
                        "Ayam goreng"
                    ]
                    },
                    "Day 13 - Monday": {
                    breakfast: [
                        "Nasi goreng cina",
                        "Ayam goreng tepung",
                        "Keropok lekor goreng",
                        "Telur dadar",
                        "charkoi",
                        "Kuah manis",
                        "kuah kari"
                    ],
                    teaBreak: [
                        "Bihun goreng tomyam",
                        "Telur mata",
                        "Roti bakar jem buah"
                    ],
                    lunch: [
                        "Sup ketam",
                        "nasi putih",
                        "Nasi perang",
                        "Daging Belengas",
                        "Ayam masak lemak cili padi",
                        "Cencaru bakar Kicap Bawang lada",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "Spaghetti beef bacon carbonara",
                        "Chicken creamy soup",
                        "Garlic bread",
                        "Baked cauliflower"
                    ],
                    dinner: [
                        "Sup daging",
                        "Nasi putih",
                        "Nasi bukhari",
                        "Gulai kambing",
                        "Ayam Bawang",
                        "Kembong bakar berempah",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "Crispy chicken burger",
                        "Seafood chowder",
                        "French fries",
                        "Coleslaw"
                    ],
                    supper: [
                        "Mee sup",
                        "Condiment"
                    ]
                    },
                    "Day 14 - Tuesday": {
                    breakfast: [
                        "Pulut kuning",
                        "Rendang ayam",
                        "Gulai daging",
                        "Lempeng kelapa",
                        "sambal bilis",
                        "Kari sardin",
                        "Telur dadar Hiris"
                    ],
                    teaBreak: [
                        "Mee cantonese",
                        "Condiments",
                        "Cheese sandwich"
                    ],
                    lunch: [
                        "Sup fish ball",
                        "nasi putih",
                        "Nasi Morocco",
                        "Daging bakar air asam",
                        "Ayam masak pecal",
                        "singgang ikan Aya",
                        "Vege",
                        "Side Dish"
                    ],
                    lunchWestern: [
                        "kacang pol",
                        "Condiments",
                        "Slice White bread",
                        "Half boiled egg"
                    ],
                    dinner: [
                        "Sup kentang",
                        "Nasi putih",
                        "Nasi daging",
                        "Daging air asam",
                        "Ayam gulai jantung pisang",
                        "Ikan tenggiri masak acar",
                        "Vege",
                        "Side Dish"
                    ],
                    dinnerWestern: [
                        "oxtail stew",
                        "Cream celery soup",
                        "Sauted mixed vegetables",
                        "butter rice"
                    ],
                    supper: [
                        "Maggie goreng",
                        "Telur mata",
                        "Keropok ikan"
                    ]
                    }
                }
            }
        };

        // ==================== INITIALIZATION ====================
        window.addEventListener('DOMContentLoaded', () => {
            setDefaultDates();
            updateLandingDateTime();
            setInterval(updateLandingDateTime, 60000); // Update every minute
            initializeMenuInputs();
            populateContractDayOverride();
            calculateUAUCTotal();
            updateStockAlerts();
        });

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('uaucDate').value = today;
            document.getElementById('stockDate').value = today;
            document.getElementById('menuDate').value = today;
            updateContractDay();
        }

        function updateLandingDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('en-GB');
            document.getElementById('landingDateTime').textContent = `${dateStr} | ${timeStr}`;
        }

        // ==================== NAVIGATION ====================
        async function openModule(moduleName) {
            document.getElementById('landingPage').style.display = 'none';
            currentModule = moduleName;
            
            if (moduleName === 'uauc') {
                document.getElementById('uaucModule').classList.add('active');
                loadUAUCHistory();
            } else if (moduleName === 'catering') {
                document.getElementById('cateringModule').classList.add('active');
                loadCateringHistory();
		} else if (moduleName === 'vv') {
                document.getElementById('vvModule').classList.add('active');
                await loadReports();
                updateStats();
            }
        }

        function backToLanding() {
            document.getElementById('landingPage').style.display = 'flex';
            document.getElementById('uaucModule').classList.remove('active');
            document.getElementById('cateringModule').classList.remove('active');
            document.getElementById('vvModule').classList.remove('active');
            currentModule = null;
        }

        function switchModuleTab(module, tabName) {
            const prefix = module === 'uauc' ? 'uauc' : 'catering';
            const tabs = document.querySelectorAll(`#${module}Module .tab`);
            const contents = document.querySelectorAll(`#${module}Module .content`);
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            
            const contentMap = {
                'uauc': {
                    'input': 'uaucInput',
                    'presentation': 'uaucPresentation',
                    'history': 'uaucHistory'
                },
                'catering': {
                    'stock': 'cateringStock',
                    'menu': 'cateringMenu',
                    'presentation': 'cateringPresentation',
                    'history': 'cateringHistory'
                }
            };
            
            document.getElementById(contentMap[module][tabName]).classList.add('active');
            
            if (tabName === 'presentation') {
                if (module === 'uauc') updateUAUCPresentation();
                else updateCateringPresentation();
            }
            
            if (tabName === 'history') {
                if (module === 'uauc') loadUAUCHistory();
                else loadCateringHistory();
            }
        }

        // ==================== UAUC MODULE ====================
        function calculateUAUCTotal() {
            const sw = parseInt(document.getElementById('uaucSW').value) || 0;
            const so = parseInt(document.getElementById('uaucSO').value) || 0;
            const uaPCSB = parseInt(document.getElementById('uaucUAPCSB').value) || 0;
            const uaPartner = parseInt(document.getElementById('uaucUAPartner').value) || 0;
            const ucPCSB = parseInt(document.getElementById('uaucUCPCSB').value) || 0;
            const ucPartner = parseInt(document.getElementById('uaucUCPartner').value) || 0;
            
            // Total UAUC = SO + UA-PCSB + UA-PARTNER + UC-PCSB + UC-PARTNER
            // Note: SW (Stop Work) is tracked separately and NOT included in Total UAUC
            const total = so + uaPCSB + uaPartner + ucPCSB + ucPartner;
            document.getElementById('uaucTotal').value = total;
        }

        function addUAUCCase() {
            if (uaucCaseCount >= MAX_UAUC_CASES) {
                alert('Maximum 3 cases allowed!');
                return;
            }

            uaucCaseCount++;
            uaucCaseImages[uaucCaseCount] = [];
            
            const caseHTML = `
                <div class="case-card" id="uaucCase${uaucCaseCount}">
                    <div class="case-header">
                        <span class="case-number">Case #${uaucCaseCount}</span>
                        <button class="remove-btn" onclick="removeUAUCCase(${uaucCaseCount})">‚úï Remove</button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>UAUC Number:</label>
                            <input type="text" id="uaucNo${uaucCaseCount}" placeholder="e.g., UAUC/PMA/2026/0275">
                        </div>
                        <div class="form-group">
                            <label>Type:</label>
                            <select id="uaucType${uaucCaseCount}">
                                <option value="UA">Unsafe Act (UA)</option>
                                <option value="UC">Unsafe Condition (UC)</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Location/Category:</label>
                            <input type="text" id="uaucLocation${uaucCaseCount}" placeholder="e.g., MAINDECK">
                        </div>
                        <div class="form-group full-width">
                            <label>Description:</label>
                            <textarea id="uaucDescription${uaucCaseCount}" placeholder="Describe the unsafe act/condition..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>Action Taken:</label>
                            <textarea id="uaucAction${uaucCaseCount}" placeholder="What action was taken..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>Images (max 3):</label>
                            <input type="file" id="uaucImages${uaucCaseCount}" accept="image/*" multiple onchange="previewUAUCImages(${uaucCaseCount})">
                            <div class="image-preview" id="uaucPreview${uaucCaseCount}"></div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('uaucCasesContainer').insertAdjacentHTML('beforeend', caseHTML);
            
            if (uaucCaseCount >= MAX_UAUC_CASES) {
                document.getElementById('addUAUCCaseBtn').disabled = true;
                document.getElementById('addUAUCCaseBtn').textContent = '‚úì Maximum cases reached';
            }
        }

        function removeUAUCCase(id) {
            document.getElementById(`uaucCase${id}`).remove();
            delete uaucCaseImages[id];
            uaucCaseCount--;
            document.getElementById('addUAUCCaseBtn').disabled = false;
            document.getElementById('addUAUCCaseBtn').textContent = '‚ûï Add Case';
        }

        function previewUAUCImages(caseId) {
            const input = document.getElementById(`uaucImages${caseId}`);
            const preview = document.getElementById(`uaucPreview${caseId}`);
            preview.innerHTML = '';

            if (input.files.length > 3) {
                alert('Maximum 3 images per case!');
                input.value = '';
                return;
            }

            uaucCaseImages[caseId] = [];

            Array.from(input.files).forEach((file) => {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`Image ${file.name} too large (max 5MB)`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    compressImage(e.target.result, (compressed) => {
                        uaucCaseImages[caseId].push(compressed);
                        preview.innerHTML += `
                            <div class="preview-item">
                                <img src="${compressed}" alt="Preview">
                            </div>
                        `;
                    });
                }
                reader.readAsDataURL(file);
            });
        }

        function compressImage(base64, callback) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                
                const maxDimension = 1200;
                if (width > maxDimension || height > maxDimension) {
                    if (width > height) {
                        height = (height / width) * maxDimension;
                        width = maxDimension;
                    } else {
                        width = (width / height) * maxDimension;
                        height = maxDimension;
                    }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                
                const compressed = canvas.toDataURL('image/jpeg', 0.8);
                callback(compressed);
            };
            img.src = base64;
        }

        function collectUAUCData() {
            const data = {
                type: 'uauc',
                platform: "IRONG BARAT A",
                date: document.getElementById('uaucDate').value,
                statistics: {
                    total: document.getElementById('uaucTotal').value,
                    sw: document.getElementById('uaucSW').value,
                    so: document.getElementById('uaucSO').value,
                    uaPCSB: document.getElementById('uaucUAPCSB').value,
                    uaPartner: document.getElementById('uaucUAPartner').value,
                    ucPCSB: document.getElementById('uaucUCPCSB').value,
                    ucPartner: document.getElementById('uaucUCPartner').value
                },
                cases: [],
                savedAt: new Date().toISOString()
            };

            for (let i = 1; i <= MAX_UAUC_CASES; i++) {
                const caseEl = document.getElementById(`uaucCase${i}`);
                if (!caseEl) continue;

                data.cases.push({
                    uaucNo: document.getElementById(`uaucNo${i}`).value,
                    type: document.getElementById(`uaucType${i}`).value,
                    location: document.getElementById(`uaucLocation${i}`).value,
                    description: document.getElementById(`uaucDescription${i}`).value,
                    action: document.getElementById(`uaucAction${i}`).value,
                    images: uaucCaseImages[i] || []
                });
            }

            return data;
        }

        function saveUAUCReport() {
            const data = collectUAUCData();
            
            if (!data.date) {
                alert('Please select a date');
                return;
            }

            // Save to localStorage
            let history = JSON.parse(localStorage.getItem('uaucHistory') || '[]');
            const existingIndex = history.findIndex(item => item.date === data.date);
            
            if (existingIndex >= 0) {
                history[existingIndex] = data;
            } else {
                history.unshift(data);
            }
            
            if (history.length > 50) history = history.slice(0, 50);
            localStorage.setItem('uaucHistory', JSON.stringify(history));

            // Download JSON
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `UAUC_IBA_${data.date}.json`;
            a.click();

            alert('‚úÖ UAUC Report saved!');
        }

        function updateUAUCPresentation() {
            const date = new Date(document.getElementById('uaucDate').value);
            const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
            
            document.getElementById('uaucPressDate').textContent = `IRONG BARAT A | ${dateStr}`;
            document.getElementById('uaucPressTotal').textContent = document.getElementById('uaucTotal').value;
            document.getElementById('uaucPressSW').textContent = document.getElementById('uaucSW').value;
            document.getElementById('uaucPressSO').textContent = document.getElementById('uaucSO').value;
            document.getElementById('uaucPressUAPCSB').textContent = document.getElementById('uaucUAPCSB').value;
            document.getElementById('uaucPressUAPartner').textContent = document.getElementById('uaucUAPartner').value;
            document.getElementById('uaucPressUCPCSB').textContent = document.getElementById('uaucUCPCSB').value;
            document.getElementById('uaucPressUCPartner').textContent = document.getElementById('uaucUCPartner').value;

            const casesDiv = document.getElementById('uaucPressCases');
            casesDiv.innerHTML = '';

            for (let i = 1; i <= MAX_UAUC_CASES; i++) {
                const caseEl = document.getElementById(`uaucCase${i}`);
                if (!caseEl) continue;

                const type = document.getElementById(`uaucType${i}`).value;
                const uaucNo = document.getElementById(`uaucNo${i}`).value;
                const location = document.getElementById(`uaucLocation${i}`).value;
                const description = document.getElementById(`uaucDescription${i}`).value;
                const action = document.getElementById(`uaucAction${i}`).value;

                let imagesHTML = '';
                if (uaucCaseImages[i] && uaucCaseImages[i].length > 0) {
                    imagesHTML = '<div class="case-images">';
                    uaucCaseImages[i].forEach(base64 => {
                        imagesHTML += `<img src="${base64}" alt="Evidence" onclick="openImageZoom('${base64}')" style="cursor: pointer;">`;
                    });
                    imagesHTML += '</div>';
                }

                const typeLabel = type === 'UA' ? '(Stop Work)' : '(Poor condition)';

                casesDiv.innerHTML += `
                    <div class="case-display ${type.toLowerCase()}">
                        <span class="case-type-badge ${type.toLowerCase()}-badge">${type} ${typeLabel}</span>
                        <h4>${uaucNo} - ${location}</h4>
                        <p><strong>Description:</strong> ${description}</p>
                        <p><strong>Action:</strong> ${action}</p>
                        ${imagesHTML}
                    </div>
                `;
            }
        }

        function loadUAUCHistory() {
            const history = JSON.parse(localStorage.getItem('uaucHistory') || '[]');
            const historyList = document.getElementById('uaucHistoryList');
            const emptyHistory = document.getElementById('uaucEmptyHistory');
            
            if (history.length === 0) {
                historyList.innerHTML = '';
                emptyHistory.style.display = 'block';
                return;
            }
            
            emptyHistory.style.display = 'none';
            historyList.innerHTML = '';
            
            history.forEach((item, index) => {
                const date = new Date(item.date);
                const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                const savedDate = new Date(item.savedAt);
                const savedStr = savedDate.toLocaleString('en-GB');
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-info">
                        <div class="history-date">üìÖ ${dateStr}</div>
                        <div class="history-stats">Total: ${item.statistics.total} | SW: ${item.statistics.sw} | SO: ${item.statistics.so || 0} | Cases: ${item.cases.length}</div>
                        <div class="history-timestamp">Saved: ${savedStr}</div>
                    </div>
                    <div class="history-actions">
                        <button class="btn btn-primary" onclick="loadUAUCFromHistory(${index})">üìù Load</button>
                        <button class="btn btn-success" onclick="generateUAUCPDFFromHistory(${index})">üìÑ PDF</button>
                        <button class="btn btn-danger" onclick="deleteUAUCFromHistory(${index})">üóëÔ∏è</button>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }

        function loadUAUCFromHistory(index) {
            const history = JSON.parse(localStorage.getItem('uaucHistory') || '[]');
            const data = history[index];
            if (!data) return;
            
            // Load data
            document.getElementById('uaucDate').value = data.date;
            document.getElementById('uaucSW').value = data.statistics.sw;
            document.getElementById('uaucSO').value = data.statistics.so || 0;
            document.getElementById('uaucUAPCSB').value = data.statistics.uaPCSB;
            document.getElementById('uaucUAPartner').value = data.statistics.uaPartner;
            document.getElementById('uaucUCPCSB').value = data.statistics.ucPCSB;
            document.getElementById('uaucUCPartner').value = data.statistics.ucPartner;
            calculateUAUCTotal();

            // Clear cases
            document.getElementById('uaucCasesContainer').innerHTML = '';
            uaucCaseCount = 0;
            uaucCaseImages = {};

            // Load cases
            data.cases.forEach((caseData, i) => {
                addUAUCCase();
                const caseNum = i + 1;
                document.getElementById(`uaucNo${caseNum}`).value = caseData.uaucNo;
                document.getElementById(`uaucType${caseNum}`).value = caseData.type;
                document.getElementById(`uaucLocation${caseNum}`).value = caseData.location;
                document.getElementById(`uaucDescription${caseNum}`).value = caseData.description;
                document.getElementById(`uaucAction${caseNum}`).value = caseData.action;
                
                if (caseData.images && caseData.images.length > 0) {
                    uaucCaseImages[caseNum] = caseData.images;
                    const preview = document.getElementById(`uaucPreview${caseNum}`);
                    preview.innerHTML = '';
                    caseData.images.forEach(base64 => {
                        preview.innerHTML += `<div class="preview-item"><img src="${base64}" alt="Preview"></div>`;
                    });
                }
            });

            switchModuleTab('uauc', 'input');
            alert('‚úÖ Report loaded!');
        }

        function deleteUAUCFromHistory(index) {
            if (!confirm('Delete this report?')) return;
            
            let history = JSON.parse(localStorage.getItem('uaucHistory') || '[]');
            history.splice(index, 1);
            localStorage.setItem('uaucHistory', JSON.stringify(history));
            loadUAUCHistory();
            alert('‚úÖ Deleted!');
        }

        function clearUAUCHistory() {
            if (!confirm('Delete ALL UAUC reports? Cannot be undone!')) return;
            
            localStorage.removeItem('uaucHistory');
            loadUAUCHistory();
            alert('‚úÖ All cleared!');
        }

        function uploadUAUCJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        let history = JSON.parse(localStorage.getItem('uaucHistory') || '[]');
                        history.unshift(data);
                        if (history.length > 50) history = history.slice(0, 50);
                        localStorage.setItem('uaucHistory', JSON.stringify(history));
                        loadUAUCHistory();
                        alert('‚úÖ JSON uploaded!');
                    } catch (error) {
                        alert('‚ùå Error: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function generateUAUCPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const uaucDate = document.getElementById('uaucDate').value;
            if (!uaucDate) {
                alert('Please select date first');
                return;
            }
            
            const dateObj = new Date(uaucDate);
            const dateStr = dateObj.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
            
            // Header
            doc.setFillColor(107, 141, 214);
            doc.rect(0, 0, 210, 35, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text('UAUC ANALYSIS REPORT', 105, 12, { align: 'center' });
            doc.setFontSize(11);
            doc.text(`IRONG BARAT A | ${dateStr}`, 105, 25, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            let y = 50;
            
            // Statistics Summary
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('STATISTICS SUMMARY', 20, y);
            y += 8;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const totalUAUC = parseInt(document.getElementById('uaucTotal').textContent || 0);
            const sw = parseInt(document.getElementById('uaucSW').value || 0);
            const so = parseInt(document.getElementById('uaucSO').value || 0);
            
            doc.text(`Total UAUC: ${totalUAUC}`, 25, y);
            y += 6;
            doc.text(`Stop Work: ${sw}`, 25, y);
            y += 6;
            doc.text(`Safety Observations: ${so}`, 25, y);
            y += 10;
            
            // Breakdown Table
            doc.setFont(undefined, 'bold');
            doc.text('BREAKDOWN', 20, y);
            y += 8;
            
            doc.setFont(undefined, 'normal');
            const uaPCSB = document.getElementById('uaucUAPCSB').value || 0;
            const uaPartner = document.getElementById('uaucUAPartner').value || 0;
            const ucPCSB = document.getElementById('uaucUCPCSB').value || 0;
            const ucPartner = document.getElementById('uaucUCPartner').value || 0;
            
            // Simple table
            doc.text('Unsafe Act (UA):', 25, y);
            doc.text(`PCSB: ${uaPCSB} | Partner: ${uaPartner}`, 70, y);
            y += 6;
            doc.text('Unsafe Condition (UC):', 25, y);
            doc.text(`PCSB: ${ucPCSB} | Partner: ${ucPartner}`, 70, y);
            y += 12;
            
            // Cases
            doc.setFont(undefined, 'bold');
            doc.setFontSize(14);
            doc.text('CASES', 20, y);
            y += 8;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const casesContainer = document.getElementById('uaucCasesContainer');
            const cases = casesContainer.querySelectorAll('.case-card');
            
            if (cases.length === 0) {
                doc.text('No cases reported', 25, y);
            } else {
                cases.forEach((caseEl, idx) => {
                    // Check if need new page
                    if (y > 240) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    const caseNum = idx + 1;
                    const type = caseEl.querySelector('select[id*="Type"]').value;
                    const desc = caseEl.querySelector('textarea[id*="Desc"]').value;
                    const action = caseEl.querySelector('textarea[id*="Action"]').value;
                    
                    // Case header
                    doc.setFont(undefined, 'bold');
                    doc.text(`Case ${caseNum}: ${type}`, 25, y);
                    y += 6;
                    
                    doc.setFont(undefined, 'normal');
                    
                    // Description
                    if (desc) {
                        doc.text('Description:', 25, y);
                        y += 5;
                        const descLines = doc.splitTextToSize(desc, 160);
                        descLines.forEach(line => {
                            if (y > 270) {
                                doc.addPage();
                                y = 20;
                            }
                            doc.text(line, 30, y);
                            y += 5;
                        });
                        y += 2;
                    }
                    
                    // Action
                    if (action) {
                        doc.text('Action Taken:', 25, y);
                        y += 5;
                        const actionLines = doc.splitTextToSize(action, 160);
                        actionLines.forEach(line => {
                            if (y > 270) {
                                doc.addPage();
                                y = 20;
                            }
                            doc.text(line, 30, y);
                            y += 5;
                        });
                        y += 2;
                    }
                    
                    // Images
                    const imageInputs = caseEl.querySelectorAll('input[type="file"]');
                    let hasImages = false;
                    
                    imageInputs.forEach(input => {
                        if (input.files && input.files[0]) {
                            hasImages = true;
                        }
                    });
                    
                    // Check if we have images in storage
                    const caseImages = uaucCaseImages[caseNum] || [];
                    if (caseImages.length > 0) {
                        doc.text('Images:', 25, y);
                        y += 5;
                        
                        caseImages.forEach((imgData, imgIdx) => {
                            if (y > 230) {
                                doc.addPage();
                                y = 20;
                            }
                            
                            try {
                                // Add image to PDF (max width 80mm)
                                doc.addImage(imgData, 'JPEG', 30, y, 80, 60);
                                y += 65;
                            } catch (e) {
                                console.log('Error adding image:', e);
                            }
                        });
                    }
                    
                    y += 5; // Space between cases
                });
            }
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.text(`Page ${i} of ${pageCount} | Generated on ${new Date().toLocaleString('en-GB')}`, 105, 285, { align: 'center' });
            }
            
            doc.save(`UAUC_IBA_${uaucDate}.pdf`);
        }

        function generateUAUCPDFFromHistory(index) {
            loadUAUCFromHistory(index);
            setTimeout(() => generateUAUCPDF(), 500);
        }

        // ==================== CATERING MODULE - STOCK ====================
        function updateStockAlerts() {
            const stocks = [
                { id: 'Chiller', value: parseInt(document.getElementById('stockChiller').value) || 0 },
                { id: 'Freezer', value: parseInt(document.getElementById('stockFreezer').value) || 0 },
                { id: 'DryFood', value: parseInt(document.getElementById('stockDryFood').value) || 0 },
                { id: 'NonFood', value: parseInt(document.getElementById('stockNonFood').value) || 0 },
                { id: 'RO', value: parseInt(document.getElementById('stockRODays').value) || 0 },
                { id: 'Mineral', value: parseInt(document.getElementById('stockMineralDays').value) || 0 }
            ];

            stocks.forEach(stock => {
                const alertEl = document.getElementById(`alert${stock.id}`);
                if (stock.value < STOCK_ALERT_THRESHOLD) {
                    alertEl.className = 'stock-alert-low';
                    alertEl.textContent = `‚ö†Ô∏è LOW! (< ${STOCK_ALERT_THRESHOLD} days)`;
                } else if (stock.value < 14) {
                    alertEl.className = 'stock-alert-medium';
                    alertEl.textContent = '‚ö° Monitor';
                } else {
                    alertEl.className = 'stock-alert-good';
                    alertEl.textContent = '‚úì Good';
                }
            });
        }

        function copyPreviousDayStock() {
            const history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            if (history.length === 0) {
                alert('No previous stock data found');
                return;
            }

            const previous = history[0].stock;
            if (!previous) return;

            // Auto-decrement by 1 day
            document.getElementById('stockChiller').value = Math.max(0, (parseInt(previous.chiller) || 0) - 1);
            document.getElementById('stockFreezer').value = Math.max(0, (parseInt(previous.freezer) || 0) - 1);
            document.getElementById('stockDryFood').value = Math.max(0, (parseInt(previous.dryFood) || 0) - 1);
            document.getElementById('stockNonFood').value = Math.max(0, (parseInt(previous.nonFood) || 0) - 1);
            document.getElementById('stockROQty').value = previous.roQty || 0;
            document.getElementById('stockRODays').value = Math.max(0, (parseInt(previous.roDays) || 0) - 1);
            document.getElementById('stockMineralQty').value = previous.mineralQty || 0;
            document.getElementById('stockMineralDays').value = Math.max(0, (parseInt(previous.mineralDays) || 0) - 1);

            updateStockAlerts();
            alert('‚úÖ Previous day stock copied! Review and adjust as needed.');
        }

        function addEquipmentIssue() {
            equipmentCount++;
            const html = `
                <div class="equipment-item" id="equipment${equipmentCount}">
                    <div class="equipment-header">
                        <span class="case-number">Equipment Issue #${equipmentCount}</span>
                        <button class="remove-btn" onclick="removeEquipment(${equipmentCount})">‚úï Remove</button>
                    </div>
                    <div class="form-group">
                        <label>Issue Description:</label>
                        <textarea id="equipmentDesc${equipmentCount}" placeholder="e.g., Display Freezer (Ice Cream) - Sensor Faulty"></textarea>
                    </div>
                </div>
            `;
            document.getElementById('equipmentContainer').insertAdjacentHTML('beforeend', html);
        }

        function removeEquipment(id) {
            document.getElementById(`equipment${id}`).remove();
        }

        function saveFoodStock() {
            const stockData = {
                type: 'catering',
                platform: "IRONG BARAT A",
                date: document.getElementById('stockDate').value,
                stock: {
                    chiller: document.getElementById('stockChiller').value,
                    freezer: document.getElementById('stockFreezer').value,
                    dryFood: document.getElementById('stockDryFood').value,
                    nonFood: document.getElementById('stockNonFood').value,
                    roQty: document.getElementById('stockROQty').value,
                    roDays: document.getElementById('stockRODays').value,
                    mineralQty: document.getElementById('stockMineralQty').value,
                    mineralDays: document.getElementById('stockMineralDays').value
                },
                shipment: {
                    incoming: {
                        type: document.getElementById('shipIncomingType').value,
                        etd: document.getElementById('shipIncomingETD').value,
                        eta: document.getElementById('shipIncomingETA').value,
                        boat: document.getElementById('shipIncomingBoat').value,
                        status: document.getElementById('shipIncomingStatus').value
                    },
                    next: {
                        type: document.getElementById('shipNextType').value,
                        etd: document.getElementById('shipNextETD').value,
                        eta: document.getElementById('shipNextETA').value,
                        boat: document.getElementById('shipNextBoat').value,
                        status: document.getElementById('shipNextStatus').value
                    }
                },
                equipment: [],
                savedAt: new Date().toISOString()
            };

            // Collect equipment issues
            for (let i = 1; i <= equipmentCount; i++) {
                const el = document.getElementById(`equipmentDesc${i}`);
                if (el && el.value) {
                    stockData.equipment.push(el.value);
                }
            }

            if (!stockData.date) {
                alert('Please select a date');
                return;
            }

            // Check if menu exists for same date, merge
            let history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            const existingIndex = history.findIndex(item => item.date === stockData.date);
            
            if (existingIndex >= 0) {
                // Merge with existing menu data
                history[existingIndex] = { ...history[existingIndex], ...stockData };
            } else {
                history.unshift(stockData);
            }
            
            if (history.length > 50) history = history.slice(0, 50);
            localStorage.setItem('cateringHistory', JSON.stringify(history));

            // Download JSON
            const blob = new Blob([JSON.stringify(stockData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `FoodStock_IBA_${stockData.date}.json`;
            a.click();

            alert('‚úÖ Food Stock saved!');
        }

        // ==================== CATERING MODULE - MENU ====================
        function initializeMenuInputs() {
            const sections = {
                'menuBreakfast': 11,
                'menuTeaBreak': 4,
                'menuLunch': 11,
                'menuLunchWestern': 4,
                'menuDinner': 11,
                'menuDinnerWestern': 4,
                'menuSupper': 3
            };

            Object.keys(sections).forEach(sectionId => {
                const container = document.getElementById(sectionId);
                container.innerHTML = '';
                for (let i = 1; i <= sections[sectionId]; i++) {
                    container.innerHTML += `
                        <div class="menu-item-input">
                            <span>${i}.</span>
                            <div class="menu-item-wrapper">
                                <input type="text" 
                                       id="${sectionId}${i}" 
                                       placeholder="Loading..." 
                                       oninput="checkMenuMatch('${sectionId}', ${i})"
                                       onblur="checkNotServed('${sectionId}', ${i})">
                                <div class="not-served-label" id="${sectionId}${i}_notserved">‚ö†Ô∏è Not Served</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Load placeholders if date selected
            updateMenuPlaceholders();
        }

        function updateMenuPlaceholders() {
            const contractDay = document.getElementById('menuContractDay').value;
            const contractId = document.getElementById('menuContract').value;
            
            if (!contractDay || !contractId) {
                // No contract day selected, set generic placeholders
                setGenericPlaceholders();
                return;
            }

            const contract = contractMenuTemplate[contractId];
            if (!contract || !contract.menus[contractDay]) {
                setGenericPlaceholders();
                return;
            }

            const contractMenu = contract.menus[contractDay];
            
            // Map section IDs to contract keys
            const sectionMapping = {
                'menuBreakfast': 'breakfast',
                'menuTeaBreak': 'teaBreak',
                'menuLunch': 'lunch',
                'menuLunchWestern': 'lunchWestern',
                'menuDinner': 'dinner',
                'menuDinnerWestern': 'dinnerWestern',
                'menuSupper': 'supper'
            };

            Object.keys(sectionMapping).forEach(sectionId => {
                const contractKey = sectionMapping[sectionId];
                const items = contractMenu[contractKey] || [];
                
                // Set placeholders and store contract items for matching
                items.forEach((item, index) => {
                    const inputEl = document.getElementById(`${sectionId}${index + 1}`);
                    if (inputEl) {
                        inputEl.placeholder = item;
                        inputEl.dataset.contractItem = item; // Store for matching
                    }
                });
                
                // Set empty placeholders for remaining fields
                const sections = {
                    'menuBreakfast': 11,
                    'menuTeaBreak': 4,
                    'menuLunch': 11,
                    'menuLunchWestern': 4,
                    'menuDinner': 11,
                    'menuDinnerWestern': 4,
                    'menuSupper': 3
                };
                
                const maxItems = sections[sectionId];
                for (let i = items.length + 1; i <= maxItems; i++) {
                    const inputEl = document.getElementById(`${sectionId}${i}`);
                    if (inputEl) {
                        inputEl.placeholder = 'Enter menu item (optional)';
                        inputEl.dataset.contractItem = ''; // No contract item
                    }
                }
            });
        }

        function setGenericPlaceholders() {
            const sections = {
                'menuBreakfast': 11,
                'menuTeaBreak': 4,
                'menuLunch': 11,
                'menuLunchWestern': 4,
                'menuDinner': 11,
                'menuDinnerWestern': 4,
                'menuSupper': 3
            };

            Object.keys(sections).forEach(sectionId => {
                for (let i = 1; i <= sections[sectionId]; i++) {
                    const inputEl = document.getElementById(`${sectionId}${i}`);
                    if (inputEl) {
                        inputEl.placeholder = 'Enter menu item...';
                        inputEl.dataset.contractItem = '';
                    }
                }
            });
        }

        function checkMenuMatch(sectionId, itemNum) {
            const inputEl = document.getElementById(`${sectionId}${itemNum}`);
            const notServedLabel = document.getElementById(`${sectionId}${itemNum}_notserved`);
            
            if (!inputEl) return;

            const typed = inputEl.value.trim();
            
            // Hide not-served label if typing
            if (typed) {
                notServedLabel.classList.remove('show');
            }
            
            // If empty, set to neutral grey
            if (!typed) {
                inputEl.className = 'empty';
                return;
            }

            // Get all contract items for today (all sections combined, case-insensitive)
            const contractDay = document.getElementById('menuContractDay').value;
            const contractId = document.getElementById('menuContract').value;
            
            if (!contractDay || !contractId) {
                inputEl.className = ''; // No contract to compare
                return;
            }

            const contract = contractMenuTemplate[contractId];
            if (!contract || !contract.menus[contractDay]) {
                inputEl.className = '';
                return;
            }

            const contractMenu = contract.menus[contractDay];
            
            // Collect ALL items from all sections (order doesn't matter)
            const allContractItems = [
                ...(contractMenu.breakfast || []),
                ...(contractMenu.teaBreak || []),
                ...(contractMenu.lunch || []),
                ...(contractMenu.lunchWestern || []),
                ...(contractMenu.dinner || []),
                ...(contractMenu.dinnerWestern || []),
                ...(contractMenu.supper || [])
            ].map(item => item.toLowerCase().trim());

            // Check if typed item exists in contract (case-insensitive)
            const typedLower = typed.toLowerCase().trim();
            
            if (allContractItems.includes(typedLower)) {
                inputEl.className = 'match'; // GREEN
            } else {
                inputEl.className = 'different'; // YELLOW
            }
        }

        function checkNotServed(sectionId, itemNum) {
            const inputEl = document.getElementById(`${sectionId}${itemNum}`);
            const notServedLabel = document.getElementById(`${sectionId}${itemNum}_notserved`);
            
            if (!inputEl || !notServedLabel) return;

            const typed = inputEl.value.trim();
            
            // Show "Not Served" label if empty
            if (!typed) {
                notServedLabel.classList.add('show');
                inputEl.className = 'empty';
            } else {
                notServedLabel.classList.remove('show');
            }
        }

        // ==================== PASTE MENU SECTION ====================
        function pasteMenuSection(sectionId) {
            const sectionNames = {
                'menuBreakfast': 'BREAKFAST - EASTERN',
                'menuTeaBreak': 'MORNING TEA BREAK',
                'menuLunch': 'LUNCH - EASTERN',
                'menuLunchWestern': 'LUNCH - WESTERN',
                'menuDinner': 'DINNER - EASTERN',
                'menuDinnerWestern': 'DINNER - WESTERN',
                'menuSupper': 'SUPPER'
            };
            
            const sectionName = sectionNames[sectionId] || 'Menu';
            
            // Store current section being pasted
            currentPasteSection = sectionId;
            
            // Update modal title
            document.getElementById('pasteMenuTitle').textContent = `üìã Paste ${sectionName} Items`;
            
            // Clear textarea
            document.getElementById('pasteMenuTextarea').value = '';
            
            // Open modal
            document.getElementById('pasteMenuModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scroll
            
            // Focus on textarea
            setTimeout(() => {
                document.getElementById('pasteMenuTextarea').focus();
            }, 100);
        }
        
        function closePasteMenuModal() {
            document.getElementById('pasteMenuModal').classList.remove('active');
            document.body.style.overflow = ''; // Restore scroll
            currentPasteSection = null;
        }
        
        function processPastedMenu() {
            const pasteText = document.getElementById('pasteMenuTextarea').value;
            
            if (!pasteText || !pasteText.trim()) {
                alert('‚ùå Please paste menu items first!');
                return;
            }
            
            if (!currentPasteSection) {
                alert('‚ùå Error: No section selected!');
                closePasteMenuModal();
                return;
            }
            
            // Parse items - try to detect format
            let items = [];
            if (pasteText.includes('\n')) {
                // Line-separated
                items = pasteText.split('\n')
                    .map(item => item.trim())
                    .filter(item => item.length > 0);
            } else if (pasteText.includes(',')) {
                // Comma-separated
                items = pasteText.split(',')
                    .map(item => item.trim())
                    .filter(item => item.length > 0);
            } else {
                // Single item
                items = [pasteText.trim()];
            }
            
            if (items.length === 0) {
                alert('‚ùå No valid items found!');
                return;
            }
            
            // Get all input fields in this section
            const container = document.getElementById(currentPasteSection);
            if (!container) {
                alert('‚ùå Section not found!');
                closePasteMenuModal();
                return;
            }
            
            const inputs = container.querySelectorAll('input[type="text"]');
            
            if (items.length > inputs.length) {
                alert(`‚ö†Ô∏è Warning: You pasted ${items.length} items but this section only has ${inputs.length} fields.\n\nOnly the first ${inputs.length} items will be filled.`);
            }
            
            // Fill the inputs
            items.forEach((item, index) => {
                if (index < inputs.length) {
                    inputs[index].value = item;
                    
                    // Trigger the validation checks
                    const inputId = inputs[index].id;
                    const match = inputId.match(/(\d+)$/);
                    if (match) {
                        const itemNum = match[1];
                        checkMenuMatch(currentPasteSection, itemNum);
                        checkNotServed(currentPasteSection, itemNum);
                    }
                }
            });
            
            // Close modal and show success
            closePasteMenuModal();
            alert(`‚úÖ Successfully filled ${Math.min(items.length, inputs.length)} menu items!`);
        }
        
        // ESC key to close paste modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('pasteMenuModal').classList.contains('active')) {
                closePasteMenuModal();
            }
        });

        function populateContractDayOverride() {
            const select = document.getElementById('menuContractDayOverride');
            select.innerHTML = '<option value="">Override...</option>';
            const days = ['Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday', 'Monday', 'Tuesday'];
            for (let i = 1; i <= 14; i++) {
                const day = days[(i - 1) % 7];
                const week = i <= 7 ? 1 : 2;
                select.innerHTML += `<option value="Day ${i} - ${day}">Day ${i} - ${day} (Week ${week})</option>`;
            }
        }

        function updateContractDay() {
            const dateStr = document.getElementById('menuDate').value;
            const contractId = document.getElementById('menuContract').value;
            
            if (!dateStr || !contractId) return;

            const contract = contractMenuTemplate[contractId];
            if (!contract) return;

            const date = new Date(dateStr);
            const startDate = new Date(contract.startDate);
            
            // Calculate day difference
            const diffTime = date - startDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // Get day within 14-day cycle
            const cycleDay = (diffDays % 14) + 1;
            const dayOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()];
            
            document.getElementById('menuContractDay').value = `Day ${cycleDay} - ${dayOfWeek}`;
            
            // Load contract menu as placeholders
            updateMenuPlaceholders();
        }

        function overrideContractDay() {
            const override = document.getElementById('menuContractDayOverride').value;
            if (override) {
                document.getElementById('menuContractDay').value = override;
            } else {
                updateContractDay();
            }
            
            // Load contract menu as placeholders
            updateMenuPlaceholders();
        }

        function collectMenuData() {
            const menuData = {
                breakfast: [],
                teaBreak: [],
                lunch: [],
                lunchWestern: [],
                dinner: [],
                dinnerWestern: [],
                supper: []
            };

            const sections = {
                'menuBreakfast': { key: 'breakfast', count: 11 },
                'menuTeaBreak': { key: 'teaBreak', count: 3 },
                'menuLunch': { key: 'lunch', count: 11 },
                'menuLunchWestern': { key: 'lunchWestern', count: 4 },
                'menuDinner': { key: 'dinner', count: 11 },
                'menuDinnerWestern': { key: 'dinnerWestern', count: 4 },
                'menuSupper': { key: 'supper', count: 3 }
            };

            Object.keys(sections).forEach(sectionId => {
                const section = sections[sectionId];
                for (let i = 1; i <= section.count; i++) {
                    const value = document.getElementById(`${sectionId}${i}`).value;
                    menuData[section.key].push(value);
                }
            });

            return menuData;
        }

        function saveDailyMenu() {
            const menuItems = collectMenuData();
            
            const menuData = {
                type: 'catering',
                platform: "IRONG BARAT A",
                date: document.getElementById('menuDate').value,
                chef: document.getElementById('menuChef').value,
                contract: document.getElementById('menuContract').value,
                contractDay: document.getElementById('menuContractDay').value,
                menu: menuItems,
                savedAt: new Date().toISOString()
            };

            if (!menuData.date) {
                alert('Please select a date');
                return;
            }

            // Merge with existing stock data if exists
            let history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            const existingIndex = history.findIndex(item => item.date === menuData.date);
            
            if (existingIndex >= 0) {
                history[existingIndex] = { ...history[existingIndex], ...menuData };
            } else {
                history.unshift(menuData);
            }
            
            if (history.length > 50) history = history.slice(0, 50);
            localStorage.setItem('cateringHistory', JSON.stringify(history));

            // Download JSON
            const blob = new Blob([JSON.stringify(menuData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Menu_IBA_${menuData.date}.json`;
            a.click();

            alert('‚úÖ Menu saved!');
        }

        function compareToContract() {
            const contractDay = document.getElementById('menuContractDay').value;
            const contractId = document.getElementById('menuContract').value;
            
            if (!contractDay || !contractId) {
                alert('Please select date and contract first');
                return;
            }

            const contract = contractMenuTemplate[contractId];
            const contractMenu = contract.menus[contractDay];
            
            if (!contractMenu) {
                alert('Contract menu not available for this day');
                return;
            }

            const actualMenu = collectMenuData();
            
            // Compare
            let html = `
                <div class="stats-highlight">Contract Day: ${contractDay}</div>
                <div class="comparison-grid">
                    <div class="comparison-column">
                        <h3>ACTUAL MENU (Keyed In)</h3>
            `;

            const sections = [
                { key: 'breakfast', title: 'BREAKFAST' },
                { key: 'teaBreak', title: 'TEA BREAK' },
                { key: 'lunch', title: 'LUNCH' },
                { key: 'lunchWestern', title: 'LUNCH WESTERN' },
                { key: 'dinner', title: 'DINNER' },
                { key: 'dinnerWestern', title: 'DINNER WESTERN' },
                { key: 'supper', title: 'SUPPER' }
            ];

            let matches = 0;
            let total = 0;

            sections.forEach(section => {
                html += `<h4 style="margin-top: 15px; color: #2D3E66;">${section.title}</h4>`;
                
                actualMenu[section.key].forEach((item, i) => {
                    if (!item) return;
                    total++;
                    const contractItem = contractMenu[section.key][i] || '';
                    const isMatch = item.toLowerCase().trim() === contractItem.toLowerCase().trim();
                    if (isMatch) matches++;
                    
                    html += `<div class="comparison-item ${isMatch ? 'match' : 'different'}">${i + 1}. ${item}</div>`;
                });
            });

            html += `</div><div class="comparison-column"><h3>CONTRACT MENU</h3>`;

            sections.forEach(section => {
                html += `<h4 style="margin-top: 15px; color: #2D3E66;">${section.title}</h4>`;
                
                contractMenu[section.key].forEach((item, i) => {
                    const actualItem = actualMenu[section.key][i] || '';
                    const isMatch = actualItem.toLowerCase().trim() === item.toLowerCase().trim();
                    
                    html += `<div class="comparison-item ${isMatch ? 'match' : 'different'}">${i + 1}. ${item}</div>`;
                });
            });

            html += `</div></div>`;
            
            const matchRate = total > 0 ? Math.round((matches / total) * 100) : 0;
            html = `<div class="stats-highlight">Match Rate: ${matchRate}% (${matches}/${total} items)</div>` + html;

            document.getElementById('comparisonContent').innerHTML = html;
            document.getElementById('comparisonModal').classList.add('active');
        }

        function closeComparisonModal() {
            document.getElementById('comparisonModal').classList.remove('active');
        }

        // ==================== CATERING PRESENTATION ====================
        function updateCateringPresentation() {
            const date = new Date(document.getElementById('stockDate').value || document.getElementById('menuDate').value);
            const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
            
            document.getElementById('cateringPressDate').textContent = `IRONG BARAT A | ${dateStr}`;
            
            // Stock status
            const stockHtml = `
                <div style="margin-bottom: 10px;">
                    <strong>Chiller:</strong> <span class="${getStockClass(document.getElementById('stockChiller').value)}">${document.getElementById('stockChiller').value} days</span><br>
                    <strong>Freezer:</strong> <span class="${getStockClass(document.getElementById('stockFreezer').value)}">${document.getElementById('stockFreezer').value} days</span><br>
                    <strong>Dry Food:</strong> <span class="${getStockClass(document.getElementById('stockDryFood').value)}">${document.getElementById('stockDryFood').value} days</span><br>
                    <strong>Non Food:</strong> <span class="${getStockClass(document.getElementById('stockNonFood').value)}">${document.getElementById('stockNonFood').value} days</span><br>
                    <strong>RO Water:</strong> ${document.getElementById('stockROQty').value} (${document.getElementById('stockRODays').value} days)<br>
                    <strong>Mineral Water:</strong> ${document.getElementById('stockMineralQty').value} (${document.getElementById('stockMineralDays').value} days)
                </div>
                <h4 style="margin-top: 15px; margin-bottom: 5px; color: #2D3E66;">INCOMING SHIPMENT</h4>
                <div style="font-size: 12px;">
                    Type: ${document.getElementById('shipIncomingType').value || 'N/A'}<br>
                    ETD: ${document.getElementById('shipIncomingETD').value || 'N/A'}<br>
                    ETA: ${document.getElementById('shipIncomingETA').value || 'N/A'}<br>
                    Boat: ${document.getElementById('shipIncomingBoat').value || 'N/A'}<br>
                    Status: ${document.getElementById('shipIncomingStatus').value || 'N/A'}
                </div>
            `;
            document.getElementById('cateringPressStock').innerHTML = '<h3 style="margin-bottom: 10px; color: #2D3E66;">STOCK STATUS</h3>' + stockHtml;
            
            // Menu - Split into 2 columns
            const menuData = collectMenuData();
            
            // Column 1: Breakfast, Tea Break, Lunch
            let menuCol1Html = '<h3 style="margin-bottom: 10px; color: #2D3E66;">MORNING & LUNCH</h3>';
            
            const morningMeals = [
                { key: 'breakfast', title: 'BREAKFAST - EASTERN' },
                { key: 'teaBreak', title: 'MORNING TEA BREAK (9AM)' },
                { key: 'lunch', title: 'LUNCH - EASTERN' },
                { key: 'lunchWestern', title: 'LUNCH - WESTERN' }
            ];
            
            morningMeals.forEach(section => {
                menuCol1Html += `<h4 style="margin-top: 10px; margin-bottom: 5px; font-size: 13px; color: #2D3E66;">${section.title}</h4>`;
                menuCol1Html += '<div style="font-size: 12px; line-height: 1.4;">';
                menuData[section.key].forEach((item, i) => {
                    if (item) menuCol1Html += `${i + 1}. ${item}<br>`;
                });
                menuCol1Html += '</div>';
            });
            
            // Column 2: Dinner, Supper
            let menuCol2Html = '<h3 style="margin-bottom: 10px; color: #2D3E66;">DINNER & SUPPER</h3>';
            
            const eveningMeals = [
                { key: 'dinner', title: 'DINNER - EASTERN' },
                { key: 'dinnerWestern', title: 'DINNER - WESTERN' },
                { key: 'supper', title: 'SUPPER (9PM)' }
            ];
            
            eveningMeals.forEach(section => {
                menuCol2Html += `<h4 style="margin-top: 10px; margin-bottom: 5px; font-size: 13px; color: #2D3E66;">${section.title}</h4>`;
                menuCol2Html += '<div style="font-size: 12px; line-height: 1.4;">';
                menuData[section.key].forEach((item, i) => {
                    if (item) menuCol2Html += `${i + 1}. ${item}<br>`;
                });
                menuCol2Html += '</div>';
            });
            
            // Set both columns
            document.getElementById('cateringPressMenu1').innerHTML = menuCol1Html;
            document.getElementById('cateringPressMenu2').innerHTML = menuCol2Html;
        }

        function getStockClass(value) {
            const days = parseInt(value) || 0;
            if (days < STOCK_ALERT_THRESHOLD) return 'stock-alert-low';
            if (days < 14) return 'stock-alert-medium';
            return 'stock-alert-good';
        }

        // ==================== CATERING HISTORY ====================
        function loadCateringHistory() {
            const history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            const historyList = document.getElementById('cateringHistoryList');
            const emptyHistory = document.getElementById('cateringEmptyHistory');
            
            if (history.length === 0) {
                historyList.innerHTML = '';
                emptyHistory.style.display = 'block';
                return;
            }
            
            emptyHistory.style.display = 'none';
            historyList.innerHTML = '';
            
            history.forEach((item, index) => {
                const stockDate = item.stockDate || item.date;
                const menuDate = item.menuDate || item.date;
                
                const stockDateStr = new Date(stockDate).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                const menuDateStr = new Date(menuDate).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                
                const savedDate = new Date(item.savedAt);
                const savedStr = savedDate.toLocaleString('en-GB');
                
                const hasStock = item.stock ? 'üì¶ Stock' : '';
                const hasMenu = item.menu ? 'üçΩÔ∏è Menu' : '';
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-info">
                        <div class="history-date">üìÖ Stock: ${stockDateStr} | Menu: ${menuDateStr}</div>
                        <div class="history-stats">${hasStock} ${hasMenu}</div>
                        <div class="history-timestamp">Saved: ${savedStr}</div>
                    </div>
                    <div class="history-actions">
                        <button class="btn btn-primary" onclick="loadCateringFromHistory(${index})">üìù Load</button>
                        <button class="btn btn-success" onclick="generateCateringPDFFromHistory(${index})">üìÑ PDF</button>
                        <button class="btn btn-danger" onclick="deleteCateringFromHistory(${index})">üóëÔ∏è</button>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }

        function loadCateringFromHistory(index) {
            const history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            const data = history[index];
            if (!data) return;
            
            // Load stock data if exists
            if (data.stock) {
                document.getElementById('stockDate').value = data.stockDate || data.date;
                document.getElementById('stockChiller').value = data.stock.chiller || 0;
                document.getElementById('stockFreezer').value = data.stock.freezer || 0;
                document.getElementById('stockDryFood').value = data.stock.dryFood || 0;
                document.getElementById('stockNonFood').value = data.stock.nonFood || 0;
                document.getElementById('stockROQty').value = data.stock.roQty || 0;
                document.getElementById('stockRODays').value = data.stock.roDays || 0;
                document.getElementById('stockMineralQty').value = data.stock.mineralQty || 0;
                document.getElementById('stockMineralDays').value = data.stock.mineralDays || 0;
                
                if (data.shipment) {
                    document.getElementById('shipIncomingType').value = data.shipment.incoming.type || '';
                    document.getElementById('shipIncomingETD').value = data.shipment.incoming.etd || '';
                    document.getElementById('shipIncomingETA').value = data.shipment.incoming.eta || '';
                    document.getElementById('shipIncomingBoat').value = data.shipment.incoming.boat || '';
                    document.getElementById('shipIncomingStatus').value = data.shipment.incoming.status || '';
                    
                    document.getElementById('shipNextType').value = data.shipment.next.type || '';
                    document.getElementById('shipNextETD').value = data.shipment.next.etd || '';
                    document.getElementById('shipNextETA').value = data.shipment.next.eta || '';
                    document.getElementById('shipNextBoat').value = data.shipment.next.boat || '';
                    document.getElementById('shipNextStatus').value = data.shipment.next.status || '';
                }
                
                updateStockAlerts();
            }
            
            // Load menu data if exists
            if (data.menu) {
                document.getElementById('menuPresentationDate').value = data.menuPresentationDate || data.date;
                document.getElementById('menuDate').value = data.menuDate || data.date;
                document.getElementById('menuChef').value = data.menu.chef || 'Chef Cook';
                document.getElementById('menuContract').value = data.menu.contract || 'Contract 01 - 2026';
                document.getElementById('menuContractDay').value = data.menu.contractDay || '';
                
                // Load placeholders first
                updateMenuPlaceholders();
                
                const sections = ['breakfast', 'teaBreak', 'lunch', 'lunchWestern', 'dinner', 'dinnerWestern', 'supper'];
                sections.forEach(section => {
                    const menuSection = data.menu[section] || [];
                    const sectionId = `menu${section.charAt(0).toUpperCase() + section.slice(1)}`;
                    const container = document.getElementById(sectionId);
                    
                    if (container) {
                        const inputs = container.querySelectorAll('input');
                        menuSection.forEach((item, i) => {
                            if (inputs[i]) {
                                inputs[i].value = item;
                                checkMenuMatch(sectionId, i + 1);
                                checkNotServed(sectionId, i + 1);
                            }
                        });
                    }
                });
            }
            
            switchModuleTab('catering', 'stock');
            alert('‚úÖ Report loaded!');
        }

        function deleteCateringFromHistory(index) {
            if (!confirm('Delete this report?')) return;
            
            let history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            history.splice(index, 1);
            localStorage.setItem('cateringHistory', JSON.stringify(history));
            loadCateringHistory();
            alert('‚úÖ Deleted!');
        }

        function clearCateringHistory() {
            if (!confirm('Delete ALL catering reports? Cannot be undone!')) return;
            
            localStorage.removeItem('cateringHistory');
            loadCateringHistory();
            alert('‚úÖ All cleared!');
        }

        function uploadCateringJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        let history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
                        history.unshift(data);
                        if (history.length > 50) history = history.slice(0, 50);
                        localStorage.setItem('cateringHistory', JSON.stringify(history));
                        loadCateringHistory();
                        alert('‚úÖ JSON uploaded!');
                    } catch (error) {
                        alert('‚ùå Error: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function generateCateringPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const stockDate = document.getElementById('stockDate').value;
            const menuDate = document.getElementById('menuDate').value;
            
            if (!stockDate || !menuDate) {
                alert('Please select dates first');
                return;
            }
            
            const stockDateStr = new Date(stockDate).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
            const menuDateStr = new Date(menuDate).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
            
            // Header
            doc.setFillColor(107, 141, 214);
            doc.rect(0, 0, 210, 35, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text('CATERING SERVICES REPORT', 105, 12, { align: 'center' });
            doc.setFontSize(11);
            doc.text(`IRONG BARAT A | Stock: ${stockDateStr} | Menu: ${menuDateStr}`, 105, 25, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            let y = 50;
            
            // Stock Status
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('STOCK STATUS', 20, y);
            y += 8;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const stockItems = [
                { label: 'Chiller', value: document.getElementById('stockChiller').value + ' days' },
                { label: 'Freezer', value: document.getElementById('stockFreezer').value + ' days' },
                { label: 'Dry Food', value: document.getElementById('stockDryFood').value + ' days' },
                { label: 'Non Food', value: document.getElementById('stockNonFood').value + ' days' },
                { label: 'RO Water', value: document.getElementById('stockROQty').value + ' qty (' + document.getElementById('stockRODays').value + ' days)' },
                { label: 'Mineral Water', value: document.getElementById('stockMineralQty').value + ' qty (' + document.getElementById('stockMineralDays').value + ' days)' }
            ];
            
            stockItems.forEach(item => {
                doc.text(`${item.label}: ${item.value}`, 25, y);
                y += 6;
            });
            
            y += 5;
            
            // Menu
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('DAILY MENU', 20, y);
            y += 8;
            
            const menuSections = [
                { title: 'BREAKFAST (0630-0800)', id: 'menuBreakfast' },
                { title: 'TEA BREAK (0930-1030)', id: 'menuTeaBreak' },
                { title: 'LUNCH - ASIAN (1200-1300)', id: 'menuLunch' },
                { title: 'LUNCH - WESTERN (1200-1300)', id: 'menuLunchWestern' },
                { title: 'DINNER - ASIAN (1800-1900)', id: 'menuDinner' },
                { title: 'DINNER - WESTERN (1800-1900)', id: 'menuDinnerWestern' },
                { title: 'SUPPER (2100-2200)', id: 'menuSupper' }
            ];
            
            doc.setFontSize(10);
            menuSections.forEach(section => {
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.setFont(undefined, 'bold');
                doc.text(section.title, 25, y);
                y += 6;
                
                doc.setFont(undefined, 'normal');
                const container = document.getElementById(section.id);
                if (container) {
                    const inputs = container.querySelectorAll('input');
                    let itemNum = 1;
                    inputs.forEach(input => {
                        if (input.value) {
                            doc.text(`${itemNum}. ${input.value}`, 30, y);
                            y += 5;
                            itemNum++;
                        }
                    });
                }
                y += 3;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.text(`Page ${i} of ${pageCount} | Generated on ${new Date().toLocaleString('en-GB')}`, 105, 285, { align: 'center' });
            }
            
            doc.save(`Catering_IBA_${stockDate}.pdf`);
        }

        function generateCateringPDFFromHistory(index) {
            loadCateringFromHistory(index);
            setTimeout(() => generateCateringPDF(), 500);
        }

        // ==================== AUTO-CLEAR FUNCTIONS ====================
        function clearUAUCForm() {
            document.getElementById('uaucSW').value = '0';
            document.getElementById('uaucSO').value = '0';
            document.getElementById('uaucUAPCSB').value = '0';
            document.getElementById('uaucUAPartner').value = '0';
            document.getElementById('uaucUCPCSB').value = '0';
            document.getElementById('uaucUCPartner').value = '0';
            calculateUAUCTotal();
            document.getElementById('uaucCasesContainer').innerHTML = '';
            uaucCaseCount = 0;
            uaucCaseImages = {};
        }

        function clearStockForm() {
            document.getElementById('stockChiller').value = '0';
            document.getElementById('stockFreezer').value = '0';
            document.getElementById('stockDryFood').value = '0';
            document.getElementById('stockNonFood').value = '0';
            document.getElementById('stockROQty').value = '0';
            document.getElementById('stockRODays').value = '0';
            document.getElementById('stockMineralQty').value = '0';
            document.getElementById('stockMineralDays').value = '0';
            document.getElementById('shipIncomingType').selectedIndex = 0;
            document.getElementById('shipIncomingETD').value = '';
            document.getElementById('shipIncomingETA').value = '';
            document.getElementById('shipIncomingBoat').value = '';
            document.getElementById('shipIncomingStatus').value = '';
            document.getElementById('shipNextType').selectedIndex = 0;
            document.getElementById('shipNextETD').value = '';
            document.getElementById('shipNextETA').value = '';
            document.getElementById('shipNextBoat').value = '';
            document.getElementById('shipNextStatus').value = '';
            document.getElementById('equipmentContainer').innerHTML = '';
            equipmentCount = 0;
            updateStockAlerts();
        }

        function clearMenuForm() {
            const menuContainers = ['menuBreakfast', 'menuTeaBreak', 'menuLunch', 'menuLunchWestern', 'menuDinner', 'menuDinnerWestern', 'menuSupper'];
            menuContainers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.querySelectorAll('input').forEach(input => {
                        input.value = '';
                        input.style.borderColor = '';
                        input.style.backgroundColor = '';
                    });
                }
            });
        }

        function updateMenuDateForTomorrow() {
            const presDate = document.getElementById('menuPresentationDate').value;
            if (presDate) {
                const date = new Date(presDate);
                date.setDate(date.getDate() + 1);
                document.getElementById('menuDate').value = date.toISOString().split('T')[0];
                clearMenuForm();
                updateContractDay();
            }
        }

        // ==================== COMBINED CATERING SAVE ====================
        function saveCombinedCateringReport() {
            const stockDate = document.getElementById('stockDate').value;
            const menuPresentationDate = document.getElementById('menuPresentationDate').value;
            const menuDate = document.getElementById('menuDate').value;
            
            if (!stockDate) {
                alert('Please select stock date');
                return;
            }
            if (!menuPresentationDate || !menuDate) {
                alert('Please select menu dates');
                return;
            }
            
            const combinedData = {
                type: 'catering',
                platform: "IRONG BARAT A",
                stockDate: stockDate,
                menuPresentationDate: menuPresentationDate,
                menuDate: menuDate,
                stock: {
                    chiller: document.getElementById('stockChiller').value,
                    freezer: document.getElementById('stockFreezer').value,
                    dryFood: document.getElementById('stockDryFood').value,
                    nonFood: document.getElementById('stockNonFood').value,
                    roQty: document.getElementById('stockROQty').value,
                    roDays: document.getElementById('stockRODays').value,
                    mineralQty: document.getElementById('stockMineralQty').value,
                    mineralDays: document.getElementById('stockMineralDays').value
                },
                shipment: {
                    incoming: {
                        type: document.getElementById('shipIncomingType').value,
                        etd: document.getElementById('shipIncomingETD').value,
                        eta: document.getElementById('shipIncomingETA').value,
                        boat: document.getElementById('shipIncomingBoat').value,
                        status: document.getElementById('shipIncomingStatus').value
                    },
                    next: {
                        type: document.getElementById('shipNextType').value,
                        etd: document.getElementById('shipNextETD').value,
                        eta: document.getElementById('shipNextETA').value,
                        boat: document.getElementById('shipNextBoat').value,
                        status: document.getElementById('shipNextStatus').value
                    }
                },
                equipment: [],
                menu: {
                    chef: document.getElementById('menuChef').value,
                    contract: document.getElementById('menuContract').value,
                    contractDay: document.getElementById('menuContractDay').value,
                    breakfast: [],
                    teaBreak: [],
                    lunch: [],
                    lunchWestern: [],
                    dinner: [],
                    dinnerWestern: [],
                    supper: []
                },
                savedAt: new Date().toISOString()
            };
            
            for (let i = 1; i <= equipmentCount; i++) {
                const el = document.getElementById(`equipmentDesc${i}`);
                if (el && el.value) combinedData.equipment.push(el.value);
            }
            
            const menuSections = ['menuBreakfast', 'menuTeaBreak', 'menuLunch', 'menuLunchWestern', 'menuDinner', 'menuDinnerWestern', 'menuSupper'];
            const menuKeys = ['breakfast', 'teaBreak', 'lunch', 'lunchWestern', 'dinner', 'dinnerWestern', 'supper'];
            
            menuSections.forEach((sectionId, idx) => {
                const container = document.getElementById(sectionId);
                if (container) {
                    container.querySelectorAll('input').forEach(input => {
                        combinedData.menu[menuKeys[idx]].push(input.value || '');
                    });
                }
            });
            
            let history = JSON.parse(localStorage.getItem('cateringHistory') || '[]');
            const existingIndex = history.findIndex(item => item.stockDate === stockDate && item.menuDate === menuDate);
            
            if (existingIndex >= 0) {
                history[existingIndex] = combinedData;
            } else {
                history.unshift(combinedData);
            }
            
            if (history.length > 50) history = history.slice(0, 50);
            localStorage.setItem('cateringHistory', JSON.stringify(history));
            
            const blob = new Blob([JSON.stringify(combinedData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Catering_IBA_Stock${stockDate}_Menu${menuDate}.json`;
            a.click();
            
            alert('‚úÖ Catering Report (Stock + Menu) saved!');
        }

        // Initialize first case
        addUAUCCase();
        
        // ==================== V&V MODULE JAVASCRIPT ====================
// Application State
        const appState = {
            selectedTemplate: null,
            images: [],
            positiveObs: [],
            improvementObs: [],
            reports: [],
            currentPreviewReport: null
        };

        // 10 NEW PROFESSIONAL TEMPLATES
        const templates = [
            // 1 IMAGE TEMPLATES
            { 
                id: '1img-hero', 
                name: 'Hero Center', 
                category: '1 Image', 
                maxImages: 1,
                layout: 'single-hero'
            },
            { 
                id: '1img-left', 
                name: 'Left Focus', 
                category: '1 Image', 
                maxImages: 1,
                layout: 'single-left'
            },
            { 
                id: '1img-right', 
                name: 'Right Focus', 
                category: '1 Image', 
                maxImages: 1,
                layout: 'single-right'
            },
            
            // 2 IMAGES TEMPLATES
            { 
                id: '2img-sidebyside', 
                name: 'Side by Side', 
                category: '2 Images', 
                maxImages: 2,
                layout: 'dual-horizontal'
            },
            { 
                id: '2img-stacked', 
                name: 'Stacked', 
                category: '2 Images', 
                maxImages: 2,
                layout: 'dual-vertical'
            },
            { 
                id: '2img-leftbig', 
                name: 'Left Focus', 
                category: '2 Images', 
                maxImages: 2,
                layout: 'dual-left-big'
            },
            
            // 3 IMAGES TEMPLATES
            { 
                id: '3img-grid', 
                name: 'Equal Grid', 
                category: '3 Images', 
                maxImages: 3,
                layout: 'triple-grid'
            },
            { 
                id: '3img-hero2', 
                name: 'Hero + 2', 
                category: '3 Images', 
                maxImages: 3,
                layout: 'triple-hero'
            },
            { 
                id: '3img-stack', 
                name: 'Vertical', 
                category: '3 Images', 
                maxImages: 3,
                layout: 'triple-vertical'
            },
            { 
                id: '3img-lshape', 
                name: 'L-Shape', 
                category: '3 Images', 
                maxImages: 3,
                layout: 'triple-lshape'
            }
        ];

		// Initialize
        window.onload = async function() {
            generateTemplates();
            await loadReports();
            setupImageUpload();
            setupEnterKey();
            setupJSONImport();
            updateStats();
        };

        // Generate Template Cards
        function generateTemplates() {
            const grid = document.getElementById('templateGrid');
            grid.innerHTML = '';
            
            templates.forEach(template => {
                const card = document.createElement('div');
                card.className = 'template-card';
                card.onclick = () => selectTemplate(template.id);
                card.innerHTML = `
                    <div class="template-preview">
                        ${getTemplatePreview(template.id)}
                    </div>
                    <span>${template.name}</span>
                    <span class="template-badge">${template.maxImages} ${template.maxImages === 1 ? 'pic' : 'pics'}</span>
                `;
                grid.appendChild(card);
            });
        }

        function getTemplatePreview(id) {
            const previews = {
                // 1 Image
                '1img-hero': '<div class="preview-box" style="width: 60px; height: 50px;"></div>',
                '1img-left': '<div class="preview-box" style="width: 40px; height: 50px; margin-right: auto;"></div>',
                '1img-right': '<div class="preview-box" style="width: 40px; height: 50px; margin-left: auto;"></div>',
                
                // 2 Images
                '2img-sidebyside': '<div class="preview-box" style="width: 30px; height: 50px;"></div><div class="preview-box" style="width: 30px; height: 50px;"></div>',
                '2img-stacked': '<div style="display: flex; flex-direction: column; gap: 5px;"><div class="preview-box" style="width: 50px; height: 22px;"></div><div class="preview-box" style="width: 50px; height: 22px;"></div></div>',
                '2img-leftbig': '<div class="preview-box" style="width: 45px; height: 50px;"></div><div class="preview-box" style="width: 20px; height: 50px;"></div>',
                
                // 3 Images
                '3img-grid': '<div class="preview-box" style="width: 20px; height: 50px;"></div><div class="preview-box" style="width: 20px; height: 50px;"></div><div class="preview-box" style="width: 20px; height: 50px;"></div>',
                '3img-hero2': '<div style="display: flex; flex-direction: column; gap: 3px;"><div class="preview-box" style="width: 65px; height: 35px;"></div><div style="display: flex; gap: 3px;"><div class="preview-box" style="width: 31px; height: 15px;"></div><div class="preview-box" style="width: 31px; height: 15px;"></div></div></div>',
                '3img-stack': '<div style="display: flex; flex-direction: column; gap: 3px;"><div class="preview-box" style="width: 50px; height: 15px;"></div><div class="preview-box" style="width: 50px; height: 15px;"></div><div class="preview-box" style="width: 50px; height: 15px;"></div></div>',
                '3img-lshape': '<div style="display: flex; gap: 3px;"><div style="display: flex; flex-direction: column; gap: 3px;"><div class="preview-box" style="width: 32px; height: 23px;"></div><div class="preview-box" style="width: 32px; height: 23px;"></div></div><div class="preview-box" style="width: 32px; height: 50px;"></div></div>'
            };
            return previews[id] || '';
        }

        function selectTemplate(id) {
            appState.selectedTemplate = id;
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // Image Upload
        function setupImageUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const imageInput = document.getElementById('imageInput');
            
            uploadZone.onclick = () => imageInput.click();
            
            uploadZone.ondragover = (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            };
            
            uploadZone.ondragleave = () => {
                uploadZone.classList.remove('dragover');
            };
            
            uploadZone.ondrop = (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            };
            
            imageInput.onchange = (e) => {
                handleFiles(e.target.files);
            };
        }

        function handleFiles(files) {
            const maxImages = appState.selectedTemplate 
                ? templates.find(t => t.id === appState.selectedTemplate).maxImages 
                : 3;
            
            if (appState.images.length >= maxImages) {
                alert(`Maximum ${maxImages} images for this template`);
                return;
            }
            
            Array.from(files).forEach(file => {
                if (appState.images.length >= maxImages) return;
                
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        appState.images.push(e.target.result);
                        renderImages();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function renderImages() {
            const grid = document.getElementById('imagePreviewGrid');
            const count = document.getElementById('imageCount');
            
            count.textContent = `${appState.images.length} ${appState.images.length === 1 ? 'image' : 'images'}`;
            
            grid.innerHTML = appState.images.map((img, index) => `
                <div class="image-preview-item">
                    <img src="${img}" alt="Preview ${index + 1}">
                    <button class="remove-image" onclick="removeImage(${index})">√ó</button>
                </div>
            `).join('');
        }

        function removeImage(index) {
            appState.images.splice(index, 1);
            renderImages();
        }

        // Observations
        function setupEnterKey() {
            document.getElementById('positiveInput').onkeypress = (e) => {
                if (e.key === 'Enter') addObservation('positive');
            };
            document.getElementById('improvementInput').onkeypress = (e) => {
                if (e.key === 'Enter') addObservation('improvement');
            };
        }

        function addObservation(type) {
            const input = document.getElementById(type + 'Input');
            const text = input.value.trim();
            
            if (text) {
                if (type === 'positive') {
                    appState.positiveObs.push(text);
                } else {
                    appState.improvementObs.push(text);
                }
                input.value = '';
                renderObservations();
            }
        }

        function renderObservations() {
            const positiveList = document.getElementById('positiveList');
            const improvementList = document.getElementById('improvementList');
            
            positiveList.innerHTML = appState.positiveObs.map((obs, i) => `
                <div class="obs-item">
                    <span>${obs}</span>
                    <button onclick="removeObservation('positive', ${i})">√ó</button>
                </div>
            `).join('');
            
            improvementList.innerHTML = appState.improvementObs.map((obs, i) => `
                <div class="obs-item">
                    <span>${obs}</span>
                    <button onclick="removeObservation('improvement', ${i})">√ó</button>
                </div>
            `).join('');
        }

        function removeObservation(type, index) {
            if (type === 'positive') {
                appState.positiveObs.splice(index, 1);
            } else {
                appState.improvementObs.splice(index, 1);
            }
            renderObservations();
        }

        // Validation & Save
        function validateForm() {
            const errors = [];
            
            if (!appState.selectedTemplate) errors.push('Please select a template');
            if (!document.getElementById('vvTitle').value.trim()) errors.push('Please enter V&V title');
            if (!document.getElementById('vvDate').value) errors.push('Please select V&V date');
            if (!document.getElementById('location').value) errors.push('Please select location');
            if (!document.getElementById('workDesc').value.trim()) errors.push('Please enter work description');
            if (appState.images.length === 0) errors.push('Please upload at least one image');
            if (appState.positiveObs.length === 0) errors.push('Please add at least one positive observation');
            if (appState.improvementObs.length === 0) errors.push('Please add at least one area of improvement');
            
            if (errors.length > 0) {
                alert('Please fix:\n\n' + errors.join('\n'));
                return false;
            }
            return true;
        }

        function saveReport() {
            if (!validateForm()) return;
            
            const report = {
                id: Date.now(),
                date: new Date().toISOString(),
                vvDate: document.getElementById('vvDate').value,
                template: appState.selectedTemplate,
                title: document.getElementById('vvTitle').value.trim(),
                location: document.getElementById('location').value,
                permitNo: document.getElementById('permitNo').value.trim(),
                workDesc: document.getElementById('workDesc').value.trim(),
                images: [...appState.images],
                positiveObs: [...appState.positiveObs],
                improvementObs: [...appState.improvementObs],
                actions: document.getElementById('actions').value.trim()
            };
            
            appState.reports.push(report);
            localStorage.setItem('vvReports', JSON.stringify(appState.reports));
            
            alert('Report saved successfully!');
            resetForm();
            updateStats();
        }

        function resetForm() {
            document.getElementById('vvTitle').value = '';
            document.getElementById('vvDate').value = '';
            document.getElementById('location').value = '';
            document.getElementById('permitNo').value = '';
            document.getElementById('workDesc').value = '';
            document.getElementById('actions').value = '';
            
            appState.selectedTemplate = null;
            appState.images = [];
            appState.positiveObs = [];
            appState.improvementObs = [];
            
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            renderImages();
            renderObservations();
        }

        // Preview & Display
        function previewReport() {
            if (!validateForm()) return;
            
            const report = {
                template: appState.selectedTemplate,
                title: document.getElementById('vvTitle').value.trim(),
                vvDate: document.getElementById('vvDate').value,
                location: document.getElementById('location').value,
                permitNo: document.getElementById('permitNo').value.trim(),
                workDesc: document.getElementById('workDesc').value.trim(),
                images: appState.images,
                positiveObs: appState.positiveObs,
                improvementObs: appState.improvementObs,
                actions: document.getElementById('actions').value.trim(),
                date: new Date().toISOString()
            };
            
            appState.currentPreviewReport = report;
            showSlide(report);
        }

        function showSlide(report) {
            appState.currentPreviewReport = report;
            const template = templates.find(t => t.id === report.template);
            const container = document.getElementById('previewContainer');
            
            const vvDateFormatted = report.vvDate ? new Date(report.vvDate + 'T00:00:00').toLocaleDateString('en-GB', {day: '2-digit', month: 'short', year: 'numeric'}) : '';
            
            let layoutHTML = generateLayoutHTML(report, template);
            
            container.innerHTML = `
                <div class="slide-container">
                    <div class="slide" id="reportSlide">
                        <div class="slide-header">
                            <h1>V&V on ${report.title}</h1>
                            <div class="slide-subtitle">
                                <strong>Location:</strong> ${report.location}
                                ${report.permitNo ? ` | <strong>Permit No:</strong> ${report.permitNo}` : ''}
                            </div>
                        </div>
                        
                        ${layoutHTML}
                        
                        <div class="slide-footer">
                            <div>V&V Date: ${vvDateFormatted}</div>
                            <div>Report Created: ${new Date(report.date).toLocaleDateString('en-GB', {day: '2-digit', month: 'short', year: 'numeric'})}</div>
                            <div>¬© 2026 Aziz Mohamad | Enterprise Solutions Division</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('previewModal').classList.add('active');
        }

        function generateLayoutHTML(report, template) {
            const textSections = `
                <div class="slide-section">
                    <h3>Work Description</h3>
                    <p>${report.workDesc}</p>
                </div>
                
                <div class="slide-section positive">
                    <h3>‚úì Positive Observations</h3>
                    <ul>
                        ${report.positiveObs.map(obs => `<li>${obs}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="slide-section improvement">
                    <h3>‚ö† Areas of Improvement</h3>
                    <ul>
                        ${report.improvementObs.map(obs => `<li>${obs}</li>`).join('')}
                    </ul>
                </div>
                
                ${report.actions ? `
                <div class="slide-section actions">
                    <h3>Recommended Actions</h3>
                    <p>${report.actions}</p>
                </div>
                ` : ''}
            `;

            switch(template.layout) {
                case 'single-hero':
                    return `
                        <div class="slide-body" style="flex-direction: column;">
                            <div class="slide-images" style="height: 450px;">
                                <div class="slide-image" style="width: 100%;">
                                    <img src="${report.images[0]}" alt="Image">
                                </div>
                            </div>
                            <div class="slide-text" style="flex-direction: row; gap: 15px; flex-wrap: wrap;">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'single-left':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 550px; flex-direction: column;">
                                <div class="slide-image" style="height: 100%;">
                                    <img src="${report.images[0]}" alt="Image">
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'single-right':
                    return `
                        <div class="slide-body">
                            <div class="slide-text">
                                ${textSections}
                            </div>
                            <div class="slide-images" style="width: 550px; flex-direction: column;">
                                <div class="slide-image" style="height: 100%;">
                                    <img src="${report.images[0]}" alt="Image">
                                </div>
                            </div>
                        </div>
                    `;
                
                case 'dual-horizontal':
                    return `
                        <div class="slide-body" style="flex-direction: column;">
                            <div class="slide-images" style="height: 450px;">
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[1]}" alt="Image 2">
                                </div>
                            </div>
                            <div class="slide-text" style="flex-direction: row; gap: 15px; flex-wrap: wrap;">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'dual-vertical':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 500px; flex-direction: column;">
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[1]}" alt="Image 2">
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'dual-left-big':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 600px;">
                                <div class="slide-image" style="flex: 2;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 15px; flex: 1;">
                                    <div class="slide-image" style="flex: 1;">
                                        <img src="${report.images[1]}" alt="Image 2">
                                    </div>
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'triple-grid':
                    return `
                        <div class="slide-body" style="flex-direction: column;">
                            <div class="slide-images" style="height: 400px;">
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[1]}" alt="Image 2">
                                </div>
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[2]}" alt="Image 3">
                                </div>
                            </div>
                            <div class="slide-text" style="flex-direction: row; gap: 15px; flex-wrap: wrap;">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'triple-hero':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 550px; flex-direction: column;">
                                <div class="slide-image" style="height: 350px;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div style="display: flex; gap: 15px; height: 200px;">
                                    <div class="slide-image" style="flex: 1;">
                                        <img src="${report.images[1]}" alt="Image 2">
                                    </div>
                                    <div class="slide-image" style="flex: 1;">
                                        <img src="${report.images[2]}" alt="Image 3">
                                    </div>
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'triple-vertical':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 450px; flex-direction: column;">
                                <div class="slide-image" style="height: 190px;">
                                    <img src="${report.images[0]}" alt="Image 1">
                                </div>
                                <div class="slide-image" style="height: 190px;">
                                    <img src="${report.images[1]}" alt="Image 2">
                                </div>
                                <div class="slide-image" style="height: 190px;">
                                    <img src="${report.images[2]}" alt="Image 3">
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                case 'triple-lshape':
                    return `
                        <div class="slide-body">
                            <div class="slide-images" style="width: 550px;">
                                <div style="display: flex; flex-direction: column; gap: 15px; flex: 1;">
                                    <div class="slide-image" style="height: 280px;">
                                        <img src="${report.images[0]}" alt="Image 1">
                                    </div>
                                    <div class="slide-image" style="height: 280px;">
                                        <img src="${report.images[1]}" alt="Image 2">
                                    </div>
                                </div>
                                <div class="slide-image" style="flex: 1;">
                                    <img src="${report.images[2]}" alt="Image 3">
                                </div>
                            </div>
                            <div class="slide-text">
                                ${textSections}
                            </div>
                        </div>
                    `;
                
                default:
                    return '';
            }
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
            appState.currentPreviewReport = null;
        }

        // Export to PDF
        async function exportToPDF() {
            const report = appState.currentPreviewReport;
            if (!report) return;

            const { jsPDF } = window.jspdf;
            const element = document.getElementById('reportSlide').parentElement;
            
            try {
                // Enable PDF export mode to show all content without scrollbars
                element.classList.add('pdf-export-mode');
                
                // Wait a bit for layout to adjust
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Get actual height after removing overflow
                const actualHeight = element.scrollHeight;
                
                const canvas = await html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#F1FFFE',
                    logging: false,
                    width: 1400,
                    height: actualHeight,
                    windowHeight: actualHeight
                });
                
                // Remove PDF export mode class
                element.classList.remove('pdf-export-mode');
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('l', 'mm', 'a4');
                
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                // Calculate proper scaling to fit content
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / (imgWidth / 3.779527), pdfHeight / (imgHeight / 3.779527));
                
                const scaledWidth = (imgWidth / 3.779527) * ratio;
                const scaledHeight = (imgHeight / 3.779527) * ratio;
                
                pdf.addImage(imgData, 'PNG', 0, 0, scaledWidth, scaledHeight);
                
                const date = report.vvDate || new Date(report.date).toISOString().split('T')[0];
                const filename = `VV-Report-${report.title.replace(/[^a-z0-9]/gi, '-')}-${date}.pdf`;
                
                pdf.save(filename);
                alert('PDF exported successfully!');
            } catch (error) {
                // Make sure to remove class even if error occurs
                element.classList.remove('pdf-export-mode');
                alert('Error exporting PDF: ' + error.message);
            }
        }

        // Export to Image
        async function exportToImage() {
            const report = appState.currentPreviewReport;
            if (!report) return;

            const element = document.getElementById('reportSlide').parentElement;
            
            try {
                // Enable PDF export mode to show all content without scrollbars
                element.classList.add('pdf-export-mode');
                
                // Wait a bit for layout to adjust
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Get actual height after removing overflow
                const actualHeight = element.scrollHeight;
                
                const canvas = await html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#F1FFFE',
                    logging: false,
                    width: 1400,
                    height: actualHeight,
                    windowHeight: actualHeight
                });
                
                // Remove PDF export mode class
                element.classList.remove('pdf-export-mode');
                
                const date = report.vvDate || new Date(report.date).toISOString().split('T')[0];
                const filename = `VV-Report-${report.title.replace(/[^a-z0-9]/gi, '-')}-${date}.png`;
                
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    alert('Image exported successfully!');
                });
            } catch (error) {
                // Make sure to remove class even if error occurs
                element.classList.remove('pdf-export-mode');
                alert('Error exporting image: ' + error.message);
            }
        }

        // History
        async function loadReports() {
            try {
                const saved = await loadFromIndexedDB('vvReports');
                if (saved && Array.isArray(saved)) {
                    appState.reports = saved;
                    console.log('‚úÖ Loaded', saved.length, 'reports from IndexedDB');
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è No existing data');
            }
            renderHistory();
        }

        function renderHistory() {
            const grid = document.getElementById('historyGrid');
            
            if (appState.reports.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <h3 style="margin-bottom: 10px;">No reports yet</h3>
                        <p>Create your first V&V report to get started</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = appState.reports.sort((a, b) => b.id - a.id).map(report => `
                <div class="history-card" onclick="viewReport(${report.id})">
                    <h3>V&V on ${report.title}</h3>
                    <div class="history-meta">
                        <strong>V&V Date:</strong> ${report.vvDate ? new Date(report.vvDate + 'T00:00:00').toLocaleDateString('en-GB', {day: '2-digit', month: 'short', year: 'numeric'}) : 'N/A'}<br>
                        <strong>Created:</strong> ${new Date(report.date).toLocaleDateString('en-GB', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric'
                        })}
                    </div>
                    <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                        <strong>Location:</strong> ${report.location}
                    </p>
                    ${report.permitNo ? `<p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                        <strong>Permit:</strong> ${report.permitNo}
                    </p>` : ''}
                    <p style="font-size: 14px; color: var(--text-secondary);">
                        <strong>Observations:</strong> ${report.positiveObs.length} positive, ${report.improvementObs.length} improvements
                    </p>
                    <div class="history-actions">
                        <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); viewReport(${report.id})">View</button>
                        <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); viewReportPDF(${report.id})">PDF</button>
                        <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); deleteReport(${report.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

// ========== IndexedDB Helper Functions ==========
const DB_NAME = 'VVReportsDB';
const DB_VERSION = 1;
const STORE_NAME = 'reports';

function openDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                db.createObjectStore(STORE_NAME);
            }
        };
    });
}

async function saveToIndexedDB(key, data) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.put(data, key);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

async function loadFromIndexedDB(key) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([STORE_NAME], 'readonly');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.get(key);
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

        function viewReport(id) {
            const report = appState.reports.find(r => r.id === id);
            if (report) {
                showSlide(report);
            }
        }

        async function viewReportPDF(id) {
            const report = appState.reports.find(r => r.id === id);
            if (report) {
                appState.currentPreviewReport = report;
                showSlide(report);
                setTimeout(() => exportToPDF(), 500);
            }
        }

        async function deleteReport(id) {
            if (confirm('Delete this report?')) {
                appState.reports = appState.reports.filter(r => r.id !== id);
                await saveToIndexedDB('vvReports', appState.reports);
                renderHistory();
                updateStats();
            }
        }

        // Tab Switching
        function switchTab(tab) {
            document.getElementById('createNavBtn').classList.remove('active');
            document.getElementById('historyNavBtn').classList.remove('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'create') {
                document.getElementById('createNavBtn').classList.add('active');
                document.getElementById('createTab').classList.add('active');
            } else {
                document.getElementById('historyNavBtn').classList.add('active');
                document.getElementById('historyTab').classList.add('active');
                renderHistory();
            }
        }

        // JSON Export/Import
        function exportToJSON() {
            if (appState.reports.length === 0) {
                alert('No reports to export!');
                return;
            }

            const date = new Date().toISOString().split('T')[0];
            const dataStr = JSON.stringify(appState.reports, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `vv-reports-${date}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`Exported ${appState.reports.length} reports to JSON file!\nFilename: vv-reports-${date}.json`);
        }

        function setupJSONImport() {
            const jsonInput = document.getElementById('jsonInput');
            
            jsonInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        if (!Array.isArray(importedData)) {
                            alert('Invalid JSON format! Expected an array of reports.');
                            return;
                        }
                        
                        const existingIds = new Set(appState.reports.map(r => r.id));
                        const newReports = importedData.filter(r => !existingIds.has(r.id));
                        
                        appState.reports = [...appState.reports, ...newReports];
                        await saveToIndexedDB('vvReports', appState.reports);
                        
                        renderHistory();
                        updateStats();
                        
                        alert(`Successfully imported ${newReports.length} new reports!\nTotal reports: ${appState.reports.length}`);
                        
                    } catch (error) {
                        alert('Error reading JSON file: ' + error.message);
                    }
                };
                reader.readAsText(file);
                
                jsonInput.value = '';
            };
        }

        // Stats Update
        function updateStats() {
            const total = appState.reports.length;
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            const thisWeek = appState.reports.filter(r => new Date(r.date) >= oneWeekAgo).length;
            
            const storageStr = localStorage.getItem('vvReports') || '';
            const storageKB = (storageStr.length / 1024).toFixed(2);
            
            document.getElementById('totalReports').textContent = total;
            document.getElementById('weekReports').textContent = thisWeek;
            document.getElementById('storageSize').textContent = storageKB + ' KB';
        }

        // Close modal on outside click
        window.onclick = (e) => {
            const modal = document.getElementById('previewModal');
            if (e.target === modal) {
                closePreview();
            }
        };

        // ==================== ELECTRON INTEGRATION ====================
        if (window.electronAPI && window.electronAPI.isElectron) {
            console.log('‚úÖ Running in Electron mode');
            
            // Handle menu commands
            window.electronAPI.onExportJSON(() => {
                exportAllData();
            });
            
            window.electronAPI.onImportJSON(async () => {
                const result = await window.electronAPI.loadJSONFile();
                if (result.success && result.data) {
                    try {
                        const data = JSON.parse(result.data);
                        // You can customize import logic here
                        if (confirm('Import this data? Current data will be replaced.')) {
                            if (data.operations) localStorage.setItem('operationsHistory', JSON.stringify(data.operations));
                            if (data.uauc) localStorage.setItem('uaucHistory', JSON.stringify(data.uauc));
                            if (data.catering) localStorage.setItem('cateringHistory', JSON.stringify(data.catering));
                            alert('‚úÖ Data imported successfully!');
                            location.reload();
                        }
                    } catch (error) {
                        alert('‚ùå Error: ' + error.message);
                    }
                }
            });
            
            window.electronAPI.onClearAllData(() => {
                if (confirm('‚ö†Ô∏è Clear ALL data? This cannot be undone!')) {
                    localStorage.clear();
                    alert('‚úÖ All data cleared!');
                    location.reload();
                }
            });
            
            window.electronAPI.onOpenModule((module) => {
                showModule(module);
            });
            
            window.electronAPI.onGoHome(() => {
                showLanding();
            });
            
            // Enhanced export function for Electron
            async function exportAllData() {
                const allData = {
                    operations: JSON.parse(localStorage.getItem('operationsHistory') || '[]'),
                    uauc: JSON.parse(localStorage.getItem('uaucHistory') || '[]'),
                    catering: JSON.parse(localStorage.getItem('cateringHistory') || '[]'),
                    exportDate: new Date().toISOString(),
                    platform: 'Irong Barat A, B, C',
                    version: '1.0.0'
                };
                
                const filename = `OIM_Backup_${new Date().toISOString().split('T')[0]}.json`;
                const result = await window.electronAPI.saveJSONFile(
                    JSON.stringify(allData, null, 2), 
                    filename
                );
                
                if (result.success) {
                    alert('‚úÖ Data exported successfully!\n\nFile: ' + filename);
                } else if (!result.cancelled) {
                    alert('‚ùå Export failed: ' + (result.error || 'Unknown error'));
                }
            }
        } else {
            console.log('‚ÑπÔ∏è Running in browser mode');
        }
		// ========== Load data from IndexedDB on page start ==========
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const savedReports = await loadFromIndexedDB('vvReports');
                if (savedReports && Array.isArray(savedReports)) {
                    appState.reports = savedReports;
                    updateStats();
                    console.log('‚úÖ Loaded', savedReports.length, 'reports from IndexedDB');
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è No existing data or error:', error.message);
            }
        });
    </script>
</body>
</html>
