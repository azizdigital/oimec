<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Timeline Analytics Dashboard with Strategic Features</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); 
            color: #334155; 
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.3);
        }
        .header h1 { font-size: 28px; margin-bottom: 8px; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 16px; }
        .controls { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            display: flex; 
            gap: 15px; 
            align-items: center; 
            flex-wrap: wrap;
        }
        .file-input-wrapper { position: relative; }
        .file-input-wrapper input[type=file] { position: absolute; left: -9999px; }
        .file-input-label { 
            background: #3b82f6;
            color: white; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-block;
        }
        .file-input-label:hover { background: #2563eb; transform: translateY(-1px); }
        
        /* Navigation Tabs */
        .nav-tabs { 
            display: flex; 
            gap: 5px; 
            background: white;
            padding: 5px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .nav-tab { 
            background: transparent; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            border: none; 
            font-size: 14px; 
            font-weight: 600;
            color: #64748b;
        }
        .nav-tab.active { 
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); 
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .nav-tab:hover:not(.active) { background: #f1f5f9; color: #3b82f6; }
        
        /* Tab Content */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Grid & Cards */
        .grid { display: grid; gap: 20px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .grid-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            transition: all 0.3s ease;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.15); }
        .card h3 { 
            color: #1e293b; 
            margin-bottom: 15px; 
            font-size: 18px; 
            border-bottom: 2px solid #e2e8f0; 
            padding-bottom: 10px; 
            font-weight: 700;
        }
        
        /* Metrics */
        .metric { text-align: center; padding: 15px; }
        .metric-value { 
            font-size: 32px; 
            font-weight: 800; 
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px; 
        }
        .metric-label { 
            font-size: 12px; 
            color: #64748b; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: 600;
        }
        
        /* Charts & Tables */
        .chart-container { position: relative; height: 300px; }
        .table-container { overflow-x: auto; border-radius: 8px; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #f1f5f9; }
        .data-table th { background: #f8fafc; font-weight: 700; color: #1e293b; }
        .data-table tr:hover { background: rgba(59, 130, 246, 0.05); }
        
        /* Status Badges */
        .status-complete { background: #10b981; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .status-progress { background: #f59e0b; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .status-pending { background: #ef4444; color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        
        /* Progress Elements */
        .progress-bar { background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden; margin: 8px 0; }
        .progress-fill { background: linear-gradient(90deg, #3b82f6, #6366f1); height: 100%; transition: width 0.5s ease; }
        
        /* Messages */
        .message { padding: 10px 15px; border-radius: 8px; margin: 10px 0; font-size: 14px; }
        .message.success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #16a34a; }
        .message.error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; }

        /* üéØ ENHANCED STRATEGIC STYLES */
        
        /* Accordion Styles for Timeline Grouping */
        .group-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 15px 20px;
            margin: 10px 0 5px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .group-header:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .group-header.expanded {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
        }
        
        .group-content {
            display: none;
            margin-bottom: 15px;
            padding: 0 10px;
            animation: slideDown 0.3s ease;
        }
        
        .group-content.expanded {
            display: block;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .group-item {
            background: white;
            margin: 5px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .group-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left-color: #3b82f6;
        }
        
        .group-item.critical {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .group-item.idle {
            border-left-color: #f59e0b;
            background: #fefbf2;
        }
        
        .group-item.clickable:hover {
            background: #f0f9ff;
        }
        
        /* Trend Sub-tabs */
        .trend-subtab {
            transition: all 0.3s ease;
            padding: 8px 16px;
            background: #e5e7eb;
            color: #374151;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .trend-subtab.active {
            background: #3b82f6 !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .trend-subtab:hover:not(.active) {
            background: #f3f4f6 !important;
            color: #3b82f6 !important;
        }
        
        .trend-subtab-content {
            animation: fadeIn 0.3s ease;
        }
        
        /* Enhanced Progress Bars with Animations */
        .enhanced-progress-bar {
            position: relative;
            background: #f1f5f9;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .enhanced-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            transition: width 1s ease;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }
        
        .enhanced-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, .2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, .2) 50%,
                rgba(255, 255, 255, .2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }
        
        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        /* Risk Assessment & Analytics Styles */
        .risk-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .risk-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .risk-high { 
            background: #fef2f2; 
            border-left: 4px solid #ef4444; 
        }
        .risk-medium { 
            background: #fefbf2; 
            border-left: 4px solid #f59e0b; 
        }
        .risk-low { 
            background: #f0fdf4; 
            border-left: 4px solid #10b981; 
        }
        
        .risk-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
        }
        
        .badge-high { background: #ef4444; }
        .badge-medium { background: #f59e0b; }
        .badge-low { background: #10b981; }
        
        .resource-bar {
            background: #f1f5f9;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .resource-bar:hover {
            transform: scale(1.02);
        }
        
        .resource-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .resource-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .prediction-metric {
            text-align: center;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            margin: 10px 0;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .prediction-metric:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .prediction-value {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .prediction-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .bottleneck-alert {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }
        
        .bottleneck-alert:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.15);
        }
        
        .alert-icon {
            width: 24px;
            height: 24px;
            background: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .analytics-summary {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .analytics-summary:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        /* Action Hints */
        .action-hint {
            margin-top: 10px;
            padding: 8px 12px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 6px;
            font-size: 12px;
            color: #16a34a;
            font-style: italic;
        }
        
        .action-hint::before {
            content: "üí° ";
            font-style: normal;
        }
        
        /* OIM View Styles */
        .oim-quick-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .oim-quick-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .critical-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
            background: #fef2f2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .critical-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
        }
        
        .recommendation-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #10b981;
            transition: all 0.3s ease;
        }
        
        .recommendation-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }
        
        .idle-alert {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: #fefbf2;
            border: 1px solid #fbbf24;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }
        
        .idle-alert:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.15);
        }
        
        .idle-icon {
            width: 24px;
            height: 24px;
            background: #f59e0b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        /* Trend Direction Indicators */
        .trend-up {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .trend-down {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .trend-stable {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        /* Summary Modal */
        .summary-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        
        .summary-section h4 {
            margin-bottom: 10px;
            color: #1e293b;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) { 
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; } 
            .controls { flex-direction: column; align-items: stretch; } 
            .nav-tabs { flex-direction: column; }
            .container { padding: 15px; }
        }

        /* Loading Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>üöÄ Enhanced Timeline Analytics Dashboard</h1>
            <p>Strategic Operations Management with Advanced AI Analytics & Predictive Insights</p>
        </div>
        
        <!-- File Upload Controls -->
        <div class="controls">
            <div class="file-input-wrapper">
                <input type="file" id="jsonFileInput" accept=".json">
                <label for="jsonFileInput" class="file-input-label">üìÅ Upload JSON Data</label>
            </div>
            <span id="lastUpdated" style="color: #666; font-size: 14px;">Ready to load data...</span>
        </div>

        <!-- Messages Container -->
        <div id="messages"></div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="nav-tab" onclick="showTab('timeline')">üìÖ Timeline</button>
            <button class="nav-tab" onclick="showTab('charts')">üìà Charts</button>
            <button class="nav-tab" onclick="showTab('trends')">üìâ Trends</button>
            <button class="nav-tab" onclick="showTab('analytics')">ü§ñ Analytics</button>
            <button class="nav-tab" onclick="showTab('oimview')">üéØ OIM View</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="grid grid-4">
                <div class="card metric">
                    <div class="metric-value" id="totalWorklist">0</div>
                    <div class="metric-label">Total Worklist</div>
                </div>
                <div class="card metric">
                    <div class="metric-value" id="completedTasks">0</div>
                    <div class="metric-label">Completed</div>
                </div>
                <div class="card metric">
                    <div class="metric-value" id="daysLeft">0</div>
                    <div class="metric-label">Days Left</div>
                </div>
                <div class="card metric">
                    <div class="metric-value" id="overallProgress">0%</div>
                    <div class="metric-label">Overall Progress</div>
                </div>
            </div>
            
            <div class="grid grid-2">
                <div class="card">
                    <h3>Project Information</h3>
                    <div class="grid grid-2">
                        <div><strong>Start Date:</strong> <span id="startDate">-</span></div>
                        <div><strong>End Date:</strong> <span id="endDate">-</span></div>
                        <div><strong>Platform POB:</strong> <span id="platformPOB">-</span></div>
                        <div><strong>Vessel POB:</strong> <span id="vesselPOB">-</span></div>
                        <div><strong>HSE Incidents:</strong> <span id="hseIncidents">-</span></div>
                        <div><strong>Safety Observations:</strong> <span id="safetyObs">-</span></div>
                    </div>
                </div>
                <div class="card">
                    <h3>Progress by Work Group</h3>
                    <div class="chart-container">
                        <canvas id="overviewWorkGroupChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- üìÖ ENHANCED TIMELINE TAB -->
        <div id="timeline" class="tab-content">
            <div class="card">
                <h3>üîß Timeline Controls & Filters</h3>
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; color: #64748b; font-weight: 600;">Status</label>
                        <select id="statusFilter" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                            <option value="all">All Status</option>
                            <option value="completed">Completed</option>
                            <option value="in-progress">In Progress</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; color: #64748b; font-weight: 600;">Work Group</label>
                        <select id="workGroupFilter" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                            <option value="all">All Groups</option>
                        </select>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; color: #64748b; font-weight: 600;">Date From</label>
                        <input type="date" id="dateFromFilter" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; color: #64748b; font-weight: 600;">Date To</label>
                        <input type="date" id="dateToFilter" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                    </div>
                    <div style="display: flex; align-items: end;">
                        <button onclick="applyTimelineFilters()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; font-weight: 600;">Apply Filters</button>
                    </div>
                </div>
                
                <!-- üöÄ ENHANCED CONTROLS -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="showCriticalOnly" onchange="applyTimelineFilters()" style="transform: scale(1.2);">
                        <span style="font-weight: 600; color: #ef4444;">üö® Show Critical Only</span>
                        <small style="color: #666;">(Progress <50% or Overdue)</small>
                    </label>
                    <button onclick="expandAllGroups()" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">üìÇ Expand All</button>
                    <button onclick="collapseAllGroups()" style="padding: 6px 12px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">üìÅ Collapse All</button>
                    <button onclick="generateSummaryCard()" style="padding: 6px 12px; background: #8b5cf6; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">üßæ Generate Summary</button>
                </div>
                
                <div style="font-size: 13px; color: #64748b; margin-bottom: 15px;">
                    Showing <span id="filteredCount">0</span> of <span id="totalCount">0</span> items ‚Ä¢ 
                    <span id="criticalCount" style="color: #ef4444;">0 critical</span> ‚Ä¢ 
                    <span id="idleCount" style="color: #f59e0b;">0 idle</span>
                </div>
            </div>
            
            <div class="card">
                <h3>üìã Timeline View (Accordion Grouped by Work Group)</h3>
                <div id="timelineGroupedView">
                    <!-- Accordion-style grouped view will be populated here -->
                </div>
            </div>
            
            <!-- Summary Modal (Hidden by default) -->
            <div id="summaryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; padding: 20px; box-sizing: border-box;">
                <div style="background: white; border-radius: 15px; max-width: 800px; margin: 50px auto; padding: 30px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>üìã Project Summary Report</h2>
                        <button onclick="closeSummaryModal()" style="background: #ef4444; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px;">‚úï</button>
                    </div>
                    <div id="summaryContent">
                        <!-- Summary content will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- üìà ENHANCED CHARTS TAB -->
        <div id="charts" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <h3>üìä Progress by Work Group (Actual vs Expected)</h3>
                    <div class="chart-container">
                        <canvas id="workGroupChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>üéØ Completion Status Distribution</h3>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>üìà Daily Activity Summary with Velocity</h3>
                <div class="chart-container">
                    <canvas id="daySummaryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- üìâ ENHANCED TRENDS TAB WITH SUB-TABS -->
        <div id="trends" class="tab-content">
            <!-- Sub-navigation for Trends -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="trend-subtab active" onclick="showTrendSubTab('overall')">üìä Overall Trends</button>
                <button class="trend-subtab" onclick="showTrendSubTab('workgroup')">üë• Work Group Trends</button>
            </div>
            
            <!-- Overall Trends Sub-tab -->
            <div id="overall-trends" class="trend-subtab-content">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üìà Daily Completions with Trend Colors</h3>
                        <div class="chart-container">
                            <canvas id="dailyProgressChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üîÆ Cumulative Progress with ETA Prediction</h3>
                        <div class="chart-container">
                            <canvas id="progressTrendChart"></canvas>
                        </div>
                        <div id="etaHint" style="margin-top: 10px; padding: 10px; background: #f0fdf4; border-radius: 6px; font-size: 13px; color: #16a34a;">
                            <!-- ETA prediction will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>‚ö° Performance Metrics</h3>
                    <div class="grid grid-3">
                        <div class="metric">
                            <div class="metric-value" id="avgDailyCompletion">0</div>
                            <div class="metric-label">Avg Daily Completion</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="totalUpdates">0</div>
                            <div class="metric-label">Total Updates</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="activeWorkGroups">0</div>
                            <div class="metric-label">Active Work Groups</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Work Group Trends Sub-tab -->
            <div id="workgroup-trends" class="trend-subtab-content" style="display: none;">
                <div class="card">
                    <h3>üìà Daily Progress by Work Group</h3>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="workGroupTrendsChart"></canvas>
                    </div>
                    <div style="margin-top: 15px; font-size: 13px; color: #666;">
                        <span style="color: #10b981;">‚óè Green: Improving trend</span> ‚Ä¢ 
                        <span style="color: #ef4444;">‚óè Red: Declining trend</span> ‚Ä¢ 
                        <span style="color: #3b82f6;">‚óè Blue: Stable trend</span>
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="card">
                        <h3>üèÜ Work Group Performance Ranking</h3>
                        <div id="workGroupRanking">
                            <!-- Rankings will be populated here -->
                        </div>
                    </div>
                    <div class="card">
                        <h3>‚ö° Work Group Velocity Analysis</h3>
                        <div id="workGroupVelocity">
                            <!-- Velocity metrics will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ü§ñ ENHANCED ANALYTICS TAB WITH ACTION HINTS -->
        <div id="analytics" class="tab-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 32px; margin-bottom: 10px;">ü§ñ Advanced AI Analytics</h1>
                <p style="font-size: 18px; color: #666; margin-bottom: 15px;">Auto-generated insights with actionable recommendations</p>
                <button onclick="generateAnalytics()" style="background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    üîÑ Refresh Analytics
                </button>
            </div>

            <div class="grid grid-2">
                <!-- Risk Assessment Card -->
                <div class="card">
                    <h3>
                        üö® Risk Assessment 
                        <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; margin-left: 10px;">AUTO</span>
                    </h3>
                    <div id="riskAssessment">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 18px; margin-bottom: 8px;">üìä Loading Analysis...</div>
                            <div style="font-size: 14px;">Upload JSON data to see risk assessment</div>
                        </div>
                    </div>
                </div>

                <!-- Resource Allocation Card -->
                <div class="card">
                    <h3>
                        üë• Resource Allocation 
                        <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; margin-left: 10px;">AUTO</span>
                    </h3>
                    <div id="resourceAllocation">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 18px; margin-bottom: 8px;">üë• Loading Analysis...</div>
                            <div style="font-size: 14px;">Upload JSON data to see resource allocation</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-2">
                <!-- Predictive Analytics Card -->
                <div class="card">
                    <h3>
                        üîÆ Predictive Analytics 
                        <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; margin-left: 10px;">AUTO</span>
                    </h3>
                    <div id="predictiveAnalytics">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 18px; margin-bottom: 8px;">üîÆ Loading Analysis...</div>
                            <div style="font-size: 14px;">Upload JSON data to see predictions</div>
                        </div>
                    </div>
                </div>

                <!-- Bottleneck Detection Card -->
                <div class="card">
                    <h3>
                        üöß Bottleneck Detection 
                        <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; margin-left: 10px;">AUTO</span>
                    </h3>
                    <div id="bottleneckDetection">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 18px; margin-bottom: 8px;">üöß Loading Analysis...</div>
                            <div style="font-size: 14px;">Upload JSON data to detect bottlenecks</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- How Analytics Works Explanation -->
            <div class="card">
                <h3>üí° How This Works (100% Automatic)</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                    <div style="padding: 15px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                        <strong>üö® Risk Assessment</strong><br>
                        <small style="color: #666;">Calculated from: Expected end dates vs current progress rate</small>
                    </div>
                    <div style="padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                        <strong>üë• Resource Allocation</strong><br>
                        <small style="color: #666;">Calculated from: Task count & completion rate per work group</small>
                    </div>
                    <div style="padding: 15px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <strong>üîÆ Predictive Analytics</strong><br>
                        <small style="color: #666;">Calculated from: Historical daily completion rates</small>
                    </div>
                    <div style="padding: 15px; background: #fefbf2; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <strong>üöß Bottleneck Detection</strong><br>
                        <small style="color: #666;">Calculated from: Work groups with <50% average progress</small>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0fdf4; border-radius: 8px; text-align: center;">
                    <strong style="color: #16a34a;">‚ú® The Magic:</strong> 
                    <span style="color: #666;">All insights are generated automatically from your JSON data - no manual input required!</span>
                </div>
            </div>
        </div>

        <!-- üéØ NEW OIM VIEW TAB - Operations Manager Dashboard -->
        <div id="oimview" class="tab-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="font-size: 32px; margin-bottom: 10px;">üéØ OIM Dashboard</h1>
                <p style="font-size: 18px; color: #666; margin-bottom: 15px;">Operations Manager Quick Risk Summary & Decision Support</p>
                <button onclick="refreshOIMView()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    üîÑ Refresh OIM View
                </button>
            </div>

            <!-- Quick Risk Cards -->
            <div class="grid grid-4">
                <div class="card" style="border-left: 4px solid #ef4444;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 800; color: #ef4444;" id="overdueItems">0</div>
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Items Overdue</div>
                        </div>
                        <div style="font-size: 32px;">‚ö†Ô∏è</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #666;" id="overdueDetails">
                        Click to see details
                    </div>
                </div>

                <div class="card" style="border-left: 4px solid #f59e0b;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 800; color: #f59e0b;" id="stagnantItems">0</div>
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">No Update >2 Days</div>
                        </div>
                        <div style="font-size: 32px;">‚è≥</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #666;" id="stagnantDetails">
                        Tasks without progress
                    </div>
                </div>

                <div class="card" style="border-left: 4px solid #3b82f6;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 20px; font-weight: 800; color: #3b82f6;" id="slowestGroup">-</div>
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Slowest Group</div>
                        </div>
                        <div style="font-size: 32px;">üêå</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #666;" id="slowestDetails">
                        Needs attention
                    </div>
                </div>

                <div class="card" style="border-left: 4px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 800; color: #10b981;" id="mechanicalProgress">0%</div>
                            <div style="font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Mechanical Work</div>
                        </div>
                        <div style="font-size: 32px;">üîß</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #666;" id="mechanicalDetails">
                        Overall progress
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="grid grid-2">
                <div class="card">
                    <h3>üö® Critical Items Requiring Immediate Action</h3>
                    <div id="criticalItemsList">
                        <div style="text-align: center; padding: 20px; color: #666;">
                            Loading critical analysis...
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìä Work Distribution & Focus Areas</h3>
                    <div id="workDistribution">
                        <div style="text-align: center; padding: 20px; color: #666;">
                            Analyzing work distribution...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Recommendations -->
            <div class="card">
                <h3>üí° AI-Powered Smart Recommendations</h3>
                <div id="smartRecommendations">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        Generating intelligent recommendations...
                    </div>
                </div>
            </div>

            <!-- Idle Alert Engine -->
            <div class="card" style="background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); border: 2px solid #ef4444;">
                <h3 style="color: #dc2626;">üö® Idle Alert Engine</h3>
                <div id="idleAlerts">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        Scanning for idle tasks...
                    </div>
                </div>
            </div>
        </div>

        <div class="copyright" style="text-align: center; padding: 20px; margin-top: 30px; color: #666; border-top: 1px solid #e2e8f0;">
            ¬© 2025 Enhanced Timeline Analytics by Aziz Mohamad. TCOT Turnaround Strategic Dashboard.
        </div>
    </div>

    <script>
        // üöÄ GLOBAL VARIABLES & SETUP
        let globalData = null;
        let charts = {};

        // üìä HARDCODED WORK ITEMS DATA
                        const workItemsData = {
            'HMM (Asset Restoration)': [
                { id: 1, index: 1, order: "40025559", description: formatDescription("SK-175 TCP UPGRADE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "HMM (Construction)", weightage: "9.38%", progress: 1 },
                { id: 2, index: 2, order: "11400318", description: formatDescription("V-800: INTERNAL INSPECTION DURING SD."), location: "IBA", equipment: "MYIA-IBA-V-800", workCenter: "HMM (Construction)", weightage: "6.25%", progress: 1 },
                { id: 3, index: 3, order: "11462213", description: formatDescription("V-120 INTERNAL VESSEL CLEANING AND NOZZLE REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-V-120", workCenter: "HMM (Construction)", weightage: "6.25%", progress: 1 },
                { id: 4, index: 4, order: "11472734", description: formatDescription("FLARE NOZZLE REPLACEMENT."), location: "IBA", equipment: "MYIA-IBA-ME-180", workCenter: "HMM (Construction)", weightage: "3.13%", progress: 1 },
                { id: 5, index: 5, order: "11406923", description: formatDescription("IBA -13U WALL THICKNESS LOSS"), location: "IBA", equipment: "MYIA-IBA-WH-13U-FL", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 6, index: 6, order: "11467788", description: formatDescription("V210 & V130 CHECK VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 7, index: 7, order: "11467833", description: formatDescription("F1- TO INSTALL CI QUILL AT IBA SP131"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 8, index: 8, order: "11467835", description: formatDescription("F1- TO INSTALL CI QUILL AT IBA SP133"), location: "IBA", equipment: "MYIA-IBA-V-130", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 9, index: 9, order: "11396376", description: formatDescription("F-163A INLET/OUTLET VALVES PASSING"), location: "IBA", equipment: "MYIA-IBA-F-163A", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 10, index: 10, order: "11455977", description: formatDescription("F-173A TO ROTATE FILTER HOUSING"), location: "IBA", equipment: "MYIA-IBA-F-173A", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 11, index: 11, order: "11415417", description: formatDescription("XDV-597 MANUAL VALVE CHANGE OUT"), location: "IBA", equipment: "MYIA-IBA-XDV-597", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 12, index: 12, order: "11423909", description: formatDescription("XDV-593 DISCH FLANGE CONC CORRODED"), location: "IBA", equipment: "MYIA-IBA-XDV-593", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 1 },
                { id: 13, index: 13, order: "11429373", description: formatDescription("STUD BOLT PARTED AT VALVE BODY"), location: "IBA", equipment: "MYIA-IBA-XDV-594", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 },
                { id: 14, index: 14, order: "11335460", description: formatDescription("DELUGE VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-XDV-592", workCenter: "HMM (Construction)", weightage: "1.85%", progress: 1 },
                { id: 15, index: 15, order: "11335457", description: formatDescription("DELUGE VALVE PASSING"), location: "IBA", equipment: "MYIA-IBA-XDV-596", workCenter: "HMM (Construction)", weightage: "1.90%", progress: 1 },
                { id: 16, index: 16, order: "11368248", description: formatDescription("V-120 INLET SPECTABLE BLIND REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-V-120", workCenter: "HMM (Construction)", weightage: "2.13%", progress: 0 }
            ],
            'CMPE (Maintainance)': [
                { id: 17, index: 1, order: "11429986", description: formatDescription("SDV-150 ACTUATOR BADLY CORRODED"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 18, index: 2, order: "11447713", description: formatDescription("V-150 3\" VALVE AT BRIDLE LINE CORRODED"), location: "IBA", equipment: "MYIA-IBA-V-150", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 19, index: 3, order: "11340586", description: formatDescription("MULTIPLE FAULTY CARD INSIDE DCS CABINET"), location: "IBA", equipment: "MYIA-IBA-DCS-ALL", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 20, index: 4, order: "11353305", description: formatDescription("AIR LEAK THROUGH VALVE STEM"), location: "IBA", equipment: "MYIA-IBA-LV-120B", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 21, index: 5, order: "11450291", description: formatDescription("SDV-131 BODY BADLY CORRODED."), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 22, index: 6, order: "11399275", description: formatDescription("REPLACE TRANSFORMER T-C 480-120/208"), location: "IBA", equipment: "MYIA-IBA-MC-502", workCenter: "CMPE (Electrician)", weightage: "1.00%", progress: 0 },
                { id: 23, index: 7, order: "11357941", description: formatDescription("SK-175 VFD ISSUE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "CMPE (Electrician)", weightage: "1.00%", progress: 0 },
                { id: 24, index: 8, order: "11313044", description: formatDescription("WHCP PN-200 UPGRADE"), location: "IBA", equipment: "MYIA-IBA-PN-200", workCenter: "CMPE (E&I)", weightage: "3.13%", progress: 0 },
                { id: 25, index: 9, order: "11416733", description: formatDescription("HV-115B VALVE PASSING"), location: "IBB", equipment: "MYIB-IBB-HV-115B", workCenter: "CMPE (Mechanic)", weightage: "1.00%", progress: 0 },
                { id: 26, index: 10, order: "11441063", description: formatDescription("IBB SM VALVES - SOLENOID VALVES UPGRADE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "1.00%", progress: 0 },
                { id: 27, index: 11, order: "11450609", description: formatDescription("HV-115B ACTUATOR CORRODED"), location: "IBB", equipment: "MYIB-IBB-HV-115B", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
                { id: 28, index: 12, order: "23864201", description: formatDescription("CFT - PLATFORM ESD FULL FUNCTION TESTING"), location: "IBA", equipment: "MYIA-IBA-ESD-ALL", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 100 }
            ],
            'Operations': [
                { id: 50, index: 1, order: "23864161", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-886", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 51, index: 2, order: "23864160", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-880", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 52, index: 3, order: "23864159", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-870", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 53, index: 4, order: "23864158", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-865", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 54, index: 5, order: "23864157", description: formatDescription("SDV (FVO/LVO) LEAK TESTING"), location: "IBA", equipment: "MYIA-IBA-SDV-860", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 55, index: 6, order: "23851075", description: formatDescription("PRESSURE SAFETY VALVE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 56, index: 7, order: "23851076", description: formatDescription("PRESSURE SAFETY VALVE"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "Operations", weightage: "0.71%", progress: 0 },
                { id: 57, index: 8, order: "OPR-001", description: formatDescription("FUEL GAS SYSTEM ISOLATION AND PREPARATION"), location: "IBA", equipment: "FUEL-GAS-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 58, index: 9, order: "OPR-002", description: formatDescription("CRUDE OIL SYSTEM DEPRESSURIZATION AND DRAINING"), location: "IBA", equipment: "CRUDE-OIL-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 59, index: 10, order: "OPR-003", description: formatDescription("GAS LIFT INJECTION SYSTEM DEISOLATION"), location: "IBA", equipment: "GAS-LIFT-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 60, index: 11, order: "OPR-004", description: formatDescription("UTILITY SYSTEM PRESSURE UP AND COMMISSIONING"), location: "IBA", equipment: "UTILITY-SYSTEM", workCenter: "Operations", weightage: "2.50%", progress: 0 },
                { id: 61, index: 12, order: "OPR-005", description: formatDescription("PRE-STARTUP SAFETY REVIEW (PSSR) COMPLETION"), location: "IBA", equipment: "ALL-SYSTEMS", workCenter: "Operations", weightage: "1.50%", progress: 0 }
            ],
            'QC INSPECTION': [
                { id: 65, index: 1, order: "23861687", description: formatDescription("IBA FLARE WALKWAY BEAM INSPECTION"), location: "IBA", equipment: "MYIA-IBA-STRUCT", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 66, index: 2, order: "23757213", description: formatDescription("FLARE TIP CLOSE VISUAL INSPECTION"), location: "IBA", equipment: "MYIA-IBA-ME-180", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 67, index: 3, order: "23826434", description: formatDescription("F2 EXT VISUAL INSP FLARE BOOM & TOWER"), location: "IBA", equipment: "MYIA-IBA-PIPE-02", workCenter: "QC", weightage: "1.25%", progress: 0 },
                { id: 68, index: 4, order: "23450502", description: formatDescription("F2 EXT VISUAL INSP VENT BOOM"), location: "IBB", equipment: "MYIB-IBB-PIPE-02", workCenter: "QC", weightage: "1.25%", progress: 0 }
            ],
            'CMPE (PSV)': [
                { id: 70, index: 1, order: "23538104", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-235A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 71, index: 2, order: "23717006", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-130A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 72, index: 3, order: "23717007", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-220A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 73, index: 4, order: "23717008", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-230A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 74, index: 5, order: "23717025", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-230B", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 },
                { id: 75, index: 6, order: "23717011", description: formatDescription("PSV OVERHAUL"), location: "IBA", equipment: "MYIA-IBA-PSV-460A", workCenter: "CMPE (PSV Gang)", weightage: "0.50%", progress: 0 }
            ],
            'HMM (FIMS02)': [
                { id: 80, index: 1, order: "11344620", description: formatDescription("EXT-25L-00857-L-PP"), location: "IBA", equipment: "FIMS02", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 81, index: 2, order: "11339453", description: formatDescription("1C-PD-M1-00208-L-FLG"), location: "IBA", equipment: "FIMS03", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 82, index: 3, order: "11339453", description: formatDescription("1C-PD-M1-00211-L-FLG"), location: "IBA", equipment: "FIMS04", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 83, index: 4, order: "11346663", description: formatDescription("MzD-M1-00112-M-PP"), location: "IBB", equipment: "FIMS05", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 },
                { id: 84, index: 5, order: "11346663", description: formatDescription("M1-MzD-00132-H-PP"), location: "IBB", equipment: "FIMS06", workCenter: "HMM (Construction)", weightage: "0.91%", progress: 0 }
            ],
            'Roving Gang (TMRG)': [
                { id: 90, index: 1, order: "TBA", description: formatDescription("SK175 8KPM"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "TMRG", weightage: "5.00%", progress: 0 },
                { id: 91, index: 2, order: "11479126", description: formatDescription("HOTSPOT FOUND AT EXHAUST STACK"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "TMRG", weightage: "5.00%", progress: 0 }
            ],
'CMPE (E&I) - PM02': [
    { id: 92, index: 1, order: "23820940", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-886", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 93, index: 2, order: "23820939", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-880", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 94, index: 3, order: "23820938", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-870", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 95, index: 4, order: "23820937", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-868", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 96, index: 5, order: "23820936", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-865", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 97, index: 6, order: "23820735", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-860", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 98, index: 7, order: "23820734", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-845", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 99, index: 8, order: "23820733", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-840", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 100, index: 9, order: "23864146", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-887", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 101, index: 10, order: "23864145", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-885", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 102, index: 11, order: "23864144", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-840A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 103, index: 12, order: "23864143", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-430", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 104, index: 13, order: "23864142", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-412", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 105, index: 14, order: "23864141", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-411", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 106, index: 15, order: "23864140", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-240", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 107, index: 16, order: "23864139", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-239", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 108, index: 17, order: "23864138", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-225", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 109, index: 18, order: "23864137", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 110, index: 19, order: "23864136", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 111, index: 20, order: "23864135", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 112, index: 21, order: "23864134", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 113, index: 22, order: "23864133", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-105", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 114, index: 23, order: "23864132", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-480", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 115, index: 24, order: "23864150", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-863", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 116, index: 25, order: "23864149", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-259", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 117, index: 26, order: "23864148", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-242", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 118, index: 27, order: "23864147", description: formatDescription("CFT - VALVE,BLOWDOWN ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-227", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 119, index: 28, order: "23853296", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-460", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 120, index: 29, order: "23853420", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-227", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 121, index: 30, order: "23853419", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-225", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 122, index: 31, order: "23853418", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-840", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 123, index: 32, order: "23853422", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-411", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 124, index: 33, order: "23853421", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-840A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 125, index: 34, order: "23853424", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-105", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 126, index: 35, order: "23853417", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SV-120", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 127, index: 36, order: "23853423", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBA", equipment: "MYIA-IBA-SY-102", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 128, index: 37, order: "23833970", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-351", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 129, index: 38, order: "23833968", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-230", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 130, index: 39, order: "23833966", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-220", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 131, index: 40, order: "23833964", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-212", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 132, index: 41, order: "23833962", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-130A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 133, index: 42, order: "23833960", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-121", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 134, index: 43, order: "23833958", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-860A", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 135, index: 44, order: "23833957", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-593", workCenter: "CMPE (E&I)", weightage: "0.01%", progress: 0 },
    { id: 136, index: 45, order: "23833956", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-180", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 137, index: 46, order: "23864202", description: formatDescription("CFT - SDV FVO/LVO (PNEU) FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-840", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 138, index: 47, order: "23833714", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-XV-152", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 139, index: 48, order: "23833712", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBA", equipment: "MYIA-IBA-SDV-207", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 140, index: 49, order: "23868031", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-290", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 141, index: 50, order: "23847917", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-885", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 142, index: 51, order: "23848231", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 143, index: 52, order: "23849997", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 144, index: 53, order: "23868029", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-430", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 145, index: 54, order: "23727719", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-480", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 146, index: 55, order: "23868028", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-411", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 147, index: 56, order: "23727717", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-225", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 148, index: 57, order: "23868027", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-460", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 149, index: 58, order: "23847918", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-887", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 150, index: 59, order: "23847916", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-868", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 151, index: 60, order: "23850139", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-840A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 152, index: 61, order: "23727725", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-239", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 153, index: 62, order: "23727724", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-150", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 154, index: 63, order: "23868030", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 155, index: 64, order: "23848492", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 156, index: 65, order: "23868026", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-SDV-412", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 157, index: 66, order: "23848493", description: formatDescription("CFT - VALVE, BLOWDOWN FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-BDV-227", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 158, index: 67, order: "23848346", description: formatDescription("CFT - VALVE, BLOWDOWN FUNCT TEST & MAINT"), location: "IBA", equipment: "MYIA-IBA-BDV-863", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 159, index: 68, order: "23863214", description: formatDescription("DEPRESSURIZATION (BD) PERFORMANCE TEST"), location: "IBA", equipment: "MYIA-IBA-BDV-159", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 160, index: 69, order: "23864226", description: formatDescription("YARD VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-BDV-159", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 161, index: 70, order: "23727740", description: formatDescription("YARD VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SDV-192", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 162, index: 71, order: "23536164", description: formatDescription("TRANSMITTER, PRESSURE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-PT-135C", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 163, index: 72, order: "23643502", description: formatDescription("TRANSMITTER, PRESSURE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-PT-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 164, index: 73, order: "23731380", description: formatDescription("CFT - TRANSMITTER, LEVEL FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-LT-151", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 165, index: 74, order: "23731382", description: formatDescription("CFT - TRANSMITTER, LEVEL FUNCTION TEST"), location: "IBA", equipment: "MYIA-IBA-LT-121-1", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 166, index: 75, order: "23757208", description: formatDescription("CONTROL VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-LCV-120A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 167, index: 76, order: "23757209", description: formatDescription("CONTROL VALVE MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-LCV-220", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 168, index: 77, order: "23864126", description: formatDescription("CFT - LIMIT SWITCHES (SK-175)"), location: "IBA", equipment: "MYIA-IBA-ZSC-185", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 169, index: 78, order: "23864125", description: formatDescription("CFT - LIMIT SWITCHES (SK-175)"), location: "IBA", equipment: "MYIA-IBA-ZSC-125", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 170, index: 79, order: "23864124", description: formatDescription("CFT - VALVE, CONTROL MAINTENANCE(SK-175)"), location: "IBA", equipment: "MYIA-IBA-FCV-185", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 171, index: 80, order: "23864123", description: formatDescription("CFT - VALVE, CONTROL MAINTENANCE(SK-175)"), location: "IBA", equipment: "MYIA-IBA-FCV-125", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 172, index: 81, order: "23864203", description: formatDescription("CFT - PLATFORM ESD FULL FUNCTION TESTING"), location: "IBB", equipment: "MYIB-IBB-ESD-ALL", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 100 },
    { id: 173, index: 82, order: "23837083", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 174, index: 83, order: "23837084", description: formatDescription("SDV FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 175, index: 84, order: "23868037", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-131", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 176, index: 85, order: "23851133", description: formatDescription("SDV NON FVO/LVO ROUTINE MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 177, index: 86, order: "23848711", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-130", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 178, index: 87, order: "23848710", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 179, index: 88, order: "23848712", description: formatDescription("CFT - SDV NON FVO/LVO FUNCT TEST & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-130", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 180, index: 89, order: "23864204", description: formatDescription("CFT - SDV FVO/LVO (HYD) INSP & MAINT"), location: "IBB", equipment: "MYIB-IBB-SDV-174", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 181, index: 90, order: "23864205", description: formatDescription("CFT - SDV FVO/LVO (PNEU) FUNCTION TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 182, index: 91, order: "23833972", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-HV-115A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 183, index: 92, order: "23868033", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-190", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 184, index: 93, order: "23868032", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-141", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 185, index: 94, order: "23864209", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-102", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 186, index: 95, order: "23868034", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-180", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 187, index: 96, order: "23868035", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-140", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 188, index: 97, order: "23868036", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) FUNCT TEST"), location: "IBB", equipment: "MYIB-IBB-SDV-122", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 189, index: 98, order: "23853415", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SY-130A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 190, index: 99, order: "23853413", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-170", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 191, index: 100, order: "23853416", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-120", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 192, index: 101, order: "23853414", description: formatDescription("CFT - RELAY/SOLENOID, VISUAL AND F/TEST"), location: "IBB", equipment: "MYIB-IBB-SV-105A", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 193, index: 102, order: "23868038", description: formatDescription("WHCP MECHANICAL MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-PN-105", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 },
    { id: 194, index: 103, order: "23849387", description: formatDescription("CFT - CONTROL VALVE/TRANSMITTER & CALIBR"), location: "IBB", equipment: "MYIB-IBB-PCV-124", workCenter: "CMPE (E&I)", weightage: "0.03%", progress: 0 }
],
'CMPE (Mechanic) - PM02': [
    { id: 195, index: 1, order: "23864257", description: formatDescription("DAMPER, FIRE ENCLOSURE MAINT SK-175"), location: "IBA", equipment: "MYIA-IBA-FD-CD175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 196, index: 2, order: "23864163", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-130", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 197, index: 3, order: "23864183", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-825A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 198, index: 4, order: "23864182", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-190", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 199, index: 5, order: "23864180", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-120", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 200, index: 6, order: "23864177", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-107", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 201, index: 7, order: "23864178", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-112", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 202, index: 8, order: "23864179", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-118", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 203, index: 9, order: "23864181", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-FA-122", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 204, index: 10, order: "23853390", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-685A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 205, index: 11, order: "23853388", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-680A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 206, index: 12, order: "23853386", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-665A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 207, index: 13, order: "23853384", description: formatDescription("AERIAL COOLING FAN INSP. & MAINT."), location: "IBA", equipment: "MYIA-IBA-FN-660A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 208, index: 14, order: "WMS-PM02", description: formatDescription("WATER MIST SYSTEM MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-WMS-175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 209, index: 15, order: "23864255", description: formatDescription("TURBO COMPRESSOR SK-175 MAINTENANCE"), location: "IBA", equipment: "MYIA-IBA-SK-175", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 210, index: 16, order: "23864221", description: formatDescription("HYDR POWER UNIT OIL REPLACEMENT"), location: "IBA", equipment: "MYIA-IBA-HY-235", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 211, index: 17, order: "23864222", description: formatDescription("HYDR POWER UNIT MAINT & INSP"), location: "IBA", equipment: "MYIA-IBA-HY-235", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 212, index: 18, order: "23833969", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-351", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 213, index: 19, order: "23833967", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-230", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 214, index: 20, order: "23833965", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-220", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 215, index: 21, order: "23833963", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-212", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 216, index: 22, order: "23833961", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-130A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 217, index: 23, order: "23833959", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-121", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 218, index: 24, order: "23833715", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-180", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 219, index: 25, order: "23833713", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-XV-152", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 220, index: 26, order: "23833711", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBA", equipment: "MYIA-IBA-SDV-207", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 221, index: 27, order: "23861727", description: formatDescription("HYDR POWER UNIT MAINT & INSP"), location: "IBB", equipment: "MYIB-IBB-HY-105", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 222, index: 28, order: "23861730", description: formatDescription("HYDR POWER UNIT OIL REPLACEMENT"), location: "IBB", equipment: "MYIB-IBB-HY-105", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 223, index: 29, order: "23727774", description: formatDescription("RUPTURE PIN INSPECTION & MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-PSE-187", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 224, index: 30, order: "23844667", description: formatDescription("FLAME ARRESTOR MAINTENANCE"), location: "IBB", equipment: "MYIB-IBB-SP-1831", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 225, index: 31, order: "23833971", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBB", equipment: "MYIB-IBB-HV-115A", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 },
    { id: 226, index: 32, order: "23538038", description: formatDescription("VALVE, ACTUATED (PNEUMATIC) GREASING"), location: "IBB", equipment: "MYIB-IBB-SDV-102", workCenter: "CMPE (Mechanic)", weightage: "0.03%", progress: 0 }
]
        };

        // üõ†Ô∏è HELPER FUNCTIONS
        function formatDescription(desc) {
            return desc.toUpperCase();
        }

        function extractWorkOrder(workItem) {
            if (!workItem) return '';
            const parts = workItem.split('|');
            return parts[0]?.trim() || '';
        }

        function extractDescription(workItem) {
            if (!workItem) return '';
            const parts = workItem.split('|');
            return parts[1]?.trim() || '';
        }

        function getAllWorkItems() {
            const allItems = [];
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                items.forEach(item => {
                    allItems.push({ ...item, workGroup });
                });
            });
            return allItems;
        }

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => messagesDiv.innerHTML = '', 5000);
        }

        // üéõÔ∏è TAB SWITCHING FUNCTION
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (globalData) {
                setTimeout(() => {
                    if (tabName === 'charts') updateCharts();
                    if (tabName === 'trends') updateTrends();
                    if (tabName === 'analytics') updateAnalytics();
                    if (tabName === 'oimview') updateOIMView();
                }, 100);
            }
        }

        // üìÇ FILE UPLOAD HANDLER
document.getElementById('jsonFileInput').addEventListener('change', async function (e) {
    // ‚úÖ IF ELECTRON
    if (window.electronAPI && window.electronAPI.loadFromShare) {
        try {
            const data = await window.electronAPI.loadFromShare();
            globalData = data;
            console.log('Data loaded:', globalData);
            updateDashboard();
            document.getElementById('lastUpdated').textContent = `Data loaded: ${new Date().toLocaleString()}`;
            showMessage('üöÄ Data loaded successfully from Electron share!');
        } catch (err) {
            console.error('Electron load error:', err);
            showMessage('‚ùå Failed to load data from Electron share.', 'error');
        }
        return;
    }

    // üåê Browser mode: fallback to file picker
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            try {
                globalData = JSON.parse(e.target.result);
                console.log('Data loaded:', globalData);
                updateDashboard();
                document.getElementById('lastUpdated').textContent = `Data loaded: ${new Date().toLocaleString()}`;
                showMessage('üöÄ Data loaded successfully from file!');
            } catch (error) {
                console.error('JSON parse error:', error);
                showMessage('Error reading JSON file: ' + error.message, 'error');
            }
        };
        reader.readAsText(file);
    }
});


        // üìä MAIN DASHBOARD UPDATE FUNCTION
        function updateDashboard() {
            if (!globalData) {
                console.log('No data to update dashboard');
                return;
            }
            
            console.log('Updating dashboard with data:', globalData);
            updateOverview();
            applyTimelineFilters();
            updateCharts();
            updateTrends();
            updateAnalytics();
            updateOIMView();
        }

        // üìà OVERVIEW UPDATE FUNCTION
        function updateOverview() {
            const formData = globalData.currentFormData || {};
            const allWorkItems = getAllWorkItems();
            const updates = globalData.updates || [];

            const total = allWorkItems.length;
            
            let completed = 0;
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                if (matchingUpdate && matchingUpdate.progressPct === 100) {
                    completed++;
                }
            });

            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalWorklist').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('overallProgress').textContent = progress + '%';

            document.getElementById('startDate').textContent = formData.startSDDate || '-';
            document.getElementById('endDate').textContent = formData.expectedEndDate || '-';
            document.getElementById('platformPOB').textContent = formData.platformPOB || '-';
            document.getElementById('vesselPOB').textContent = formData.vesselPOB || '-';
            document.getElementById('hseIncidents').textContent = formData.hseIncidents !== undefined ? formData.hseIncidents : '-';
            document.getElementById('safetyObs').textContent = formData.hseSafetyObservations || '-';

            if (formData.expectedEndDate) {
                const endDate = new Date(formData.expectedEndDate);
                const today = new Date();
                const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                document.getElementById('daysLeft').textContent = Math.max(0, daysLeft);
            } else {
                document.getElementById('daysLeft').textContent = '-';
            }

            updateOverviewWorkGroupChart();
        }

        function updateOverviewWorkGroupChart() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workGroupSummary = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                workGroupSummary[workGroup] = { total: items.length, completed: 0 };
            });
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                if (matchingUpdate && matchingUpdate.progressPct === 100) {
                    workGroupSummary[workItem.workGroup].completed++;
                }
            });

            const labels = Object.keys(workGroupSummary);
            const completionRates = labels.map(group => {
                const summary = workGroupSummary[group];
                return summary.total > 0 ? Math.round((summary.completed / summary.total) * 100) : 0;
            });

            if (charts.overviewWorkGroup) charts.overviewWorkGroup.destroy();
            
            const ctx = document.getElementById('overviewWorkGroupChart');
            if (ctx && labels.length > 0) {
                charts.overviewWorkGroup = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Completion Rate (%)',
                            data: completionRates,
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Completion %' } },
                            x: { 
                                ticks: { maxRotation: 45 },
                                title: { display: true, text: 'Work Groups' }
                            }
                        }
                    }
                });
            }
        }

        // üîç ENHANCED ANALYSIS HELPER FUNCTIONS
        function isOverdue(itemDate, endDate) {
            if (!endDate) return false;
            const today = new Date();
            const deadline = new Date(endDate);
            return today > deadline;
        }
        
        function isTaskIdle(lastUpdate, progress) {
            if (!lastUpdate) return progress === 0;
            const today = new Date();
            const updateDate = new Date(lastUpdate);
            const daysSinceUpdate = Math.ceil((today - updateDate) / (1000 * 60 * 60 * 24));
            return daysSinceUpdate > 2 && progress < 100;
        }

        function isNearDeadline(formData) {
            if (!formData.expectedEndDate) return false;
            const today = new Date();
            const deadline = new Date(formData.expectedEndDate);
            const daysToDeadline = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
            return daysToDeadline <= 7;
        }

        // üìÖ ENHANCED TIMELINE FUNCTIONS WITH ACCORDION GROUPING
        function applyTimelineFilters() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const statusFilter = document.getElementById('statusFilter').value;
            const workGroupFilter = document.getElementById('workGroupFilter').value;
            const dateFromFilter = document.getElementById('dateFromFilter').value;
            const dateToFilter = document.getElementById('dateToFilter').value;
            const showCriticalOnly = document.getElementById('showCriticalOnly').checked;
            
            const combinedData = allWorkItems.map(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progressPct = matchingUpdate ? matchingUpdate.progressPct : 0;
                const date = matchingUpdate ? matchingUpdate.date : null;
                const remarks = matchingUpdate ? matchingUpdate.remarks : '';
                
                const isCritical = progressPct < 50 || isOverdue(date, globalData?.currentFormData?.expectedEndDate);
                const isIdle = isTaskIdle(date, progressPct);
                
                return {
                    ...workItem,
                    progressPct,
                    date,
                    remarks,
                    isCritical,
                    isIdle
                };
            });
            
            let filteredData = combinedData.filter(item => {
                const status = item.progressPct === 100 ? 'completed' : 
                              item.progressPct > 0 ? 'in-progress' : 'pending';
                if (statusFilter !== 'all' && status !== statusFilter) return false;
                
                if (workGroupFilter !== 'all' && item.workGroup !== workGroupFilter) return false;
                
                if (dateFromFilter && item.date && item.date < dateFromFilter) return false;
                if (dateToFilter && item.date && item.date > dateToFilter) return false;
                
                if (showCriticalOnly && !item.isCritical) return false;
                
                return true;
            });
            
            const groupedData = {};
            filteredData.forEach(item => {
                if (!groupedData[item.workGroup]) {
                    groupedData[item.workGroup] = [];
                }
                groupedData[item.workGroup].push(item);
            });
            
            const criticalCount = combinedData.filter(item => item.isCritical).length;
            const idleCount = combinedData.filter(item => item.isIdle).length;
            
            document.getElementById('filteredCount').textContent = filteredData.length;
            document.getElementById('totalCount').textContent = allWorkItems.length;
            document.getElementById('criticalCount').textContent = criticalCount;
            document.getElementById('idleCount').textContent = idleCount;
            
            renderAccordionView(groupedData);
        }

        function renderAccordionView(groupedData) {
            const container = document.getElementById('timelineGroupedView');
            container.innerHTML = '';
            
            Object.entries(groupedData).forEach(([workGroup, items]) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group-container';
                
                const totalItems = items.length;
                const completedItems = items.filter(item => item.progressPct === 100).length;
                const criticalItems = items.filter(item => item.isCritical).length;
                const completionRate = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'group-header';
                headerDiv.onclick = () => toggleGroupContent(workGroup);
                headerDiv.innerHTML = `
                    <div>
                        <strong>${workGroup}</strong>
                        <div style="font-size: 13px; color: #666; margin-top: 4px;">
                            ${totalItems} items ‚Ä¢ ${completionRate}% complete ‚Ä¢ ${criticalItems} critical
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 20px; font-weight: bold;">${completionRate}%</div>
                        <div id="toggle-${workGroup.replace(/\s+/g, '')}" style="font-size: 18px;">‚ñº</div>
                    </div>
                `;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'group-content';
                contentDiv.id = `content-${workGroup.replace(/\s+/g, '')}`;
                
                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `group-item ${item.isCritical ? 'critical' : ''} ${item.isIdle ? 'idle' : ''} clickable`;
                    itemDiv.onclick = () => highlightInCharts(item);
                    
                    const status = item.progressPct === 100 ? 'completed' : 
                                  item.progressPct > 0 ? 'in-progress' : 'pending';
                    const statusClass = status === 'completed' ? 'status-complete' : 
                                      status === 'in-progress' ? 'status-progress' : 'status-pending';
                    
                    itemDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <strong>${item.order}</strong>
                                <div style="font-size: 13px; color: #666; margin-top: 2px;">
                                    ${item.description.length > 50 ? item.description.substring(0, 50) + '...' : item.description}
                                </div>
                                ${item.isCritical ? '<div style="font-size: 11px; color: #ef4444; font-weight: 600;">üö® CRITICAL</div>' : ''}
                                ${item.isIdle ? '<div style="font-size: 11px; color: #f59e0b; font-weight: 600;">‚è≥ IDLE</div>' : ''}
                            </div>
                            <div style="text-align: right;">
                                <div class="enhanced-progress-bar" style="width: 100px;">
                                    <div class="enhanced-progress-fill" style="width: ${item.progressPct}%"></div>
                                </div>
                                <div style="font-size: 12px; margin-top: 4px;">${item.progressPct}%</div>
                                <span class="${statusClass}" style="font-size: 10px;">${status.toUpperCase()}</span>
                            </div>
                        </div>
                    `;
                    
                    contentDiv.appendChild(itemDiv);
                });
                
                groupDiv.appendChild(headerDiv);
                groupDiv.appendChild(contentDiv);
                container.appendChild(groupDiv);
            });
        }

        function expandAllGroups() {
            document.querySelectorAll('.group-content').forEach(content => {
                content.classList.add('expanded');
                content.style.display = 'block';
            });
            document.querySelectorAll('.group-header').forEach(header => {
                header.classList.add('expanded');
            });
            document.querySelectorAll('[id^="toggle-"]').forEach(toggle => {
                toggle.textContent = '‚ñ≤';
            });
        }
        
        function collapseAllGroups() {
            document.querySelectorAll('.group-content').forEach(content => {
                content.classList.remove('expanded');
                content.style.display = 'none';
            });
            document.querySelectorAll('.group-header').forEach(header => {
                header.classList.remove('expanded');
            });
            document.querySelectorAll('[id^="toggle-"]').forEach(toggle => {
                toggle.textContent = '‚ñº';
            });
        }
        
        function toggleGroupContent(workGroup) {
            const contentId = `content-${workGroup.replace(/\s+/g, '')}`;
            const toggleId = `toggle-${workGroup.replace(/\s+/g, '')}`;
            const content = document.getElementById(contentId);
            const toggle = document.getElementById(toggleId);
            const header = content.previousElementSibling;
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                content.style.display = 'none';
                header.classList.remove('expanded');
                toggle.textContent = '‚ñº';
            } else {
                content.classList.add('expanded');
                content.style.display = 'block';
                header.classList.add('expanded');
                toggle.textContent = '‚ñ≤';
            }
        }
        
        function highlightInCharts(item) {
            console.log('Highlighting item in charts:', item);
            showMessage(`üéØ Highlighted: ${item.order} - ${item.description.substring(0, 30)}...`);
            showTab('charts');
        }

        // üìà ENHANCED CHARTS TAB WITH TREND LINES
        function updateCharts() {
            console.log('Updating enhanced charts with trend analysis...');
            updateWorkGroupChart();
            updateStatusChart();
            updateDaySummaryChart();
        }

        function updateWorkGroupChart() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const workGroupSummary = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                workGroupSummary[workGroup] = { 
                    total: items.length, 
                    completed: 0, 
                    expected: 0 
                };
            });
            
            const totalDays = calculateProjectDuration(formData);
            const daysElapsed = calculateDaysElapsed(formData);
            const expectedProgressRate = totalDays > 0 ? (daysElapsed / totalDays) * 100 : 0;
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                if (matchingUpdate && matchingUpdate.progressPct === 100) {
                    workGroupSummary[workItem.workGroup].completed++;
                }
                
                workGroupSummary[workItem.workGroup].expected = Math.round(
                    (workGroupSummary[workItem.workGroup].total * expectedProgressRate) / 100
                );
            });

            const labels = Object.keys(workGroupSummary);
            const actualData = labels.map(group => workGroupSummary[group].completed);
            const expectedData = labels.map(group => workGroupSummary[group].expected);

            if (charts.workGroup) charts.workGroup.destroy();
            
            const ctx = document.getElementById('workGroupChart');
            if (ctx && labels.length > 0) {
                charts.workGroup = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels.map(label => label.length > 15 ? label.substring(0, 15) + '...' : label),
                        datasets: [
                            {
                                label: 'Actual Completed',
                                data: actualData,
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 2
                            },
                            {
                                label: 'Expected Progress',
                                data: expectedData,
                                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 2,
                                type: 'line',
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'Actual vs Expected Progress by Work Group' },
                            tooltip: {
                                callbacks: {
                                    afterBody: function(context) {
                                        const index = context[0].dataIndex;
                                        const variance = actualData[index] - expectedData[index];
                                        const varianceText = variance >= 0 ? 
                                            `‚úÖ Ahead by ${variance} tasks` : 
                                            `‚ö†Ô∏è Behind by ${Math.abs(variance)} tasks`;
                                        return [`Variance: ${varianceText}`];
                                    }
                                }
                            }
                        },
                        scales: { 
                            y: { beginAtZero: true, title: { display: true, text: 'Number of Tasks' } },
                            x: { ticks: { maxRotation: 45 } }
                        }
                    }
                });
            }
        }

        function calculateProjectDuration(formData) {
            if (!formData.startSDDate || !formData.expectedEndDate) return 0;
            const start = new Date(formData.startSDDate);
            const end = new Date(formData.expectedEndDate);
            return Math.ceil((end - start) / (1000 * 60 * 60 * 24));
        }
        
        function calculateDaysElapsed(formData) {
            if (!formData.startSDDate) return 0;
            const start = new Date(formData.startSDDate);
            const today = new Date();
            return Math.max(0, Math.ceil((today - start) / (1000 * 60 * 60 * 24)));
        }

        function updateStatusChart() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            let completed = 0, inProgress = 0, pending = 0;
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                
                if (progress === 100) completed++;
                else if (progress > 0) inProgress++;
                else pending++;
            });

            if (charts.status) charts.status.destroy();
            
            const ctx = document.getElementById('statusChart');
            if (ctx) {
                charts.status = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'In Progress', 'Pending'],
                        datasets: [{
                            data: [completed, inProgress, pending],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: { display: true, text: 'Overall Status Distribution' }
                        }
                    }
                });
            }
        }

        function updateDaySummaryChart() {
            const updates = globalData?.updates || [];
            
            const dailyUpdates = {};
            updates.forEach(update => {
                if (update.date) {
                    if (!dailyUpdates[update.date]) {
                        dailyUpdates[update.date] = { 
                            total: 0, 
                            completed: 0, 
                            critical: 0,
                            velocity: 0
                        };
                    }
                    dailyUpdates[update.date].total++;
                    if (update.progressPct === 100) {
                        dailyUpdates[update.date].completed++;
                    }
                    if (update.progressPct < 50) {
                        dailyUpdates[update.date].critical++;
                    }
                }
            });

            const dates = Object.keys(dailyUpdates).sort();
            dates.forEach((date, index) => {
                if (index > 0) {
                    const prevCompleted = dailyUpdates[dates[index - 1]].completed;
                    const currentCompleted = dailyUpdates[date].completed;
                    dailyUpdates[date].velocity = currentCompleted - prevCompleted;
                }
            });

            const totalUpdates = dates.map(date => dailyUpdates[date].total);
            const completedUpdates = dates.map(date => dailyUpdates[date].completed);
            const velocityData = dates.map(date => dailyUpdates[date].velocity);

            if (charts.daySummary) charts.daySummary.destroy();
            
            const ctx = document.getElementById('daySummaryChart');
            if (ctx && dates.length > 0) {
                charts.daySummary = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: 'Total Updates',
                                data: totalUpdates,
                                borderColor: 'rgba(59, 130, 246, 1)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Completed Items',
                                data: completedUpdates,
                                borderColor: 'rgba(16, 185, 129, 1)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Daily Velocity',
                                data: velocityData,
                                borderColor: 'rgba(245, 158, 11, 1)',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'Daily Activity Summary with Velocity' },
                            tooltip: {
                                callbacks: {
                                    afterBody: function(context) {
                                        const date = context[0].label;
                                        const dayData = dailyUpdates[date];
                                        return [
                                            `Critical items: ${dayData.critical}`,
                                            `Completion rate: ${dayData.total > 0 ? Math.round((dayData.completed / dayData.total) * 100) : 0}%`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                title: { display: true, text: 'Number of Items' },
                                position: 'left'
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Velocity (change/day)' },
                                grid: { drawOnChartArea: false }
                            },
                            x: { title: { display: true, text: 'Date' } }
                        }
                    }
                });
            }
        }

        // üìâ ENHANCED TRENDS TAB WITH SUB-TABS
        function updateTrends() {
            console.log('Updating enhanced trends with ETA prediction...');
            updateDailyProgressChart();
            updateProgressTrendChart();
            updateTrendMetrics();
            updateETAPrediction();
        }

        function showTrendSubTab(subTab) {
            document.querySelectorAll('.trend-subtab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = '#e5e7eb';
                tab.style.color = '#374151';
            });
            
            event.target.classList.add('active');
            event.target.style.background = '#3b82f6';
            event.target.style.color = 'white';
            
            document.querySelectorAll('.trend-subtab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(`${subTab}-trends`).style.display = 'block';
            
            if (subTab === 'workgroup') {
                updateWorkGroupTrends();
            } else {
                updateTrends();
            }
        }

        function updateDailyProgressChart() {
            const updates = globalData?.updates || [];
            
            const dailyCompletions = {};
            updates.forEach(update => {
                if (update.date && update.progressPct === 100) {
                    dailyCompletions[update.date] = (dailyCompletions[update.date] || 0) + 1;
                }
            });

            const dates = Object.keys(dailyCompletions).sort();
            const completions = dates.map(date => dailyCompletions[date]);
            
            const trendColors = completions.map((value, index) => {
                if (index === 0) return 'rgba(16, 185, 129, 0.8)';
                const prevValue = completions[index - 1];
                if (value > prevValue) return 'rgba(16, 185, 129, 0.8)';
                else if (value < prevValue) return 'rgba(239, 68, 68, 0.8)';
                else return 'rgba(59, 130, 246, 0.8)';
            });

            if (charts.dailyProgress) charts.dailyProgress.destroy();
            
            const ctx = document.getElementById('dailyProgressChart');
            if (ctx && dates.length > 0) {
                charts.dailyProgress = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Tasks Completed',
                            data: completions,
                            backgroundColor: trendColors,
                            borderColor: trendColors.map(color => color.replace('0.8', '1')),
                            borderWidth: 2,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Daily Task Completions with Trend Colors' },
                            tooltip: {
                                callbacks: {
                                    afterLabel: function(context) {
                                        const index = context.dataIndex;
                                        if (index === 0) return 'First day';
                                        const current = context.parsed.y;
                                        const previous = completions[index - 1];
                                        if (current > previous) return 'üìà Improving trend';
                                        else if (current < previous) return 'üìâ Declining trend';
                                        else return '‚û°Ô∏è Stable trend';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Completed Tasks' } },
                            x: { title: { display: true, text: 'Date' } }
                        }
                    }
                });
            }
        }

        function updateProgressTrendChart() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const dailyProgress = {};
            const sortedUpdates = updates.filter(u => u.date).sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let cumulativeCompleted = 0;
            sortedUpdates.forEach(update => {
                if (update.progressPct === 100) {
                    cumulativeCompleted++;
                }
                const progressPct = Math.round((cumulativeCompleted / allWorkItems.length) * 100);
                dailyProgress[update.date] = progressPct;
            });

            const dates = Object.keys(dailyProgress);
            const progressValues = dates.map(date => dailyProgress[date]);
            
            const trendLineData = calculateTrendLine(dates, progressValues, formData);

            if (charts.progressTrend) charts.progressTrend.destroy();
            
            const ctx = document.getElementById('progressTrendChart');
            if (ctx && dates.length > 0) {
                charts.progressTrend = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates.concat(trendLineData.futureDates),
                        datasets: [
                            {
                                label: 'Actual Progress (%)',
                                data: progressValues,
                                borderColor: 'rgba(99, 102, 241, 1)',
                                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.3
                            },
                            {
                                label: 'Projected Trend',
                                data: Array(progressValues.length).fill(null).concat(trendLineData.projectedValues),
                                borderColor: 'rgba(245, 158, 11, 1)',
                                backgroundColor: 'rgba(245, 158, 11, 0.05)',
                                borderWidth: 2,
                                borderDash: [10, 5],
                                fill: false,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'Cumulative Progress with Prediction' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Progress (%)' } },
                            x: { title: { display: true, text: 'Date' } }
                        }
                    }
                });
            }
        }
        
        function calculateTrendLine(dates, values, formData) {
            if (dates.length < 2) return { futureDates: [], projectedValues: [] };
            
            const n = values.length;
            const sumX = dates.reduce((sum, _, i) => sum + i, 0);
            const sumY = values.reduce((sum, val) => sum + val, 0);
            const sumXY = dates.reduce((sum, _, i) => sum + (i * values[i]), 0);
            const sumXX = dates.reduce((sum, _, i) => sum + (i * i), 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            const futureDates = [];
            const projectedValues = [];
            const lastDate = new Date(dates[dates.length - 1]);
            
            for (let i = 1; i <= 30; i++) {
                const futureDate = new Date(lastDate);
                futureDate.setDate(futureDate.getDate() + i);
                const futureIndex = n + i - 1;
                const projectedValue = Math.min(100, Math.max(0, slope * futureIndex + intercept));
                
                futureDates.push(futureDate.toLocaleDateString('en-GB'));
                projectedValues.push(projectedValue);
                
                if (projectedValue >= 100) break;
            }
            
            return { futureDates, projectedValues };
        }
        
        function updateETAPrediction() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const completedCount = updates.filter(u => u.progressPct === 100).length;
            const currentProgress = allWorkItems.length > 0 ? (completedCount / allWorkItems.length) * 100 : 0;
            
            let etaText = '';
            
            if (formData.startSDDate && completedCount > 0) {
                const startDate = new Date(formData.startSDDate);
                const today = new Date();
                const daysElapsed = Math.max(1, Math.ceil((today - startDate) / (1000 * 60 * 60 * 24)));
                
                const currentRate = completedCount / daysElapsed;
                const remainingTasks = allWorkItems.length - completedCount;
                const estimatedDaysToComplete = Math.ceil(remainingTasks / Math.max(0.1, currentRate));
                
                const projectedEndDate = new Date(today);
                projectedEndDate.setDate(projectedEndDate.getDate() + estimatedDaysToComplete);
                
                const actualEndDate = formData.expectedEndDate ? new Date(formData.expectedEndDate) : null;
                
                if (actualEndDate) {
                    const variance = Math.ceil((projectedEndDate - actualEndDate) / (1000 * 60 * 60 * 24));
                    if (variance <= 0) {
                        etaText = `üéØ <strong>On Track!</strong> Current rate will complete by ${projectedEndDate.toLocaleDateString('en-GB')} (${Math.abs(variance)} days early)`;
                    } else {
                        etaText = `‚ö†Ô∏è <strong>At Risk:</strong> Current rate suggests completion by ${projectedEndDate.toLocaleDateString('en-GB')} (${variance} days late)`;
                    }
                } else {
                    etaText = `üìÖ <strong>ETA:</strong> At current rate (${currentRate.toFixed(1)} tasks/day), completion expected by ${projectedEndDate.toLocaleDateString('en-GB')}`;
                }
            } else {
                etaText = 'üìä Need more data to calculate ETA prediction';
            }
            
            document.getElementById('etaHint').innerHTML = etaText;
        }

        function updateTrendMetrics() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const totalUpdates = updates.length;
            const completedTasks = updates.filter(u => u.progressPct === 100).length;
            const uniqueDates = [...new Set(updates.map(u => u.date).filter(Boolean))];
            const avgDailyCompletion = uniqueDates.length > 0 ? Math.round(completedTasks / uniqueDates.length) : 0;
            const activeWorkGroups = Object.keys(workItemsData).length;
            
            document.getElementById('avgDailyCompletion').textContent = avgDailyCompletion;
            document.getElementById('totalUpdates').textContent = totalUpdates;
            document.getElementById('activeWorkGroups').textContent = activeWorkGroups;
        }

        // üìà WORK GROUP TRENDS SUB-TAB
        function updateWorkGroupTrends() {
            console.log('Updating work group trends...');
            updateWorkGroupTrendsChart();
            updateWorkGroupRanking();
            updateWorkGroupVelocity();
        }
        
        function updateWorkGroupTrendsChart() {
            const updates = globalData?.updates || [];
            const workGroups = Object.keys(workItemsData);
            
            const dailyGroupProgress = {};
            
            updates.forEach(update => {
                if (update.date && update.progressPct === 100) {
                    const workItem = getAllWorkItems().find(item => item.order === extractWorkOrder(update.workItem));
                    if (workItem) {
                        const date = update.date;
                        const group = workItem.workGroup;
                        
                        if (!dailyGroupProgress[date]) {
                            dailyGroupProgress[date] = {};
                        }
                        if (!dailyGroupProgress[date][group]) {
                            dailyGroupProgress[date][group] = 0;
                        }
                        dailyGroupProgress[date][group]++;
                    }
                }
            });
            
            const dates = Object.keys(dailyGroupProgress).sort();
            
            const datasets = workGroups.map((group, index) => {
                const colors = [
                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', 
                    '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                ];
                
                const data = dates.map(date => dailyGroupProgress[date][group] || 0);
                
                return {
                    label: group.length > 20 ? group.substring(0, 20) + '...' : group,
                    data: data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3
                };
            });
            
            if (charts.workGroupTrends) charts.workGroupTrends.destroy();
            
            const ctx = document.getElementById('workGroupTrendsChart');
            if (ctx && dates.length > 0) {
                charts.workGroupTrends = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'Daily Completions by Work Group' }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Tasks Completed' } },
                            x: { title: { display: true, text: 'Date' } }
                        }
                    }
                });
            }
        }
        
        function updateWorkGroupRanking() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workGroupStats = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let completed = 0;
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    if (matchingUpdate && matchingUpdate.progressPct === 100) {
                        completed++;
                    }
                });
                
                const completionRate = items.length > 0 ? Math.round((completed / items.length) * 100) : 0;
                workGroupStats[workGroup] = {
                    completed,
                    total: items.length,
                    completionRate
                };
            });
            
            const sortedGroups = Object.entries(workGroupStats)
                .sort(([,a], [,b]) => b.completionRate - a.completionRate);
            
            const rankingHtml = sortedGroups.map(([group, stats], index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                const trendClass = stats.completionRate >= 70 ? 'trend-up' : 
                                  stats.completionRate >= 40 ? 'trend-stable' : 'trend-down';
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin: 8px 0; border-radius: 8px;" class="${trendClass}">
                        <div>
                            <span style="font-size: 18px; margin-right: 10px;">${medal}</span>
                            <strong>${group.length > 25 ? group.substring(0, 25) + '...' : group}</strong>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: bold;">${stats.completionRate}%</div>
                            <div style="font-size: 11px; opacity: 0.8;">${stats.completed}/${stats.total} tasks</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('workGroupRanking').innerHTML = rankingHtml;
        }
        
        function updateWorkGroupVelocity() {
            const updates = globalData?.updates || [];
            
            const velocityStats = {};
            const recentDays = 7;
            
            Object.keys(workItemsData).forEach(workGroup => {
                const recentCompletions = updates.filter(update => {
                    const workItem = getAllWorkItems().find(item => item.order === extractWorkOrder(update.workItem));
                    if (!workItem || workItem.workGroup !== workGroup) return false;
                    
                    if (!update.date || update.progressPct !== 100) return false;
                    
                    const updateDate = new Date(update.date);
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - recentDays);
                    
                    return updateDate >= cutoffDate;
                }).length;
                
                velocityStats[workGroup] = {
                    velocity: Math.round((recentCompletions / recentDays) * 10) / 10,
                    recentCompletions
                };
            });
            
            const velocityHtml = Object.entries(velocityStats)
                .sort(([,a], [,b]) => b.velocity - a.velocity)
                .map(([group, stats]) => {
                    const velocityColor = stats.velocity >= 1 ? '#10b981' : 
                                         stats.velocity >= 0.5 ? '#f59e0b' : '#ef4444';
                    
                    return `
                        <div style="padding: 12px; margin: 8px 0; border-radius: 8px; background: white; border-left: 4px solid ${velocityColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${group.length > 25 ? group.substring(0, 25) + '...' : group}</strong>
                                    <div style="font-size: 11px; color: #666; margin-top: 2px;">
                                        ${stats.recentCompletions} tasks in last ${recentDays} days
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 20px; font-weight: bold; color: ${velocityColor};">
                                        ${stats.velocity}
                                    </div>
                                    <div style="font-size: 11px; color: #666;">tasks/day</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('workGroupVelocity').innerHTML = velocityHtml;
        }

        // ü§ñ ENHANCED ANALYTICS WITH ACTION HINTS
        function generateAnalytics() {
            updateAnalytics();
            showMessage('ü§ñ Analytics refreshed with latest insights!');
        }

        function updateAnalytics() {
            console.log('ü§ñ Generating advanced analytics with action hints...');
            updateRiskAssessmentWithHints();
            updateResourceAllocationWithHints();
            updatePredictiveAnalyticsWithHints();
            updateBottleneckDetectionWithHints();
            updateSuggestedNextFocus();
            console.log('‚úÖ Enhanced analytics generation complete!');
        }
        
        function updateRiskAssessmentWithHints() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const riskItems = [];
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progressPct = matchingUpdate ? matchingUpdate.progressPct : 0;
                let riskLevel = 'LOW';
                let reason = 'On track for completion';
                let actionHint = '';
                
                if (formData.expectedEndDate) {
                    const today = new Date();
                    const endDate = new Date(formData.expectedEndDate);
                    const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (progressPct < 20 && daysRemaining <= 5) {
                        riskLevel = 'HIGH';
                        reason = `Critical: Only ${progressPct}% progress with ${daysRemaining} days left`;
                        actionHint = 'Escalate to OIM immediately and assign dedicated resources';
                    }
                    else if (progressPct === 0 && daysRemaining < 0) {
                        riskLevel = 'HIGH';
                        reason = `Overdue: No progress, ${Math.abs(daysRemaining)} days past deadline`;
                        actionHint = 'Emergency intervention required - mobilize all available resources';
                    }
                    else if (progressPct < 50 && daysRemaining <= 10) {
                        riskLevel = 'MEDIUM';
                        reason = `Behind schedule: ${progressPct}% progress, ${daysRemaining} days remaining`;
                        actionHint = 'Increase daily monitoring and consider additional manpower';
                    }
                    else if (progressPct < 30 && daysRemaining <= 15) {
                        riskLevel = 'MEDIUM';
                        reason = `Slow progress: ${progressPct}% completed with ${daysRemaining} days left`;
                        actionHint = 'Review execution plan and remove blockers';
                    }
                }
                
                if (riskLevel !== 'LOW') {
                    riskItems.push({
                        order: workItem.order,
                        description: workItem.description.substring(0, 35) + '...',
                        workGroup: workItem.workGroup,
                        riskLevel,
                        reason,
                        actionHint,
                        progress: progressPct
                    });
                }
            });
            
            riskItems.sort((a, b) => {
                const riskOrder = { 'HIGH': 3, 'MEDIUM': 2, 'LOW': 1 };
                return riskOrder[b.riskLevel] - riskOrder[a.riskLevel];
            });
            
            const riskHtml = riskItems.length > 0 ? riskItems.slice(0, 6).map(item => `
                <div class="risk-item risk-${item.riskLevel.toLowerCase()}">
                    <div>
                        <strong>${item.order}</strong><br>
                        <small style="color: #666;">${item.description}</small><br>
                        <small style="color: #888; font-size: 11px;">${item.reason}</small>
                        <div class="action-hint">${item.actionHint}</div>
                    </div>
                    <span class="risk-badge badge-${item.riskLevel.toLowerCase()}">${item.riskLevel}</span>
                </div>
            `).join('') + `
                <div class="action-hint" style="margin-top: 15px; background: #eff6ff; border-color: #3b82f6;">
                    <strong>Smart Action:</strong> Focus immediate attention on HIGH risk items. Consider resource reallocation from completed work groups.
                </div>
            ` : `
                <div class="analytics-summary">
                    <div style="font-size: 20px; margin-bottom: 8px;">‚úÖ All Clear!</div>
                    <div style="color: #666; font-size: 14px;">No high-risk items detected. All work items are progressing well according to schedule.</div>
                </div>
            `;
            
            document.getElementById('riskAssessment').innerHTML = riskHtml;
        }
        
        function updateResourceAllocationWithHints() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workGroupSummary = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                workGroupSummary[workGroup] = { 
                    total: items.length, 
                    completed: 0, 
                    inProgress: 0,
                    idle: 0
                };
            });
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                const lastUpdate = matchingUpdate ? matchingUpdate.date : null;
                
                if (progress === 100) {
                    workGroupSummary[workItem.workGroup].completed++;
                } else if (progress > 0) {
                    workGroupSummary[workItem.workGroup].inProgress++;
                    if (isTaskIdle(lastUpdate, progress)) {
                        workGroupSummary[workItem.workGroup].idle++;
                    }
                }
            });
            
            const performanceRanking = Object.entries(workGroupSummary).map(([workGroup, summary]) => {
                const completionRate = summary.total > 0 ? Math.round((summary.completed / summary.total) * 100) : 0;
                return { workGroup, ...summary, completionRate };
            }).sort((a, b) => b.completionRate - a.completionRate);
            
            const topPerformer = performanceRanking[0];
            const bottomPerformer = performanceRanking[performanceRanking.length - 1];
            
            const resourceHtml = Object.entries(workGroupSummary).map(([workGroup, summary]) => {
                const completionRate = summary.total > 0 ? Math.round((summary.completed / summary.total) * 100) : 0;
                const workGroupShort = workGroup.length > 25 ? workGroup.substring(0, 25) + '...' : workGroup;
                
                let performanceColor = '#10b981';
                let recommendation = '';
                
                if (completionRate < 30) {
                    performanceColor = '#ef4444';
                    recommendation = 'Needs immediate resource boost';
                } else if (completionRate < 60) {
                    performanceColor = '#f59e0b';
                    recommendation = 'Consider additional support';
                } else if (completionRate >= 90) {
                    recommendation = 'Excellent! Resources can be reallocated';
                } else {
                    recommendation = 'On track, maintain current resources';
                }
                
                return `
                    <div style="margin-bottom: 18px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span><strong>${workGroupShort}</strong></span>
                            <span style="font-weight: 600; color: ${performanceColor};">${completionRate}% Complete</span>
                        </div>
                        <div class="resource-bar">
                            <div class="resource-fill" style="width: ${completionRate}%; background: linear-gradient(90deg, ${performanceColor}, ${performanceColor}dd);">
                                ${summary.completed}/${summary.total} Tasks
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            üìã ${summary.total} total ‚Ä¢ ‚úÖ ${summary.completed} done ‚Ä¢ üîÑ ${summary.inProgress} active ‚Ä¢ ‚è≥ ${summary.total - summary.completed - summary.inProgress} pending
                            ${summary.idle > 0 ? ` ‚Ä¢ üö® ${summary.idle} idle` : ''}
                        </div>
                        <div style="font-size: 11px; color: #888; margin-top: 4px; font-style: italic;">
                            üí° ${recommendation}
                        </div>
                    </div>
                `;
            }).join('');
            
            const reallocationHint = topPerformer && bottomPerformer && topPerformer.completionRate > 80 && bottomPerformer.completionRate < 40 ? `
                <div class="action-hint" style="margin-top: 15px;">
                    <strong>Smart Reallocation:</strong> Consider moving 1-2 resources from ${topPerformer.workGroup.substring(0, 20)}... (${topPerformer.completionRate}% complete) to support ${bottomPerformer.workGroup.substring(0, 20)}... (${bottomPerformer.completionRate}% complete)
                </div>
            ` : '';
            
            document.getElementById('resourceAllocation').innerHTML = resourceHtml + reallocationHint;
        }
        
        function updatePredictiveAnalyticsWithHints() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const completedCount = allWorkItems.filter(item => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return item.order === orderFromUpdate;
                });
                return matchingUpdate && matchingUpdate.progressPct === 100;
            }).length;
            
            const totalItems = allWorkItems.length;
            const currentProgress = totalItems > 0 ? Math.round((completedCount / totalItems) * 100) : 0;
            
            let estimatedDays = 'N/A';
            let projectedDate = 'N/A';
            let scheduleStatus = 'UNKNOWN';
            let scheduleColor = '#6b7280';
            let actionRecommendation = '';
            
            if (formData.startSDDate && formData.expectedEndDate) {
                const startDate = new Date(formData.startSDDate);
                const endDate = new Date(formData.expectedEndDate);
                const today = new Date();
                
                const daysElapsed = Math.max(1, Math.ceil((today - startDate) / (1000 * 60 * 60 * 24)));
                const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysElapsed > 0 && currentProgress > 0) {
                    const currentRate = currentProgress / daysElapsed;
                    const remainingProgress = 100 - currentProgress;
                    estimatedDays = Math.ceil(remainingProgress / currentRate);
                    
                    const projectedEndDate = new Date(today);
                    projectedEndDate.setDate(projectedEndDate.getDate() + estimatedDays);
                    projectedDate = projectedEndDate.toLocaleDateString('en-GB');
                    
                    if (estimatedDays <= daysRemaining - 3) {
                        scheduleStatus = 'AHEAD';
                        scheduleColor = '#10b981';
                        actionRecommendation = 'Excellent pace! Consider quality reviews and preparation for next phase';
                    } else if (estimatedDays <= daysRemaining) {
                        scheduleStatus = 'ON TRACK';
                        scheduleColor = '#3b82f6';
                        actionRecommendation = 'Maintain current pace and monitor for any emerging blockers';
                    } else if (estimatedDays <= daysRemaining + 2) {
                        scheduleStatus = 'AT RISK';
                        scheduleColor = '#f59e0b';
                        actionRecommendation = 'Increase daily monitoring and remove non-critical tasks';
                    } else {
                        scheduleStatus = 'BEHIND';
                        scheduleColor = '#ef4444';
                        actionRecommendation = 'URGENT: Implement recovery plan with extended hours and additional resources';
                    }
                } else if (currentProgress === 0) {
                    scheduleStatus = 'NOT STARTED';
                    scheduleColor = '#6b7280';
                    actionRecommendation = 'Project mobilization required immediately';
                }
            }
            
            const dataQuality = updates.length > 0 && formData.startSDDate ? 'HIGH' : 
                               updates.length > 0 || formData.startSDDate ? 'MEDIUM' : 'LOW';
            
            const predictiveHtml = `
                <div class="prediction-metric">
                    <div class="prediction-value">${estimatedDays}</div>
                    <div class="prediction-label">Days to Complete</div>
                </div>
                <div class="prediction-metric">
                    <div class="prediction-value" style="font-size: 18px; color: #334155;">${projectedDate}</div>
                    <div class="prediction-label">Projected End Date</div>
                </div>
                <div class="prediction-metric">
                    <div class="prediction-value" style="color: ${scheduleColor}; font-size: 20px;">${scheduleStatus}</div>
                    <div class="prediction-label">Schedule Status</div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 13px; color: #666;">
                    üìä <strong>Confidence:</strong> ${dataQuality} ‚Ä¢ ${currentProgress}% complete ‚Ä¢ ${updates.length} data points
                </div>
                ${actionRecommendation ? `<div class="action-hint">${actionRecommendation}</div>` : ''}
            `;
            
            document.getElementById('predictiveAnalytics').innerHTML = predictiveHtml;
        }
        
        function updateBottleneckDetectionWithHints() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workGroupStats = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let totalProgress = 0;
                let completedItems = 0;
                let activeItems = 0;
                let idleItems = 0;
                
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    
                    const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                    const lastUpdate = matchingUpdate ? matchingUpdate.date : null;
                    
                    totalProgress += progress;
                    if (progress === 100) completedItems++;
                    if (progress > 0) activeItems++;
                    if (isTaskIdle(lastUpdate, progress)) idleItems++;
                });
                
                const avgProgress = items.length > 0 ? Math.round(totalProgress / items.length) : 0;
                workGroupStats[workGroup] = { 
                    avgProgress, 
                    completedItems, 
                    totalItems: items.length,
                    activeItems,
                    idleItems,
                    completionRate: items.length > 0 ? Math.round((completedItems / items.length) * 100) : 0
                };
            });
            
            const bottlenecks = Object.entries(workGroupStats).filter(([workGroup, stats]) => {
                return stats.avgProgress < 40 || 
                       (stats.completionRate < 30 && stats.totalItems > 2) ||
                       (stats.activeItems === 0 && stats.totalItems > 1) ||
                       stats.idleItems > 2;
            });
            
            const bottleneckHtml = bottlenecks.length > 0 ? bottlenecks.map(([workGroup, stats]) => {
                let severity = 'MODERATE';
                let icon = '‚ö†';
                let bgColor = '#fefbf2';
                let borderColor = '#f59e0b';
                let specificAction = '';
                
                if (stats.avgProgress < 20 || stats.activeItems === 0) {
                    severity = 'CRITICAL';
                    icon = 'üö®';
                    bgColor = '#fef2f2';
                    borderColor = '#ef4444';
                    specificAction = 'Escalate to leadership and implement emergency mobilization';
                } else if (stats.idleItems > 2) {
                    specificAction = `Reactivate ${stats.idleItems} idle tasks immediately`;
                } else if (stats.completionRate < 30) {
                    specificAction = 'Assign additional experienced personnel and review execution plan';
                } else {
                    specificAction = 'Increase supervision and daily progress monitoring';
                }
                
                const workGroupShort = workGroup.length > 30 ? workGroup.substring(0, 30) + '...' : workGroup;
                
                let issue = '';
                if (stats.activeItems === 0) {
                    issue = 'No work started yet';
                } else if (stats.avgProgress < 20) {
                    issue = `Very slow progress (${stats.avgProgress}% avg)`;
                } else if (stats.idleItems > 2) {
                    issue = `${stats.idleItems} tasks idle for >2 days`;
                } else {
                    issue = `Below expected progress (${stats.avgProgress}% avg)`;
                }
                
                return `
                    <div class="bottleneck-alert" style="background: ${bgColor}; border-color: ${borderColor};">
                        <div class="alert-icon" style="background: ${borderColor};">${icon}</div>
                        <div style="flex: 1;">
                            <strong>${workGroupShort}</strong><br>
                            <small style="color: #666;">${issue} ‚Ä¢ ${stats.completedItems}/${stats.totalItems} completed</small><br>
                            <small style="color: #888; font-size: 11px; margin-top: 4px;">
                                üîÑ ${stats.activeItems} active ‚Ä¢ ‚è≥ ${stats.totalItems - stats.activeItems} not started ‚Ä¢ üö® ${stats.idleItems} idle
                            </small>
                            <div class="action-hint" style="margin-top: 8px; background: rgba(255,255,255,0.8);">
                                ${specificAction}
                            </div>
                        </div>
                    </div>
                `;
            }).join('') + `
                <div class="action-hint" style="margin-top: 15px;">
                    <strong>Overall Recommendation:</strong> Address bottlenecks in order of severity. Consider manpower shift from high-performing groups to bottleneck areas.
                </div>
            ` : `
                <div class="analytics-summary">
                    <div style="font-size: 20px; margin-bottom: 8px;">üéØ No Bottlenecks!</div>
                    <div style="color: #666; font-size: 14px;">All work groups are performing well with healthy progress rates. Keep up the great work!</div>
                </div>
            `;
            
            document.getElementById('bottleneckDetection').innerHTML = bottleneckHtml;
        }
        
        function updateSuggestedNextFocus() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workGroupAnalysis = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let completed = 0;
                let inProgress = 0;
                let totalWeightage = 0;
                
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    
                    const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                    if (progress === 100) completed++;
                    else if (progress > 0) inProgress++;
                    
                    const weightage = parseFloat(item.weightage?.replace('%', '') || '1');
                    totalWeightage += weightage;
                });
                
                const completionRate = items.length > 0 ? (completed / items.length) * 100 : 0;
                const utilizationRate = items.length > 0 ? ((completed + inProgress) / items.length) * 100 : 0;
                const momentum = inProgress > 0 ? 'HIGH' : completed > 0 ? 'MEDIUM' : 'LOW';
                
                workGroupAnalysis[workGroup] = {
                    completionRate,
                    utilizationRate,
                    momentum,
                    totalWeightage,
                    pendingTasks: items.length - completed - inProgress,
                    score: calculateFocusScore(completionRate, utilizationRate, totalWeightage, momentum)
                };
            });
            
            const suggestedFocus = Object.entries(workGroupAnalysis)
                .sort(([,a], [,b]) => b.score - a.score)[0];
            
            if (suggestedFocus) {
                const [groupName, analysis] = suggestedFocus;
                const focusReason = generateFocusReason(analysis);
                
                const existingAnalytics = document.getElementById('analytics');
                const existingFocusCard = existingAnalytics.querySelector('#nextFocusCard');
                
                if (existingFocusCard) {
                    existingFocusCard.remove();
                }
                
                const focusCard = document.createElement('div');
                focusCard.id = 'nextFocusCard';
                focusCard.className = 'card';
                focusCard.innerHTML = `
                    <h3>
                        üîÑ Suggested Next Focus Group
                        <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; margin-left: 10px;">AUTO</span>
                    </h3>
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 12px; margin-bottom: 15px;">
                        <div style="font-size: 28px; font-weight: 800; color: #16a34a; margin-bottom: 10px;">
                            ${groupName.length > 30 ? groupName.substring(0, 30) + '...' : groupName}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                            ${focusReason}
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 18px; font-weight: bold; color: #16a34a;">${analysis.completionRate.toFixed(0)}%</div>
                                <div style="font-size: 11px; color: #666;">Completion</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 18px; font-weight: bold; color: #3b82f6;">${analysis.utilizationRate.toFixed(0)}%</div>
                                <div style="font-size: 11px; color: #666;">Utilization</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 18px; font-weight: bold; color: #f59e0b;">${analysis.pendingTasks}</div>
                                <div style="font-size: 11px; color: #666;">Pending</div>
                            </div>
                        </div>
                    </div>
                    <div class="action-hint">
                        <strong>Recommended Action:</strong> Allocate primary focus to this group for the next 2-3 days to maximize project momentum.
                    </div>
                `;
                
                const howItWorksCard = existingAnalytics.querySelector('.card:last-child');
                existingAnalytics.insertBefore(focusCard, howItWorksCard);
            }
        }
        
        function calculateFocusScore(completionRate, utilizationRate, weightage, momentum) {
            let score = 0;
            
            if (completionRate >= 30 && completionRate <= 80) score += 30;
            else if (completionRate < 30) score += 20;
            else score += 10;
            
            if (momentum === 'HIGH') score += 25;
            else if (momentum === 'MEDIUM') score += 15;
            else score += 5;
            
            score += Math.min(weightage * 2, 25);
            
            if (utilizationRate >= 20 && utilizationRate <= 70) score += 20;
            
            return score;
        }
        
        function generateFocusReason(analysis) {
            if (analysis.completionRate < 30 && analysis.momentum === 'LOW') {
                return 'Critical group needing immediate activation';
            } else if (analysis.momentum === 'HIGH' && analysis.completionRate < 80) {
                return 'High momentum group - maximize current progress';
            } else if (analysis.totalWeightage > 10) {
                return 'High-impact group with significant project weightage';
            } else if (analysis.utilizationRate > 50 && analysis.completionRate < 70) {
                return 'Active group with good completion potential';
            } else {
                return 'Balanced choice for steady progress';
            }
        }

        // üéØ OIM VIEW FUNCTIONS
        function refreshOIMView() {
            updateOIMView();
            showMessage('üéØ OIM View refreshed with latest risk analysis!');
        }
        
        function updateOIMView() {
            console.log('üéØ Updating OIM View...');
            updateOIMQuickCards();
            updateCriticalItemsList();
            updateWorkDistribution();
            updateSmartRecommendations();
            updateIdleAlerts();
        }
        
        function updateOIMQuickCards() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            let overdueItems = 0;
            let overdueDetails = '';
            
            if (formData.expectedEndDate) {
                const today = new Date();
                const deadline = new Date(formData.expectedEndDate);
                
                if (today > deadline) {
                    const incompleteTasks = allWorkItems.filter(item => {
                        const matchingUpdate = updates.find(update => {
                            const orderFromUpdate = extractWorkOrder(update.workItem);
                            return item.order === orderFromUpdate;
                        });
                        return !matchingUpdate || matchingUpdate.progressPct < 100;
                    });
                    
                    overdueItems = incompleteTasks.length;
                    const daysOverdue = Math.ceil((today - deadline) / (1000 * 60 * 60 * 24));
                    overdueDetails = `${daysOverdue} days past deadline`;
                } else {
                    overdueDetails = 'Project on schedule';
                }
            }
            
            let stagnantItems = 0;
            const today = new Date();
            
            stagnantItems = allWorkItems.filter(item => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return item.order === orderFromUpdate;
                });
                
                if (!matchingUpdate || matchingUpdate.progressPct === 100) return false;
                
                if (!matchingUpdate.date) return true;
                
                const updateDate = new Date(matchingUpdate.date);
                const daysSinceUpdate = Math.ceil((today - updateDate) / (1000 * 60 * 60 * 24));
                
                return daysSinceUpdate > 2;
            }).length;
            
            const workGroupStats = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let completed = 0;
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    if (matchingUpdate && matchingUpdate.progressPct === 100) {
                        completed++;
                    }
                });
                
                const completionRate = items.length > 0 ? Math.round((completed / items.length) * 100) : 0;
                workGroupStats[workGroup] = completionRate;
            });
            
            const slowestGroup = Object.entries(workGroupStats)
                .sort(([,a], [,b]) => a - b)[0];
            
            const mechanicalGroups = ['HMM (Asset Restoration)', 'CMPE (Maintenance)', 'CMPE (Mechanic) - PM02'];
            let mechanicalTotal = 0;
            let mechanicalCompleted = 0;
            
            mechanicalGroups.forEach(group => {
                if (workItemsData[group]) {
                    mechanicalTotal += workItemsData[group].length;
                    workItemsData[group].forEach(item => {
                        const matchingUpdate = updates.find(update => {
                            const orderFromUpdate = extractWorkOrder(update.workItem);
                            return item.order === orderFromUpdate;
                        });
                        if (matchingUpdate && matchingUpdate.progressPct === 100) {
                            mechanicalCompleted++;
                        }
                    });
                }
            });
            
            const mechanicalProgress = mechanicalTotal > 0 ? Math.round((mechanicalCompleted / mechanicalTotal) * 100) : 0;
            
            document.getElementById('overdueItems').textContent = overdueItems;
            document.getElementById('overdueDetails').textContent = overdueDetails;
            document.getElementById('stagnantItems').textContent = stagnantItems;
            document.getElementById('stagnantDetails').textContent = stagnantItems > 0 ? `${stagnantItems} tasks need attention` : 'All tasks active';
            document.getElementById('slowestGroup').textContent = slowestGroup ? slowestGroup[0].substring(0, 15) + (slowestGroup[0].length > 15 ? '...' : '') : '-';
            document.getElementById('slowestDetails').textContent = slowestGroup ? `${slowestGroup[1]}% completion rate` : 'No data';
            document.getElementById('mechanicalProgress').textContent = mechanicalProgress + '%';
            document.getElementById('mechanicalDetails').textContent = `${mechanicalCompleted}/${mechanicalTotal} mechanical tasks`;
        }
        
        function updateCriticalItemsList() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const criticalItems = [];
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                const lastUpdate = matchingUpdate ? matchingUpdate.date : null;
                
                let criticalReason = '';
                let priority = 0;
                
                if (progress === 0 && isNearDeadline(formData)) {
                    criticalReason = 'Not started, deadline approaching';
                    priority = 10;
                } else if (progress < 20 && isNearDeadline(formData)) {
                    criticalReason = `Only ${progress}% complete, deadline near`;
                    priority = 8;
                } else if (isTaskIdle(lastUpdate, progress)) {
                    criticalReason = 'No progress for >2 days';
                    priority = 6;
                } else if (progress < 50 && isOverdue(lastUpdate, formData.expectedEndDate)) {
                    criticalReason = 'Behind schedule';
                    priority = 7;
                }
                
                if (criticalReason) {
                    criticalItems.push({
                        ...workItem,
                        progress,
                        criticalReason,
                        priority,
                        lastUpdate
                    });
                }
            });
            
            criticalItems.sort((a, b) => b.priority - a.priority);
            
            const criticalHtml = criticalItems.length > 0 ? 
                criticalItems.slice(0, 8).map(item => `
                    <div class="critical-item">
                        <div>
                            <strong>${item.order}</strong>
                            <div style="font-size: 13px; color: #666; margin-top: 2px;">
                                ${item.description.substring(0, 40)}...
                            </div>
                            <div style="font-size: 11px; color: #ef4444; margin-top: 4px;">
                                ${item.criticalReason}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: bold; color: #ef4444;">
                                ${item.progress}%
                            </div>
                            <div style="font-size: 10px; color: #666;">
                                ${item.workGroup.substring(0, 12)}...
                            </div>
                        </div>
                    </div>
                `).join('') : 
                '<div style="text-align: center; padding: 20px; color: #10b981;">‚úÖ No critical items detected!</div>';
            
            document.getElementById('criticalItemsList').innerHTML = criticalHtml;
        }
        
        function updateWorkDistribution() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const workDistribution = {};
            let totalWeightage = 0;
            
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let groupCompleted = 0;
                let groupWeightage = 0;
                
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    
                    if (matchingUpdate && matchingUpdate.progressPct === 100) {
                        groupCompleted++;
                    }
                    
                    const weightage = parseFloat(item.weightage?.replace('%', '') || '1');
                    groupWeightage += weightage;
                });
                
                const completionRate = items.length > 0 ? Math.round((groupCompleted / items.length) * 100) : 0;
                
                workDistribution[workGroup] = {
                    total: items.length,
                    completed: groupCompleted,
                    completionRate,
                    weightage: groupWeightage
                };
                
                totalWeightage += groupWeightage;
            });
            
            const distributionHtml = Object.entries(workDistribution)
                .sort(([,a], [,b]) => b.weightage - a.weightage)
                .map(([group, stats]) => {
                    const weightagePercent = totalWeightage > 0 ? Math.round((stats.weightage / totalWeightage) * 100) : 0;
                    const statusColor = stats.completionRate >= 70 ? '#10b981' : 
                                       stats.completionRate >= 40 ? '#f59e0b' : '#ef4444';
                    
                    return `
                        <div style="margin-bottom: 15px; padding: 12px; border-radius: 8px; border-left: 4px solid ${statusColor}; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong>${group.length > 20 ? group.substring(0, 20) + '...' : group}</strong>
                                <span style="font-size: 18px; font-weight: bold; color: ${statusColor};">${stats.completionRate}%</span>
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                üìä ${weightagePercent}% of total work ‚Ä¢ 
                                ‚úÖ ${stats.completed}/${stats.total} tasks ‚Ä¢ 
                                ‚öñÔ∏è ${stats.weightage.toFixed(1)}% weightage
                            </div>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('workDistribution').innerHTML = distributionHtml;
        }
        
        function updateSmartRecommendations() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const recommendations = [];
            
            const workGroupStats = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let completed = 0;
                let inProgress = 0;
                
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    
                    const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                    if (progress === 100) completed++;
                    else if (progress > 0) inProgress++;
                });
                
                const completionRate = items.length > 0 ? (completed / items.length) * 100 : 0;
                const utilizationRate = items.length > 0 ? ((completed + inProgress) / items.length) * 100 : 0;
                
                workGroupStats[workGroup] = {
                    total: items.length,
                    completed,
                    inProgress,
                    pending: items.length - completed - inProgress,
                    completionRate,
                    utilizationRate
                };
            });
            
            const sortedGroups = Object.entries(workGroupStats)
                .sort(([,a], [,b]) => a.completionRate - b.completionRate);
            
            if (sortedGroups.length > 0) {
                const slowest = sortedGroups[0];
                recommendations.push({
                    type: 'focus',
                    title: 'üéØ Focus Priority',
                    message: `Prioritize ${slowest[0]} - only ${slowest[1].completionRate.toFixed(0)}% complete with ${slowest[1].pending} pending tasks`,
                    urgency: 'high'
                });
            }
            
            const highPerformers = sortedGroups.filter(([,stats]) => stats.completionRate > 80);
            const lowPerformers = sortedGroups.filter(([,stats]) => stats.completionRate < 40);
            
            if (highPerformers.length > 0 && lowPerformers.length > 0) {
                recommendations.push({
                    type: 'resource',
                    title: 'üë• Resource Reallocation',
                    message: `Consider shifting resources from ${highPerformers[0][0]} (${highPerformers[0][1].completionRate.toFixed(0)}% complete) to support ${lowPerformers[0][0]}`,
                    urgency: 'medium'
                });
            }
            
            const idleTasks = allWorkItems.filter(item => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return item.order === orderFromUpdate;
                });
                return isTaskIdle(matchingUpdate?.date, matchingUpdate?.progressPct || 0);
            });
            
            if (idleTasks.length > 0) {
                recommendations.push({
                    type: 'idle',
                    title: '‚ö° Activate Idle Tasks',
                    message: `${idleTasks.length} tasks have been idle for >2 days. Review and restart these activities`,
                    urgency: 'medium'
                });
            }
            
            const activeGroups = Object.entries(workGroupStats)
                .filter(([,stats]) => stats.utilizationRate > 0 && stats.completionRate < 90)
                .sort(([,a], [,b]) => b.utilizationRate - a.utilizationRate);
            
            if (activeGroups.length > 0) {
                recommendations.push({
                    type: 'next',
                    title: 'üîÑ Suggested Next Focus',
                    message: `Continue momentum with ${activeGroups[0][0]} - high utilization (${activeGroups[0][1].utilizationRate.toFixed(0)}%) and manageable scope`,
                    urgency: 'low'
                });
            }
            
            const recommendationHtml = recommendations.map(rec => {
                const urgencyColor = rec.urgency === 'high' ? '#ef4444' : 
                                    rec.urgency === 'medium' ? '#f59e0b' : '#10b981';
                
                return `
                    <div class="recommendation-item" style="border-left-color: ${urgencyColor};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong>${rec.title}</strong>
                            <span style="background: ${urgencyColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; text-transform: uppercase;">
                                ${rec.urgency}
                            </span>
                        </div>
                        <div style="color: #666; font-size: 14px;">
                            ${rec.message}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('smartRecommendations').innerHTML = recommendationHtml || 
                '<div style="text-align: center; padding: 20px; color: #10b981;">‚úÖ All systems optimized! No immediate recommendations.</div>';
        }
        
        function updateIdleAlerts() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            
            const idleAlerts = [];
            
            allWorkItems.forEach(workItem => {
                const matchingUpdate = updates.find(update => {
                    const orderFromUpdate = extractWorkOrder(update.workItem);
                    return workItem.order === orderFromUpdate;
                });
                
                const progress = matchingUpdate ? matchingUpdate.progressPct : 0;
                const lastUpdate = matchingUpdate ? matchingUpdate.date : null;
                
                if (progress === 0 && !lastUpdate) {
                    idleAlerts.push({
                        ...workItem,
                        alert: 'Never started',
                        severity: 'critical',
                        daysSinceUpdate: 'N/A'
                    });
                } else if (isTaskIdle(lastUpdate, progress)) {
                    const today = new Date();
                    const updateDate = new Date(lastUpdate);
                    const daysSinceUpdate = Math.ceil((today - updateDate) / (1000 * 60 * 60 * 24));
                    
                    idleAlerts.push({
                        ...workItem,
                        progress,
                        alert: `No update for ${daysSinceUpdate} days`,
                        severity: daysSinceUpdate > 5 ? 'critical' : 'warning',
                        daysSinceUpdate
                    });
                }
            });
            
            idleAlerts.sort((a, b) => {
                if (a.severity === 'critical' && b.severity !== 'critical') return -1;
                if (b.severity === 'critical' && a.severity !== 'critical') return 1;
                return (b.daysSinceUpdate || 999) - (a.daysSinceUpdate || 999);
            });
            
            const alertHtml = idleAlerts.length > 0 ? 
                idleAlerts.slice(0, 10).map(item => `
                    <div class="idle-alert">
                        <div class="idle-icon">‚è∞</div>
                        <div style="flex: 1;">
                            <strong>${item.order}</strong>
                            <div style="font-size: 12px; color: #666; margin-top: 2px;">
                                ${item.description.substring(0, 35)}... ‚Ä¢ ${item.workGroup.substring(0, 15)}...
                            </div>
                            <div style="font-size: 11px; color: #f59e0b; margin-top: 4px; font-weight: 600;">
                                üö® ${item.alert} ‚Ä¢ ${item.progress || 0}% complete
                            </div>
                        </div>
                    </div>
                `).join('') : 
                '<div style="text-align: center; padding: 20px; color: #10b981;">‚úÖ No idle tasks detected! All work is progressing.</div>';
            
            document.getElementById('idleAlerts').innerHTML = alertHtml;
        }

        // üßæ SUMMARY CARD GENERATION
        function generateSummaryCard() {
            const allWorkItems = getAllWorkItems();
            const updates = globalData?.updates || [];
            const formData = globalData?.currentFormData || {};
            
            const totalTasks = allWorkItems.length;
            const completedTasks = updates.filter(u => u.progressPct === 100).length;
            const overallProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            const workGroupSummary = {};
            Object.entries(workItemsData).forEach(([workGroup, items]) => {
                let completed = 0;
                items.forEach(item => {
                    const matchingUpdate = updates.find(update => {
                        const orderFromUpdate = extractWorkOrder(update.workItem);
                        return item.order === orderFromUpdate;
                    });
                    if (matchingUpdate && matchingUpdate.progressPct === 100) {
                        completed++;
                    }
                });
                
                workGroupSummary[workGroup] = {
                    total: items.length,
                    completed,
                    rate: items.length > 0 ? Math.round((completed / items.length) * 100) : 0
                };
            });
            
            const summaryHtml = `
                <div class="summary-section">
                    <h4>üìä Overall Project Status</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 10px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">${totalTasks}</div>
                            <div style="font-size: 12px; color: #666;">Total Tasks</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${completedTasks}</div>
                            <div style="font-size: 12px; color: #666;">Completed</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #6366f1;">${overallProgress}%</div>
                            <div style="font-size: 12px; color: #666;">Progress</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-section">
                    <h4>üë• Work Group Performance</h4>
                    ${Object.entries(workGroupSummary)
                        .sort(([,a], [,b]) => b.rate - a.rate)
                        .map(([group, stats]) => `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                                <span><strong>${group}</strong></span>
                                <span>${stats.rate}% (${stats.completed}/${stats.total})</span>
                            </div>
                        `).join('')}
                </div>
                
                <div class="summary-section">
                    <h4>üö® Critical Actions Required</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${workGroupSummary && Object.entries(workGroupSummary)
                            .filter(([,stats]) => stats.rate < 50)
                            .map(([group]) => `<li>Focus on ${group} - Below 50% completion</li>`)
                            .join('') || '<li>‚úÖ No critical issues detected</li>'}
                    </ul>
                </div>
                
                <div class="summary-section">
                    <h4>üí° Next Steps Recommendation</h4>
                    <p>${generateNextStepRecommendation(workGroupSummary)}</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f0fdf4; border-radius: 8px;">
                    <p style="color: #16a34a; font-weight: 600;">
                        üìÖ Generated on ${new Date().toLocaleDateString('en-GB')} at ${new Date().toLocaleTimeString('en-GB')}
                    </p>
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summaryHtml;
            document.getElementById('summaryModal').style.display = 'block';
        }
        
        function generateNextStepRecommendation(workGroupSummary) {
            const sortedGroups = Object.entries(workGroupSummary)
                .sort(([,a], [,b]) => a.rate - b.rate);
            
            if (sortedGroups.length === 0) return 'Continue monitoring progress across all work groups.';
            
            const slowest = sortedGroups[0];
            const fastest = sortedGroups[sortedGroups.length - 1];
            
            if (slowest[1].rate < 30) {
                return `URGENT: Immediate attention required for ${slowest[0]} (${slowest[1].rate}% complete). Consider resource reallocation and daily standups.`;
            } else if (slowest[1].rate < 60) {
                return `FOCUS: Prioritize ${slowest[0]} (${slowest[1].rate}% complete) while maintaining momentum in ${fastest[0]} (${fastest[1].rate}% complete).`;
            } else {
                return `MAINTAIN: Good progress across all groups. Continue current pace and monitor for any blockers.`;
            }
        }
        
        function closeSummaryModal() {
            document.getElementById('summaryModal').style.display = 'none';
        }

        // üöÄ INITIALIZATION AND EVENT LISTENERS
        
        // Populate work group filter
        const workGroups = Object.keys(workItemsData).sort();
        const workGroupFilter = document.getElementById('workGroupFilter');
        workGroups.forEach(group => {
            const option = document.createElement('option');
            option.value = group;
            option.textContent = group;
            workGroupFilter.appendChild(option);
        });

        // Global function assignments
        window.showTab = showTab;
        window.applyTimelineFilters = applyTimelineFilters;
        window.generateAnalytics = generateAnalytics;
        window.expandAllGroups = expandAllGroups;
        window.collapseAllGroups = collapseAllGroups;
        window.generateSummaryCard = generateSummaryCard;
        window.closeSummaryModal = closeSummaryModal;
        window.showTrendSubTab = showTrendSubTab;
        window.refreshOIMView = refreshOIMView;
        window.toggleGroupContent = toggleGroupContent;
        window.highlightInCharts = highlightInCharts;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Enhanced Dashboard with Strategic Features Initialized!');
            
            const allWorkItems = getAllWorkItems();
            document.getElementById('totalWorklist').textContent = allWorkItems.length;
            document.getElementById('completedTasks').textContent = '0';
            document.getElementById('overallProgress').textContent = '0%';
            
            updateOIMView();
            updateAnalytics();
            applyTimelineFilters();
            showTrendSubTab('overall');
            
            console.log('‚úÖ All strategic systems ready!');
            console.log('üìä Features available:');
            console.log('  üîπ Accordion timeline with critical/idle detection');
            console.log('  üîπ Enhanced charts with variance analysis');
            console.log('  üîπ Work group trends with velocity tracking');
            console.log('  üîπ AI-powered analytics with action hints');
            console.log('  üîπ OIM dashboard for executive insights');
            console.log('  üîπ Smart recommendations and ETA predictions');
            console.log('üéØ Upload JSON data to see full analytics power!');
        });

        console.log('üéâ ENHANCED TIMELINE DASHBOARD WITH STRATEGIC ANALYTICS READY! üéâ');
    </script>
</body>
</html>